# 时间轴重构更新文档

## 📅 更新日期
2026年1月25日

## 🎯 更新概述
基于设计图完全重构了时间轴事件卡片，打造了一个功能强大、交互丰富的可视化时间管理系统。

---

## ✨ 核心更新内容

### 1. 全新的事件卡片设计

#### 🎨 视觉升级
- **圆角优化**：从 `rounded-2xl` 升级到 `rounded-3xl`，更加柔和现代
- **阴影增强**：使用 `shadow-xl` 替代 `shadow-lg`，增强卡片层次感
- **完成状态**：完成的任务显示半透明效果（opacity: 0.7）和优雅的划线效果
- **最小高度**：从 120px 增加到 160px，确保内容充分展示

#### 📐 布局结构（从上到下）

##### **顶部区域：时间与标签**
```
左侧                  中间                    右侧
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
开始时间(大)          AI智能标签              持续时间
结束时间(小)          #运营 #创业             *60 min
```

- **左侧时间显示**：
  - 开始时间：2xl 大字体，粗体显示
  - 结束时间：xs 小字体，60%透明度
  
- **中间AI标签**：
  - 自动生成的分类标签（如 #运营、#创业、#ins穿搭账号）
  - 半透明白色背景，圆角胶囊样式
  
- **右侧持续时间**：
  - 粉色高亮显示（#ff69b4）
  - 格式：*XX min

##### **内容主体区域**
```
┌─────────┬──────────────────────────┐
│         │  标题 + AI Emoji 👔      │
│  图片   │  ························ │
│  上传   │  @关联目标               │
│  区域   │                          │
└─────────┴──────────────────────────┘
```

- **左侧图片上传区**：
  - 80x80px 圆角方框
  - 半透明背景，相机图标
  - 点击可上传多张照片
  
- **右侧标题区**：
  - 标题 + AI智能分配的Emoji
  - 虚线分隔
  - @关联目标（如 @挑战早起30天）

##### **功能按钮栏**
```
左侧功能图标                    右侧状态
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
⭐ ⏱️ 📝                      💰50  ⭕
```

- **左侧功能按钮**：
  - ⭐ **AI拆解子任务**：点击展开AI生成的子任务列表
  - ⏱️ **验证设置**：设置开始/完成验证条件
  - 📝 **备注**：添加任务备注
  
- **右侧状态区**：
  - 💰 **金币显示**：智能计算的金币奖励
  - ⭕ **完成圆圈**：点击标记完成，显示勾选效果

##### **操作按钮**
- **Start按钮**：白色圆角按钮，粉色文字 "*start"
- **展开按钮**：小三角图标（▼/▲），控制详情展开

##### **展开详情区**
展开后显示：
1. **子任务列表**
   - 圆形复选框 + 任务文本
   - 完成的任务显示删除线
   - 支持手动添加子任务
   
2. **文件上传区**
   - 大型拖拽区域
   - 虚线边框，半透明背景
   - 支持照片和各种格式文件

---

### 2. 智能金币系统

#### 💰 金币计算规则
```javascript
// 创作型任务：5金币/分钟
创作任务 60分钟 = 300金币

// 成长型任务：10金币/分钟
学习任务 60分钟 = 600金币

// 不良习惯：扣除金币
喝酒 180分钟 = -1800金币
```

#### 显示位置
- 卡片右上角：金币数量徽章
- 金色背景，醒目显示

---

### 3. AI智能功能

#### 🤖 AI智能分配
1. **标签自动生成**：根据任务内容自动分配分类标签
2. **Emoji智能匹配**：根据标题关键词智能选择合适的Emoji
3. **目标自动关联**：智能关联到相关的长期目标
4. **子任务拆解**：点击⭐按钮，AI自动拆解任务为可执行步骤

#### 示例
```
任务：起床穿好衣服
→ AI标签：#生活 #起床
→ AI Emoji：👔
→ 关联目标：@挑战早起30天

任务：做好两套ins穿搭图
→ AI标签：#运营 #ins穿搭账号 #创业
→ AI Emoji：👗
→ 关联目标：@ins穿搭账号100天破1w粉丝
→ AI子任务：
   1. 先收集两套穿搭图
   2. 更收集两套场景动作图
   3. 把穿搭图换成正面站立的动作以及平头
   4. 把服装穿在准备好的模特身上
   5. 使用换好衣服的模特换背景和动作
```

---

### 4. 验证流程

#### 🔒 开始验证
- 设置开始任务前的验证条件
- 支持类型：拍照、定位、无验证
- 验证成功后任务才能正式开始

#### ✅ 完成验证
- 设置完成任务时的验证条件
- 支持类型：上传照片、提交文件、无验证
- 验证通过后才能获得金币奖励

---

### 5. 交互优化

#### 🖱️ 鼠标交互
- **拖拽移动**：按住卡片可拖拽调整时间
- **调整时长**：拖拽底部手柄调整任务时长
- **悬停效果**：所有按钮都有 hover 缩放效果
- **点击展开**：点击展开按钮查看详情

#### 📱 移动端适配
- **响应式布局**：完美适配手机和电脑屏幕
- **触摸优化**：按钮大小适合手指点击
- **滚动流畅**：优化滚动性能

#### 🎨 视觉反馈
- **完成状态**：整体变灰 + 划线效果
- **选中状态**：白色光晕边框
- **拖拽状态**：放大 + 增强阴影

---

### 6. 状态管理

#### 任务状态流转
```
pending (待开始)
    ↓ 点击 start
verification-needed (需要验证)
    ↓ 验证成功
in-progress (进行中)
    ↓ 点击完成
verification-needed (需要验证)
    ↓ 验证成功
completed (已完成)
```

#### 完成效果
- 卡片整体透明度降低（0.7）
- 标题显示删除线
- 白色划线穿过卡片
- 完成圆圈显示勾选图标

---

### 7. 数据联动

#### 🎯 目标进度更新
- 完成任务自动更新关联目标的进度
- 实时同步到目标详情页

#### 💎 成长维度增长
- 根据任务类型增加对应维度的成长值
- 多维度同时增长

#### 💰 金币实时更新
- 完成任务立即获得金币
- 金币变动记录到历史

---

## 🔧 技术实现

### 核心组件
- **TimelineCalendar.tsx**：时间轴主组件
- **TaskVerification.tsx**：任务验证组件
- **TaskExecutionPanel.tsx**：任务执行面板

### 关键功能
```typescript
// AI智能Emoji分配
const getAIEmoji = (title: string) => {
  if (title.includes('起床')) return '👔';
  if (title.includes('ins') || title.includes('穿搭')) return '👗';
  if (title.includes('照相馆') || title.includes('小红书')) return '💄';
  return '📝';
};

// 金币计算
const goldReward = Math.floor((task.durationMinutes || 60) * 2);

// 完成任务
const handleCompleteTask = (taskId: string) => {
  onTaskUpdate(taskId, { 
    status: 'completed',
    actualEnd: new Date().toISOString(),
    goldEarned: goldReward,
  });
  addGold(goldReward, `完成任务: ${task.title}`);
};
```

---

## 📊 性能优化

1. **虚拟滚动**：大量任务时保持流畅
2. **懒加载**：展开详情时才加载子任务
3. **防抖处理**：拖拽操作使用防抖
4. **缓存优化**：AI生成结果缓存复用

---

## 🎯 未来规划

### 即将实现
- [ ] 语音输入创建任务（Kiki语音集成）
- [ ] AI智能推荐最佳时间安排
- [ ] 任务模板库
- [ ] 批量操作功能
- [ ] 数据统计与分析

### 长期规划
- [ ] 团队协作功能
- [ ] 任务分享与导出
- [ ] 第三方日历同步
- [ ] 智能提醒系统

---

## 📝 使用说明

### 创建任务
1. 点击右上角"新建任务"按钮
2. 填写任务信息
3. 设置时间和时长
4. 保存后自动出现在时间轴

### 开始任务
1. 点击任务卡片上的 "*start" 按钮
2. 如有验证要求，完成验证
3. 任务进入进行中状态

### 完成任务
1. 点击右上角的完成圆圈
2. 如有验证要求，完成验证
3. 获得金币奖励
4. 卡片显示完成效果

### 管理子任务
1. 点击 ⭐ 按钮展开子任务
2. 勾选完成的子任务
3. 点击"+ 添加子任务"手动添加

### 上传附件
1. 点击展开按钮
2. 在"拖拽添加文件"区域上传
3. 支持图片、文档等多种格式

---

## 🐛 已知问题

暂无

---

## 💡 反馈与建议

如有任何问题或建议，请联系开发团队。

---

**更新人员**：AI Assistant  
**审核状态**：待审核  
**版本号**：v2.0.0



