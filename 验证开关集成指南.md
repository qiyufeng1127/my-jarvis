# ğŸ”§ éªŒè¯å¼€å…³é›†æˆæŒ‡å—

## ğŸ“‹ åŠŸèƒ½è¯´æ˜

ä¸ºä»»åŠ¡æ·»åŠ "éªŒè¯æµç¨‹å¼€å…³"ï¼Œå®ç°ä»¥ä¸‹é€»è¾‘ï¼š
- âœ… **å¼€å¯éªŒè¯**ï¼šç‚¹å‡» start/å®Œæˆ æŒ‰é’® â†’ è§¦å‘éªŒè¯æµç¨‹ï¼ˆæ‹ç…§ + å€’è®¡æ—¶ï¼‰
- âš¡ **å…³é—­éªŒè¯**ï¼šç‚¹å‡» start/å®Œæˆ æŒ‰é’® â†’ ä»…è®°å½•çœŸå®æ—¶é—´ï¼ˆæ— éªŒè¯ï¼‰

## âœ… å·²å®Œæˆçš„ä»£ç 

### 1. éªŒè¯ç®¡ç†å™¨ï¼ˆå·²å®ç°ï¼‰

**æ–‡ä»¶**ï¼š`src/hooks/useTaskVerificationManager.ts`

å·²å®ç°çš„åŠŸèƒ½ï¼š
- âœ… `manualStartTask(taskId)` - æ‰‹åŠ¨å¼€å§‹ä»»åŠ¡
- âœ… `manualCompleteTask(taskId)` - æ‰‹åŠ¨å®Œæˆä»»åŠ¡
- âœ… å†…ç½®éªŒè¯å¼€å…³åˆ¤æ–­é€»è¾‘

```typescript
// ç¬¬ 70-80 è¡Œï¼šå¯åŠ¨éªŒè¯å¼€å…³åˆ¤æ–­
const handleStartVerification = async (task: Task) => {
  // ğŸ”§ å¼€å…³åˆ¤æ–­
  if (!task.verificationStart) {
    console.log('âš¡ æœªå¼€å¯éªŒè¯å¼€å…³ï¼Œç›´æ¥è®°å½•å¼€å§‹æ—¶é—´');
    await updateTask(task.id, {
      status: 'in_progress',
      actualStart: new Date(),
    });
    return;
  }
  // å¼€å¯äº†éªŒè¯ï¼Œæ‰§è¡ŒéªŒè¯æµç¨‹...
};

// ç¬¬ 160-170 è¡Œï¼šå®ŒæˆéªŒè¯å¼€å…³åˆ¤æ–­
const handleCompleteVerification = async (task: Task) => {
  // ğŸ”§ å¼€å…³åˆ¤æ–­
  if (!task.verificationComplete) {
    console.log('âš¡ æœªå¼€å¯éªŒè¯å¼€å…³ï¼Œç›´æ¥è®°å½•å®Œæˆæ—¶é—´');
    await updateTask(task.id, {
      status: 'completed',
      actualEnd: new Date(),
    });
    return;
  }
  // å¼€å¯äº†éªŒè¯ï¼Œæ‰§è¡ŒéªŒè¯æµç¨‹...
};
```

## ğŸ¯ éœ€è¦é›†æˆçš„ä½ç½®

### åœ¨ä»»åŠ¡å¡ç‰‡ä¸­æ·»åŠ æŒ‰é’®ç‚¹å‡»å¤„ç†

æ‰¾åˆ°æ¸²æŸ“ **start æŒ‰é’®** å’Œ **å®ŒæˆæŒ‰é’®** çš„ç»„ä»¶ï¼Œæ·»åŠ ä»¥ä¸‹ä»£ç ï¼š

```typescript
import { useTaskVerificationManager } from '@/hooks/useTaskVerificationManager';

function YourTaskCard({ task }: { task: Task }) {
  // 1ï¸âƒ£ å¼•å…¥éªŒè¯ç®¡ç†å™¨
  const { manualStartTask, manualCompleteTask } = useTaskVerificationManager();

  // 2ï¸âƒ£ å¤„ç†å¼€å§‹æŒ‰é’®ç‚¹å‡»
  const handleStartClick = async () => {
    console.log('ğŸ¯ ç‚¹å‡»å¼€å§‹æŒ‰é’®:', task.title);
    await manualStartTask(task.id);
  };

  // 3ï¸âƒ£ å¤„ç†å®ŒæˆæŒ‰é’®ç‚¹å‡»
  const handleCompleteClick = async () => {
    console.log('ğŸ¯ ç‚¹å‡»å®ŒæˆæŒ‰é’®:', task.title);
    await manualCompleteTask(task.id);
  };

  return (
    <div className="task-card">
      {/* 4ï¸âƒ£ Start æŒ‰é’® */}
      {task.status === 'scheduled' && (
        <button onClick={handleStartClick}>
          start
        </button>
      )}
      
      {/* 5ï¸âƒ£ å®ŒæˆæŒ‰é’® */}
      {task.status === 'in_progress' && (
        <button onClick={handleCompleteClick}>
          å®Œæˆ
        </button>
      )}
    </div>
  );
}
```

## ğŸ“‚ å¯èƒ½éœ€è¦ä¿®æ”¹çš„æ–‡ä»¶

æ ¹æ®æ‚¨çš„æˆªå›¾ï¼Œstart æŒ‰é’®å¯èƒ½åœ¨ä»¥ä¸‹æ–‡ä»¶ä¸­ï¼š

1. **`src/components/calendar/NewTimelineView.tsx`** - æ—¶é—´è½´è§†å›¾
2. **`src/components/calendar/TaskCard.tsx`** - æ—¥å†ä»»åŠ¡å¡ç‰‡
3. **`src/components/task/TaskCard.tsx`** - é€šç”¨ä»»åŠ¡å¡ç‰‡

### æŸ¥æ‰¾æ–¹æ³•

åœ¨è¿™äº›æ–‡ä»¶ä¸­æœç´¢ï¼š
- `"start"` æŒ‰é’®æ–‡æœ¬
- `onClick` å¤„ç†å‡½æ•°
- ä»»åŠ¡çŠ¶æ€åˆ¤æ–­ `task.status`

## ğŸ” éªŒè¯å¼€å…³çš„æ•°æ®ç»“æ„

ä»»åŠ¡å¯¹è±¡ä¸­çš„éªŒè¯å¼€å…³å­—æ®µï¼š

```typescript
interface Task {
  id: string;
  title: string;
  status: 'scheduled' | 'in_progress' | 'completed';
  
  // ğŸ”§ éªŒè¯å¼€å…³å­—æ®µ
  verificationStart?: {
    enabled: boolean;
    requirement?: string;
    timeout?: number;
  };
  
  verificationComplete?: {
    enabled: boolean;
    requirement?: string;
    timeout?: number;
  };
  
  // å…¶ä»–å­—æ®µ...
}
```

### åˆ¤æ–­é€»è¾‘

```typescript
// åˆ¤æ–­æ˜¯å¦å¼€å¯å¯åŠ¨éªŒè¯
const hasStartVerification = !!task.verificationStart;

// åˆ¤æ–­æ˜¯å¦å¼€å¯å®ŒæˆéªŒè¯
const hasCompleteVerification = !!task.verificationComplete;
```

## ğŸ¨ UI ä¼˜åŒ–å»ºè®®

### æŒ‰é’®æ ·å¼åŒºåˆ†

```typescript
// å¼€å¯éªŒè¯ï¼šæ˜¾ç¤ºç›¸æœºå›¾æ ‡
{task.verificationStart ? (
  <button onClick={handleStartClick}>
    <Camera /> start
  </button>
) : (
  <button onClick={handleStartClick}>
    <Play /> start
  </button>
)}
```

### çŠ¶æ€æç¤º

```typescript
{/* æ˜¾ç¤ºéªŒè¯å¼€å…³çŠ¶æ€ */}
{task.verificationStart && (
  <span className="badge">ğŸ“¸ å¯åŠ¨éªŒè¯</span>
)}
{task.verificationComplete && (
  <span className="badge">ğŸ“¸ å®ŒæˆéªŒè¯</span>
)}
```

## ğŸš€ å·¥ä½œæµç¨‹

### åœºæ™¯ 1ï¼šå¼€å¯éªŒè¯å¼€å…³

```
ç”¨æˆ·ç‚¹å‡» start æŒ‰é’®
    â†“
è°ƒç”¨ manualStartTask(taskId)
    â†“
æ£€æŸ¥ task.verificationStart âœ… å­˜åœ¨
    â†“
è§¦å‘éªŒè¯æµç¨‹ï¼š
  1. æ˜¾ç¤ºå…¨å±éªŒè¯ç•Œé¢
  2. è¦æ±‚æ‹ç…§ä¸Šä¼ 
  3. å¯åŠ¨å€’è®¡æ—¶ï¼ˆ2åˆ†é’Ÿï¼‰
  4. AI éªŒè¯ç…§ç‰‡
    â†“
éªŒè¯é€šè¿‡ â†’ è®°å½• actualStart + å¥–åŠ±é‡‘å¸
éªŒè¯å¤±è´¥ â†’ ä»»åŠ¡å¤±è´¥ + æ‰£é™¤é‡‘å¸
```

### åœºæ™¯ 2ï¼šå…³é—­éªŒè¯å¼€å…³

```
ç”¨æˆ·ç‚¹å‡» start æŒ‰é’®
    â†“
è°ƒç”¨ manualStartTask(taskId)
    â†“
æ£€æŸ¥ task.verificationStart âŒ ä¸å­˜åœ¨
    â†“
ç›´æ¥è®°å½• actualStart
    â†“
ä»»åŠ¡çŠ¶æ€å˜ä¸º in_progress
    â†“
å®Œæˆ âœ…ï¼ˆæ— éªŒè¯æµç¨‹ï¼‰
```

## ğŸ“ æµ‹è¯•æ­¥éª¤

### æµ‹è¯• 1ï¼šå¼€å¯éªŒè¯

1. åˆ›å»ºä»»åŠ¡ï¼Œè®¾ç½® `verificationStart: { enabled: true }`
2. ç‚¹å‡» start æŒ‰é’®
3. **é¢„æœŸ**ï¼šæ˜¾ç¤ºéªŒè¯ç•Œé¢ï¼Œè¦æ±‚æ‹ç…§ âœ…

### æµ‹è¯• 2ï¼šå…³é—­éªŒè¯

1. åˆ›å»ºä»»åŠ¡ï¼Œä¸è®¾ç½® `verificationStart`
2. ç‚¹å‡» start æŒ‰é’®
3. **é¢„æœŸ**ï¼šç›´æ¥å¼€å§‹ä»»åŠ¡ï¼Œæ— éªŒè¯ç•Œé¢ âœ…

### æµ‹è¯• 3ï¼šå®ŒæˆéªŒè¯

1. ä»»åŠ¡è¿›è¡Œä¸­ï¼Œè®¾ç½® `verificationComplete: { enabled: true }`
2. ç‚¹å‡»å®ŒæˆæŒ‰é’®
3. **é¢„æœŸ**ï¼šæ˜¾ç¤ºéªŒè¯ç•Œé¢ âœ…

### æµ‹è¯• 4ï¼šå¿«é€Ÿå®Œæˆ

1. ä»»åŠ¡è¿›è¡Œä¸­ï¼Œä¸è®¾ç½® `verificationComplete`
2. ç‚¹å‡»å®ŒæˆæŒ‰é’®
3. **é¢„æœŸ**ï¼šç›´æ¥å®Œæˆä»»åŠ¡ âœ…

## ğŸ¯ æ ¸å¿ƒä¼˜åŠ¿

1. **ä½ä¾µå…¥**ï¼šåªéœ€åœ¨æŒ‰é’®ç‚¹å‡»å¤„è°ƒç”¨ 2 ä¸ªæ–¹æ³•
2. **é›¶ä¿®æ”¹**ï¼šéªŒè¯é€»è¾‘å·²åœ¨ hook ä¸­å®ç°ï¼Œæ— éœ€ä¿®æ”¹æ ¸å¿ƒä»£ç 
3. **çµæ´»æ§åˆ¶**ï¼šæ¯ä¸ªä»»åŠ¡å¯ç‹¬ç«‹è®¾ç½®éªŒè¯å¼€å…³
4. **å‘åå…¼å®¹**ï¼šä¸å½±å“ç°æœ‰åŠŸèƒ½

## ğŸ“¦ å®Œæ•´ç¤ºä¾‹ä»£ç 

```typescript
import React from 'react';
import { Camera, Play, Check } from 'lucide-react';
import { useTaskVerificationManager } from '@/hooks/useTaskVerificationManager';
import type { Task } from '@/types';

export default function TaskCard({ task }: { task: Task }) {
  const { manualStartTask, manualCompleteTask } = useTaskVerificationManager();

  return (
    <div className="task-card">
      <h3>{task.title}</h3>
      
      {/* éªŒè¯å¼€å…³çŠ¶æ€æç¤º */}
      <div className="badges">
        {task.verificationStart && <span>ğŸ“¸ å¯åŠ¨éªŒè¯</span>}
        {task.verificationComplete && <span>ğŸ“¸ å®ŒæˆéªŒè¯</span>}
      </div>
      
      {/* Start æŒ‰é’® */}
      {task.status === 'scheduled' && (
        <button onClick={() => manualStartTask(task.id)}>
          {task.verificationStart ? <Camera /> : <Play />}
          start
        </button>
      )}
      
      {/* å®ŒæˆæŒ‰é’® */}
      {task.status === 'in_progress' && (
        <button onClick={() => manualCompleteTask(task.id)}>
          {task.verificationComplete ? <Camera /> : <Check />}
          å®Œæˆ
        </button>
      )}
    </div>
  );
}
```

## âœ… ä¸‹ä¸€æ­¥

1. æ‰¾åˆ°æ¸²æŸ“ start æŒ‰é’®çš„ç»„ä»¶æ–‡ä»¶
2. æ·»åŠ  `useTaskVerificationManager` hook
3. å°†æŒ‰é’®çš„ `onClick` è¿æ¥åˆ° `manualStartTask` / `manualCompleteTask`
4. æµ‹è¯•éªŒè¯å¼€å…³åŠŸèƒ½

**æ‰€æœ‰æ ¸å¿ƒé€»è¾‘å·²å®ç°ï¼Œåªéœ€è¿æ¥æŒ‰é’®å³å¯ï¼** ğŸ‰






