# 百度图像识别集成 - 2026年2月9日

## 📋 更新内容

### ✅ 集成百度图像识别API

已成功将百度图像识别API集成到任务验证系统中，实现了**宽松的物体识别验证**。

---

## 🎯 核心功能

### 1. 智能物体识别

系统会自动识别照片中的物体，并与任务关键词进行匹配：

**示例1：厨房任务**
```
任务：洗碗
关键词：厨房、水槽
照片识别到：水槽、碗、筷子、洗洁精
匹配结果：✅ 通过（识别到水槽、碗）
```

**示例2：宠物任务**
```
任务：给猫咪铲粑粑
关键词：猫
照片识别到：猫、猫砂盆、猫粮
匹配结果：✅ 通过（识别到猫）
```

**示例3：工作任务**
```
任务：写代码
关键词：工作区、电脑
照片识别到：电脑、键盘、鼠标、显示器
匹配结果：✅ 通过（识别到电脑）
```

---

### 2. 宽松验证标准

采用**宽松验证标准**，只要照片中包含与任务相关的物品就可以通过：

- ✅ **不需要完全匹配**：只要识别到相关物品即可
- ✅ **支持模糊匹配**：例如"厨房"可以匹配"灶台"、"炉灶"、"橱柜"等
- ✅ **支持多个关键词**：任务可以包含多个关键词，匹配任意一个即可通过

**验证逻辑**：
```
有匹配（confidence > 0） → ✅ 自动通过
无匹配（confidence = 0） → ❌ 自动拒绝
```

---

### 3. 支持的关键词

系统预置了丰富的关键词映射表，涵盖日常生活的各个场景：

#### 厨房相关（16个关键词）
- 厨房、水槽、锅、碗、盘子、调料、冰箱
- 相关物品：灶台、炉灶、油烟机、橱柜、厨具、筷子、勺子、刀、砧板、食材等

#### 厕所相关（5个关键词）
- 厕所、马桶、洗手台、浴室、洗漱
- 相关物品：卫生间、洗手间、洗脸池、水龙头、镜子、淋浴、浴缸、花洒、牙刷、牙膏、毛巾等

#### 卧室相关（3个关键词）
- 卧室、床、衣柜
- 相关物品：床铺、被子、枕头、床单、衣橱、床头柜、台灯、窗帘等

#### 客厅相关（3个关键词）
- 客厅、沙发、电视
- 相关物品：茶几、电视柜、座椅、地毯等

#### 工作区相关（5个关键词）
- 工作区、书桌、电脑、键盘、鼠标
- 相关物品：办公桌、笔记本电脑、台式机、显示器、椅子、台灯、文具等

#### 健身相关（4个关键词）
- 健身房、跑步机、哑铃、瑜伽垫
- 相关物品：杠铃、健身器材、运动等

#### 学习相关（3个关键词）
- 书、笔记本、笔
- 相关物品：书籍、课本、本子、笔记、钢笔、圆珠笔、铅笔、文具等

#### 宠物相关（4个关键词）
- 猫、狗、猫粮、猫砂
- 相关物品：猫咪、狗狗、宠物、宠物食品、宠物用品等

#### 清洁相关（4个关键词）
- 扫把、拖把、垃圾桶、洗衣机
- 相关物品：扫帚、清洁工具、垃圾箱、废纸篓等

#### 食物相关（3个关键词）
- 食物、水果、蔬菜
- 相关物品：食品、菜、饭、面、肉、零食、苹果、香蕉、橙子、葡萄、西瓜、青菜、白菜、萝卜、土豆、番茄等

**总计：50+个关键词，200+个相关物品**

---

## 🔧 技术实现

### 创建的文件

**`src/services/baiduImageService.ts`** - 百度图像识别服务

核心功能：
- `getAccessToken()` - 获取百度API的Access Token
- `recognizeImage()` - 调用百度通用物体识别API
- `extractKeywords()` - 从任务中提取关键词
- `checkMatch()` - 检查识别结果是否匹配任务要求
- `verifyTaskImage()` - 验证任务照片（主入口）
- `addKeywordMapping()` - 添加自定义关键词映射
- `getSupportedKeywords()` - 获取所有支持的关键词

### 修改的文件

**`src/services/aiService.ts`** - AI服务

修改了 `verifyTaskImage()` 方法：
1. 优先尝试使用百度图像识别API
2. 从localStorage读取用户配置的百度API密钥
3. 如果百度API验证失败，降级到AI文本分析
4. 返回更详细的验证结果（包含匹配的关键词和物体）

**`docs/验证功能说明.md`** - 验证功能文档

新增内容：
- 百度图像识别验证流程
- 支持的关键词列表
- 宽松验证标准说明
- 置信度计算方式
- 自定义关键词映射方法
- 百度API配置指南
- 费用说明

---

## 📖 使用指南

### 1. 配置百度API

#### 获取API密钥

1. 访问百度AI开放平台：https://ai.baidu.com/
2. 注册/登录账号
3. 进入控制台 → 创建应用
4. 选择"图像识别" → "通用物体识别"
5. 获取 API Key 和 Secret Key

#### 在系统中配置

在用户设置中填入百度API密钥：

```typescript
// 方式1：通过UI设置（推荐）
// 打开设置页面 → API配置 → 填入密钥

// 方式2：通过代码设置
localStorage.setItem('user-settings', JSON.stringify({
  baiduApiKey: 'your_api_key',
  baiduSecretKey: 'your_secret_key',
  // ... 其他设置
}));
```

---

### 2. 创建带验证的任务

```typescript
const task: Partial<Task> = {
  title: '洗碗',
  description: '清洗今天的碗筷',
  durationMinutes: 15,
  
  // 开始验证：拍摄厨房照片
  verificationStart: {
    type: 'photo',
    requirement: '拍摄厨房水槽的照片',
    timeout: 60
  },
  
  // 完成验证：拍摄洗好的碗
  verificationComplete: {
    type: 'photo',
    requirement: '拍摄洗好的碗筷',
    timeout: 60
  }
};
```

---

### 3. 验证流程

```
用户点击"开始任务"
    ↓
系统要求拍照（60秒内）
    ↓
用户拍摄厨房照片
    ↓
系统调用百度图像识别API
    ↓
识别结果：水槽、碗、筷子、洗洁精
    ↓
提取任务关键词：厨房、水槽
    ↓
匹配检查：
  - 厨房 ✅（识别到水槽、碗等厨房物品）
  - 水槽 ✅（识别到水槽）
    ↓
验证通过 ✅
    ↓
任务开始计时
```

---

### 4. 验证结果示例

#### 成功示例

```typescript
{
  success: true,
  isValid: true,
  confidence: 1.0,
  reason: '✅ 照片验证通过！识别到与任务相关的物体：水槽、碗',
  matchedKeywords: ['厨房', '水槽'],
  matchedObjects: ['水槽', '碗'],
  recognizedObjects: ['水槽', '碗', '筷子', '洗洁精', '水龙头']
}
```

#### 失败示例

```typescript
{
  success: true,
  isValid: false,
  confidence: 0,
  reason: '❌ 照片验证失败。任务要求包含：厨房、水槽，但照片中未识别到相关物体。识别到的物体：沙发、电视、茶几、遥控器、窗帘',
  matchedKeywords: [],
  matchedObjects: [],
  recognizedObjects: ['沙发', '电视', '茶几', '遥控器', '窗帘']
}
```

---

## 💡 使用技巧

### 1. 任务命名技巧

在任务标题中包含关键词，系统会自动识别：

✅ **好的命名**：
- "洗碗" - 自动识别关键词：厨房、水槽、碗
- "给猫咪铲粑粑" - 自动识别关键词：猫
- "在工作区写代码" - 自动识别关键词：工作区、电脑

❌ **不好的命名**：
- "做家务" - 太笼统，无法提取关键词
- "完成任务" - 没有具体内容

### 2. 拍照技巧

拍照时确保包含相关物品：

✅ **好的照片**：
- 清晰可见
- 包含任务相关物品
- 光线充足

❌ **不好的照片**：
- 模糊不清
- 角度太偏
- 光线太暗

### 3. 自定义关键词

如果需要添加自定义关键词：

```typescript
import { baiduImageService } from '@/services/baiduImageService';

// 添加"拍摄间"关键词
baiduImageService.addKeywordMapping('拍摄间', [
  '摄影棚', '相机', '三脚架', '灯光', '背景布', '摄影器材'
]);

// 添加"照相馆"关键词
baiduImageService.addKeywordMapping('照相馆', [
  '照相馆', '相机', '摄影', '照片', '相框'
]);
```

---

## 🔍 调试信息

系统会在控制台输出详细的调试信息：

```
🔍 [百度验证] 开始验证任务照片
🔍 [百度验证] 任务: 洗碗
🔍 [百度验证] 要求: 拍摄厨房水槽的照片
✅ [百度API] Access Token获取成功
✅ [百度API] 图像识别成功，识别到 5 个物体
🔍 [百度API] 识别结果: 水槽(0.95), 碗(0.88), 筷子(0.82), 洗洁精(0.76), 水龙头(0.91)
🔍 [关键词提取] 任务: 洗碗
🔍 [关键词提取] 提取到的关键词: 厨房, 水槽, 碗
🎯 [匹配结果] 是否匹配: true
🎯 [匹配结果] 匹配的关键词: 厨房, 水槽, 碗
🎯 [匹配结果] 匹配的物体: 水槽, 碗
🎯 [匹配结果] 置信度: 100%
```

---

## 💰 费用说明

### 百度图像识别API

- **免费额度**：每天500次
- **超出后**：按次计费，约0.002元/次
- **详情**：https://ai.baidu.com/ai-doc/IMAGERECOGNITION/price

### 成本估算

假设每天完成10个带验证的任务（开始+完成=20次验证）：
- 每月验证次数：20次/天 × 30天 = 600次
- 免费额度：500次/天 × 30天 = 15000次
- 实际费用：0元（完全在免费额度内）

---

## 🎯 优势对比

### 百度图像识别 vs AI文本分析

| 特性 | 百度图像识别 | AI文本分析 |
|------|-------------|-----------|
| 识别准确度 | ⭐⭐⭐⭐⭐ 非常高 | ⭐⭐⭐ 中等 |
| 验证速度 | ⚡ 1-2秒 | 🐌 5-10秒 |
| 成本 | 💰 免费额度充足 | 💰💰 按token计费 |
| 验证标准 | 🎯 宽松（有匹配即通过） | 🎯 严格（需要高置信度） |
| 支持场景 | 📸 日常生活场景 | 📸 所有场景 |
| 配置难度 | ⚙️ 简单（只需API密钥） | ⚙️ 复杂（需要OpenAI等） |

**推荐使用百度图像识别**，因为：
1. ✅ 识别准确度更高
2. ✅ 验证速度更快
3. ✅ 免费额度充足
4. ✅ 验证标准宽松，不会太严格
5. ✅ 配置简单

---

## 🐛 常见问题

### Q1: 为什么验证失败？

**可能原因**：
1. 照片中没有包含任务相关的物品
2. 照片太模糊，无法识别
3. 光线太暗，影响识别
4. 百度API配置错误

**解决方法**：
1. 重新拍照，确保包含相关物品
2. 拍照时保持清晰
3. 选择光线充足的环境
4. 检查百度API配置是否正确

### Q2: 如何查看识别结果？

打开浏览器控制台（F12），查看调试信息：
```
🔍 [百度API] 识别结果: 水槽(0.95), 碗(0.88), 筷子(0.82)
```

### Q3: 可以添加自定义关键词吗？

可以！使用 `addKeywordMapping()` 方法：
```typescript
baiduImageService.addKeywordMapping('自定义关键词', ['相关物品1', '相关物品2']);
```

### Q4: 验证标准太严格怎么办？

百度图像识别已经采用**宽松验证标准**，只要照片中包含任务相关的物品就可以通过。如果还是觉得太严格，可以：
1. 在任务标题中使用更宽泛的关键词
2. 拍照时尽量包含多个相关物品
3. 添加自定义关键词映射

### Q5: 百度API额度用完了怎么办？

1. 免费额度：每天500次，对于个人使用完全足够
2. 如果用完了，可以：
   - 等待第二天（额度会重置）
   - 购买付费套餐（很便宜，约0.002元/次）
   - 系统会自动降级到AI文本分析

---

## 📚 相关文档

- [验证功能说明](./验证功能说明.md) - 完整的验证功能文档
- [百度AI开放平台](https://ai.baidu.com/) - 获取API密钥
- [百度图像识别文档](https://ai.baidu.com/ai-doc/IMAGERECOGNITION/Xk3bcxe21) - API文档

---

**更新时间**：2026年2月9日  
**更新人员**：AI Assistant  
**版本号**：v1.2.0




