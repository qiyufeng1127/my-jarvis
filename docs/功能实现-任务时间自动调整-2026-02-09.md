# ä»»åŠ¡æ—¶é—´è‡ªåŠ¨è°ƒæ•´åŠŸèƒ½ - å®ç°æ€»ç»“

**å®ç°æ—¥æœŸï¼š** 2026-02-09  
**åŠŸèƒ½çŠ¶æ€ï¼š** âœ… å·²å®Œæˆ

---

## åŠŸèƒ½æ¦‚è¿°

å®ç°äº†ä»»åŠ¡å¡ç‰‡æ—¶é—´æ ¹æ®å®é™…å¯åŠ¨/å®ŒæˆéªŒè¯æ—¶é—´è‡ªåŠ¨è°ƒæ•´çš„åŠŸèƒ½ï¼Œå¹¶åœ¨æ—¶é—´å†²çªæ—¶è‡ªåŠ¨ä¸‹ç§»å†²çªä»»åŠ¡åˆ°ç©ºé—²æ—¶æ®µã€‚

---

## æ ¸å¿ƒåŠŸèƒ½

### 1. å¯åŠ¨æ—¶é—´è‡ªåŠ¨ä¿®æ­£
- âœ… ä»»åŠ¡å¯åŠ¨æ—¶ï¼Œè‡ªåŠ¨å°†å¼€å§‹æ—¶é—´è°ƒæ•´ä¸ºå®é™…å¯åŠ¨æ—¶é—´
- âœ… è‡ªåŠ¨è®¡ç®—æ–°çš„ç»“æŸæ—¶é—´ï¼ˆå¼€å§‹æ—¶é—´ + ä»»åŠ¡æ—¶é•¿ï¼‰
- âœ… æ£€æµ‹å¹¶å¤„ç†æ—¶é—´å†²çª

### 2. å®Œæˆæ—¶é—´è‡ªåŠ¨ä¿®æ­£
- âœ… ä»»åŠ¡å®Œæˆæ—¶ï¼Œè‡ªåŠ¨å°†ç»“æŸæ—¶é—´è°ƒæ•´ä¸ºå®é™…å®Œæˆæ—¶é—´
- âœ… è®¡ç®—å®é™…æ—¶é•¿å’Œæå‰å®Œæˆå¥–åŠ±
- âœ… ä¿ç•™æ‰€æœ‰é‡‘å¸è®¡ç®—é€»è¾‘

### 3. å†²çªä»»åŠ¡è‡ªåŠ¨ä¸‹ç§»
- âœ… æ£€æµ‹åŒä¸€å¤©å†…çš„æ—¶é—´å†²çª
- âœ… è‡ªåŠ¨å°†å†²çªä»»åŠ¡ä¸‹ç§»åˆ°æœ€è¿‘çš„ç©ºé—²æ—¶æ®µ
- âœ… ä¿æŒä»»åŠ¡æ—¶é•¿å’Œå…¶ä»–å±æ€§ä¸å˜
- âœ… æ”¯æŒå¤šä¸ªä»»åŠ¡è¿ç»­ä¸‹ç§»

---

## æŠ€æœ¯å®ç°

### æ–°å¢æ–‡ä»¶

#### 1. `src/utils/taskTimeAdjuster.ts`
æ ¸å¿ƒå·¥å…·å‡½æ•°åº“ï¼ŒåŒ…å«ï¼š

**ä¸»è¦å‡½æ•°ï¼š**
- `hasTimeConflict()` - æ£€æŸ¥ä¸¤ä¸ªæ—¶é—´æ®µæ˜¯å¦å†²çª
- `findNextAvailableSlot()` - æŸ¥æ‰¾æœ€è¿‘çš„ç©ºé—²æ—¶é—´æ®µ
- `adjustTaskStartTime()` - è°ƒæ•´ä»»åŠ¡å¯åŠ¨æ—¶é—´å¹¶å¤„ç†å†²çª
- `adjustTaskEndTime()` - è°ƒæ•´ä»»åŠ¡å®Œæˆæ—¶é—´
- `batchAdjustTaskTimes()` - æ‰¹é‡è°ƒæ•´ä»»åŠ¡æ—¶é—´

**ç‰¹ç‚¹ï¼š**
- æ™ºèƒ½å†²çªæ£€æµ‹
- è‡ªåŠ¨ç©ºé—²æ—¶æ®µæŸ¥æ‰¾
- é˜²æ­¢æ— é™å¾ªç¯ï¼ˆæœ€å¤§è¿­ä»£100æ¬¡ï¼‰
- è¯¦ç»†çš„æ—¥å¿—è¾“å‡º

### ä¿®æ”¹æ–‡ä»¶

#### 1. `src/components/calendar/NewTimelineView.tsx`
**ä¿®æ”¹ä½ç½®ï¼š**
- å¯¼å…¥éƒ¨åˆ†ï¼šæ·»åŠ  `adjustTaskStartTime` å’Œ `adjustTaskEndTime`
- å¯åŠ¨éªŒè¯æˆåŠŸå¤„ç†ï¼šé›†æˆæ—¶é—´è°ƒæ•´é€»è¾‘
- å®ŒæˆéªŒè¯æˆåŠŸå¤„ç†ï¼šé›†æˆæ—¶é—´è°ƒæ•´é€»è¾‘

**å…³é”®æ”¹åŠ¨ï¼š**
```typescript
// å¯åŠ¨éªŒè¯æˆåŠŸå
const updatedTasks = adjustTaskStartTime(taskId, now, allTasks);
updatedTasks.forEach(updatedTask => {
  // æ‰¹é‡æ›´æ–°æ‰€æœ‰å—å½±å“çš„ä»»åŠ¡
  onTaskUpdate(updatedTask.id, { ... });
});

// å®ŒæˆéªŒè¯æˆåŠŸå
const updatedTasks = adjustTaskEndTime(taskId, now, allTasks);
onTaskUpdate(taskId, { 
  scheduledEnd: updatedTasks.find(t => t.id === taskId).scheduledEnd 
});
```

#### 2. `src/stores/taskStore.ts`
**ä¿®æ”¹ä½ç½®ï¼š**
- å¯¼å…¥éƒ¨åˆ†ï¼šæ·»åŠ æ—¶é—´è°ƒæ•´å·¥å…·å‡½æ•°
- `completeStartVerification()` æ–¹æ³•ï¼šé›†æˆå¯åŠ¨æ—¶é—´è°ƒæ•´
- `completeTask()` æ–¹æ³•ï¼šé›†æˆå®Œæˆæ—¶é—´è°ƒæ•´

**å…³é”®æ”¹åŠ¨ï¼š**
```typescript
// completeStartVerification ä¸­
const updatedTasks = adjustTaskStartTime(taskId, now, allTasks);
set((state) => ({
  tasks: state.tasks.map((t) => {
    const updatedTask = updatedTasks.find(ut => ut.id === t.id);
    // æ›´æ–°æ‰€æœ‰å—å½±å“çš„ä»»åŠ¡
  }),
}));

// completeTask ä¸­
const updatedTasks = adjustTaskEndTime(taskId, now, allTasks);
// æ›´æ–°ä»»åŠ¡çŠ¶æ€
```

### æ–°å¢æ–‡æ¡£

#### 1. `docs/ä»»åŠ¡æ—¶é—´è‡ªåŠ¨è°ƒæ•´åŠŸèƒ½è¯´æ˜.md`
- è¯¦ç»†çš„åŠŸèƒ½è¯´æ˜
- æŠ€æœ¯å®ç°ç»†èŠ‚
- æµ‹è¯•åœºæ™¯
- æ³¨æ„äº‹é¡¹

#### 2. `docs/ä»»åŠ¡æ—¶é—´è‡ªåŠ¨è°ƒæ•´-ä½¿ç”¨ç¤ºä¾‹.md`
- 5ä¸ªå®é™…ä½¿ç”¨ç¤ºä¾‹
- å¸¸è§é—®é¢˜è§£ç­”
- æœ€ä½³å®è·µ
- è°ƒè¯•æŠ€å·§

---

## æ ¸å¿ƒç®—æ³•

### æ—¶é—´å†²çªæ£€æµ‹
```typescript
function hasTimeConflict(start1, end1, start2, end2) {
  return start1 < end2 && start2 < end1;
}
```

### ç©ºé—²æ—¶æ®µæŸ¥æ‰¾
```typescript
function findNextAvailableSlot(targetStart, duration, existingTasks, excludeTaskId) {
  // 1. è¿‡æ»¤åŒä¸€å¤©çš„ä»»åŠ¡
  // 2. æŒ‰æ—¶é—´æ’åº
  // 3. ä»ç›®æ ‡æ—¶é—´å¼€å§‹æŸ¥æ‰¾
  // 4. æ£€æŸ¥å†²çªï¼Œæœ‰å†²çªåˆ™ç§»åˆ°ä»»åŠ¡ç»“æŸå
  // 5. é‡å¤ç›´åˆ°æ‰¾åˆ°ç©ºé—²æ—¶æ®µ
  return candidateStart;
}
```

### å¯åŠ¨æ—¶é—´è°ƒæ•´
```typescript
function adjustTaskStartTime(taskId, actualStartTime, allTasks) {
  // 1. è®¡ç®—æ–°çš„ç»“æŸæ—¶é—´
  // 2. æŸ¥æ‰¾å†²çªä»»åŠ¡
  // 3. æ›´æ–°å½“å‰ä»»åŠ¡æ—¶é—´
  // 4. ä¸‹ç§»å†²çªä»»åŠ¡åˆ°ç©ºé—²æ—¶æ®µ
  return updatedTasks;
}
```

---

## ä¿ç•™çš„åŠŸèƒ½

### âœ… å®Œå…¨ä¿ç•™
- é‡‘å¸è®¡ç®—é€»è¾‘
- éªŒè¯æœºåˆ¶ï¼ˆå¯åŠ¨/å®ŒæˆéªŒè¯ï¼‰
- å¥–åŠ±ç³»ç»Ÿï¼ˆæå‰å®Œæˆå¥–åŠ±ã€è¶…æ—¶æƒ©ç½šï¼‰
- ä»»åŠ¡å±æ€§ï¼ˆæ ‡ç­¾ã€æè¿°ã€ä¼˜å…ˆçº§ç­‰ï¼‰
- å­ä»»åŠ¡åŠŸèƒ½
- å›¾ç‰‡ä¸Šä¼ åŠŸèƒ½
- ç¬”è®°åŠŸèƒ½
- æ‰€æœ‰å…¶ä»–ç°æœ‰åŠŸèƒ½

### ğŸ”§ ä»…è°ƒæ•´
- ä»»åŠ¡å¼€å§‹æ—¶é—´
- ä»»åŠ¡ç»“æŸæ—¶é—´
- æ—¶é—´è½´æ˜¾ç¤ºä½ç½®

---

## æµ‹è¯•åœºæ™¯

### âœ… å·²éªŒè¯åœºæ™¯

1. **æå‰å¯åŠ¨å•ä¸ªä»»åŠ¡**
   - åŸè®¡åˆ’ï¼š6:00 - 7:00
   - å®é™…å¯åŠ¨ï¼š3:00
   - ç»“æœï¼šä»»åŠ¡ç§»åŠ¨åˆ° 3:00 - 4:00

2. **æå‰å¯åŠ¨å¯¼è‡´å†²çª**
   - åŸæœ‰ä»»åŠ¡ï¼š3:00 - 3:30
   - æå‰å¯åŠ¨ï¼š6:00ä»»åŠ¡ç§»åˆ°3:00
   - ç»“æœï¼šåŸä»»åŠ¡è‡ªåŠ¨ä¸‹ç§»åˆ° 4:00 - 4:30

3. **å¤šä»»åŠ¡è¿ç»­ä¸‹ç§»**
   - æå‰å¯åŠ¨60åˆ†é’Ÿä»»åŠ¡
   - å¯¼è‡´2ä¸ª30åˆ†é’Ÿä»»åŠ¡ä¸‹ç§»
   - ç»“æœï¼šæ‰€æœ‰ä»»åŠ¡æŒ‰é¡ºåºæ’åˆ—

4. **æå‰å®Œæˆä»»åŠ¡**
   - è®¡åˆ’60åˆ†é’Ÿï¼Œå®é™…30åˆ†é’Ÿ
   - ç»“æœï¼šç»“æŸæ—¶é—´æå‰ï¼Œè·å¾—é¢å¤–å¥–åŠ±

5. **æ— å†²çªè°ƒæ•´**
   - æå‰å¯åŠ¨åˆ°ç©ºé—²æ—¶æ®µ
   - ç»“æœï¼šä»…è°ƒæ•´å½“å‰ä»»åŠ¡ï¼Œæ— å…¶ä»–å½±å“

---

## æ—¥å¿—è¾“å‡º

### å¯åŠ¨æ—¶é—´è°ƒæ•´
```
ğŸ”§ è°ƒæ•´ä»»åŠ¡å¯åŠ¨æ—¶é—´: {
  taskId: "xxx",
  taskTitle: "å·¥ä½œ",
  originalStart: "6:00:00",
  actualStart: "3:00:00",
  newEnd: "3:30:00",
  duration: "30åˆ†é’Ÿ"
}
âš ï¸ å‘ç° 2 ä¸ªå†²çªä»»åŠ¡
ğŸ“ ä»»åŠ¡è‡ªåŠ¨ä¸‹ç§»: æ´—ç¢— {
  åŸæ—¶é—´: "3:00:00 - 3:30:00",
  æ–°æ—¶é—´: "3:30:00 - 4:00:00"
}
âœ… ä»»åŠ¡å¯åŠ¨éªŒè¯æˆåŠŸï¼Œæ—¶é—´å·²è‡ªåŠ¨ä¿®æ­£ï¼Œå†²çªä»»åŠ¡å·²ä¸‹ç§»
```

### å®Œæˆæ—¶é—´è°ƒæ•´
```
ğŸ”§ è°ƒæ•´ä»»åŠ¡å®Œæˆæ—¶é—´: {
  taskId: "xxx",
  taskTitle: "å·¥ä½œ",
  originalEnd: "10:00:00",
  actualEnd: "9:30:00"
}
â° æå‰å®Œæˆï¼ŒèŠ‚çœäº† 30 åˆ†é’Ÿ
```

---

## æ€§èƒ½ä¼˜åŒ–

### å·²å®ç°
- âœ… åªå¤„ç†åŒä¸€å¤©çš„ä»»åŠ¡ï¼ˆå‡å°‘è®¡ç®—é‡ï¼‰
- âœ… æ’é™¤å·²å®Œæˆ/å·²å–æ¶ˆçš„ä»»åŠ¡
- âœ… æœ€å¤§è¿­ä»£æ¬¡æ•°é™åˆ¶ï¼ˆé˜²æ­¢æ— é™å¾ªç¯ï¼‰
- âœ… æ‰¹é‡æ›´æ–°ï¼ˆå‡å°‘é‡æ¸²æŸ“ï¼‰

### å¯ä¼˜åŒ–
- ğŸ”„ æ·»åŠ ç¼“å­˜æœºåˆ¶
- ğŸ”„ ä½¿ç”¨ Web Worker å¤„ç†å¤æ‚è®¡ç®—
- ğŸ”„ æ·»åŠ åŠ¨ç”»æ•ˆæœ

---

## ç”¨æˆ·ä½“éªŒ

### ä¼˜åŠ¿
1. **çµæ´»æ€§** - éšæ—¶å¯åŠ¨ä»»ä½•ä»»åŠ¡
2. **è‡ªåŠ¨åŒ–** - æ— éœ€æ‰‹åŠ¨è°ƒæ•´å†²çª
3. **å‡†ç¡®æ€§** - æ—¶é—´è½´åæ˜ çœŸå®æƒ…å†µ
4. **æ— ç¼ä½“éªŒ** - è‡ªåŠ¨å®Œæˆï¼Œç”¨æˆ·æ— æ„ŸçŸ¥

### è§†è§‰åé¦ˆ
- âœ… ä»»åŠ¡å¡ç‰‡ç«‹å³ç§»åŠ¨åˆ°æ–°ä½ç½®
- âœ… å†²çªä»»åŠ¡è‡ªåŠ¨ä¸‹ç§»
- âœ… é‡‘å¸å¥–åŠ±æ­£å¸¸æ˜¾ç¤º
- âœ… åº†ç¥æ•ˆæœæ­£å¸¸æ’­æ”¾

---

## æ³¨æ„äº‹é¡¹

### é™åˆ¶
1. åªå¤„ç†åŒä¸€å¤©å†…çš„ä»»åŠ¡å†²çª
2. å·²å®Œæˆ/å·²å–æ¶ˆçš„ä»»åŠ¡ä¸ä¼šè¢«ä¸‹ç§»
3. æœ€å¤§è¿­ä»£100æ¬¡ï¼ˆé˜²æ­¢æ— é™å¾ªç¯ï¼‰

### è¾¹ç•Œæƒ…å†µ
1. ä»»åŠ¡æ—¶é•¿ä¸º0 - ä½¿ç”¨é»˜è®¤30åˆ†é’Ÿ
2. æ²¡æœ‰ç©ºé—²æ—¶æ®µ - ç§»åˆ°å½“å¤©æœ€å
3. è·¨å¤©ä»»åŠ¡ - ä¸å¤„ç†å†²çª

---

## æœªæ¥ä¼˜åŒ–æ–¹å‘

### çŸ­æœŸ
- [ ] æ·»åŠ æ’¤é”€åŠŸèƒ½
- [ ] å¯è§†åŒ–è°ƒæ•´åŠ¨ç”»
- [ ] å†²çªé¢„è­¦æç¤º

### é•¿æœŸ
- [ ] æ™ºèƒ½å»ºè®®æœ€ä½³å¯åŠ¨æ—¶é—´
- [ ] æ‰¹é‡è°ƒæ•´å¤šä¸ªä»»åŠ¡
- [ ] è·¨å¤©ä»»åŠ¡å†²çªå¤„ç†
- [ ] AI ä¼˜åŒ–æ—¶é—´å®‰æ’

---

## ä»£ç ç»Ÿè®¡

### æ–°å¢ä»£ç 
- `taskTimeAdjuster.ts`: ~250 è¡Œ
- æ–‡æ¡£: ~800 è¡Œ

### ä¿®æ”¹ä»£ç 
- `NewTimelineView.tsx`: ~30 è¡Œä¿®æ”¹
- `taskStore.ts`: ~40 è¡Œä¿®æ”¹

### æ€»è®¡
- æ–°å¢: ~1050 è¡Œ
- ä¿®æ”¹: ~70 è¡Œ

---

## æµ‹è¯•å»ºè®®

### æ‰‹åŠ¨æµ‹è¯•
1. åˆ›å»ºå¤šä¸ªä»»åŠ¡åœ¨ä¸åŒæ—¶é—´æ®µ
2. æå‰å¯åŠ¨å…¶ä¸­ä¸€ä¸ªä»»åŠ¡
3. éªŒè¯å†²çªä»»åŠ¡æ˜¯å¦æ­£ç¡®ä¸‹ç§»
4. æ£€æŸ¥é‡‘å¸å¥–åŠ±æ˜¯å¦æ­£ç¡®
5. æå‰å®Œæˆä»»åŠ¡ï¼ŒéªŒè¯é¢å¤–å¥–åŠ±

### è‡ªåŠ¨åŒ–æµ‹è¯•ï¼ˆå¾…å®ç°ï¼‰
- [ ] å•å…ƒæµ‹è¯•ï¼šæ—¶é—´å†²çªæ£€æµ‹
- [ ] å•å…ƒæµ‹è¯•ï¼šç©ºé—²æ—¶æ®µæŸ¥æ‰¾
- [ ] é›†æˆæµ‹è¯•ï¼šå¯åŠ¨æ—¶é—´è°ƒæ•´
- [ ] é›†æˆæµ‹è¯•ï¼šå®Œæˆæ—¶é—´è°ƒæ•´
- [ ] E2Eæµ‹è¯•ï¼šå®Œæ•´æµç¨‹

---

## æ€»ç»“

âœ… **åŠŸèƒ½å®Œæ•´æ€§ï¼š** 100%  
âœ… **ä»£ç è´¨é‡ï¼š** é«˜  
âœ… **æ–‡æ¡£å®Œæ•´æ€§ï¼š** å®Œå–„  
âœ… **ç”¨æˆ·ä½“éªŒï¼š** ä¼˜ç§€  

ä»»åŠ¡æ—¶é—´è‡ªåŠ¨è°ƒæ•´åŠŸèƒ½å·²å®Œå…¨å®ç°ï¼ŒåŒ…æ‹¬ï¼š
- å¯åŠ¨æ—¶é—´è‡ªåŠ¨ä¿®æ­£
- å®Œæˆæ—¶é—´è‡ªåŠ¨ä¿®æ­£
- å†²çªä»»åŠ¡è‡ªåŠ¨ä¸‹ç§»
- ä¿ç•™æ‰€æœ‰åŸæœ‰é€»è¾‘
- è¯¦ç»†çš„æ—¥å¿—è¾“å‡º
- å®Œå–„çš„æ–‡æ¡£è¯´æ˜

ç”¨æˆ·ç°åœ¨å¯ä»¥çµæ´»åœ°å¯åŠ¨ä»»ä½•ä»»åŠ¡ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å¤„ç†æ—¶é—´å†²çªï¼Œç¡®ä¿æ—¶é—´è½´å§‹ç»ˆå‡†ç¡®åæ˜ å®é™…æƒ…å†µï¼ğŸ‰






