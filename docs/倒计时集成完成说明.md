# å€’è®¡æ—¶é›†æˆå®Œæˆè¯´æ˜

## âœ… å·²å®Œæˆçš„é›†æˆå·¥ä½œ

### 1. å¯¼å…¥å¿…è¦çš„æ¨¡å—
- âœ… å¯¼å…¥ `TaskCountdown` ç»„ä»¶
- âœ… å¯¼å…¥ `useTaskStore` åŠå…¶å€’è®¡æ—¶æ–¹æ³•

### 2. æ·»åŠ å€’è®¡æ—¶ç®¡ç†æ–¹æ³•
åœ¨ NewTimelineView.tsx ä¸­æ·»åŠ äº†ä»¥ä¸‹æ–¹æ³•ï¼š
```typescript
const { startStartVerificationCountdown, startCompletionCountdown, checkCountdownTimeout } = useTaskStore();
```

### 3. ä»»åŠ¡å¼€å§‹æ—¶å¯åŠ¨å€’è®¡æ—¶

#### 3.1 æ— éªŒè¯æ¨¡å¼ï¼ˆç¬¬878-883è¡Œï¼‰
```typescript
} else {
  // ä¸éœ€è¦éªŒè¯ï¼Œç›´æ¥å¼€å§‹
  onTaskUpdate(taskId, { status: 'in_progress' });
  
  // å¯åŠ¨å¼€å§‹éªŒè¯å€’è®¡æ—¶ï¼ˆ2åˆ†é’Ÿï¼‰
  startStartVerificationCountdown(taskId);
}
```

#### 3.2 æœ‰éªŒè¯æ¨¡å¼ï¼ˆç¬¬1043è¡Œï¼‰
åœ¨å¼€å§‹éªŒè¯æˆåŠŸåï¼š
```typescript
console.log('âœ… ä»»åŠ¡å¼€å§‹éªŒè¯æˆåŠŸï¼Œæ—¶é—´å·²è‡ªåŠ¨è°ƒæ•´ï¼Œå†²çªå·²è§£å†³ï¼');

// å¯åŠ¨å®Œæˆå€’è®¡æ—¶
startCompletionCountdown(taskId);
```

### 4. ä»»åŠ¡å®Œæˆæ—¶æ£€æŸ¥å€’è®¡æ—¶ï¼ˆç¬¬1212è¡Œï¼‰
```typescript
// æ£€æŸ¥å€’è®¡æ—¶æ˜¯å¦è¶…æ—¶
const timeoutResult = checkCountdownTimeout(taskId);
```

### 5. UI é›†æˆ - æ˜¾ç¤ºå€’è®¡æ—¶ç»„ä»¶ï¼ˆç¬¬1915-1921è¡Œï¼‰
```typescript
{/* å€’è®¡æ—¶æ˜¾ç¤º */}
{block.status === 'in_progress' && (
  <div className="mb-1">
    <TaskCountdown taskId={block.id} />
  </div>
)}
```

## ğŸ¯ åŠŸèƒ½è¯´æ˜

### å€’è®¡æ—¶æµç¨‹

1. **ç‚¹å‡» Start æŒ‰é’®**
   - ä»»åŠ¡çŠ¶æ€å˜ä¸º `in_progress`
   - å¯åŠ¨ 2 åˆ†é’Ÿå¼€å§‹éªŒè¯å€’è®¡æ—¶
   - æ˜¾ç¤ºç»¿è‰²å€’è®¡æ—¶æ¡

2. **2 åˆ†é’Ÿå†…å®Œæˆå¼€å§‹éªŒè¯**
   - å€’è®¡æ—¶åœæ­¢
   - å¯åŠ¨ä»»åŠ¡å®Œæˆå€’è®¡æ—¶ï¼ˆåŸºäºä»»åŠ¡æ—¶é•¿ï¼‰
   - å€’è®¡æ—¶æ¡å˜ä¸ºè“è‰²

3. **è¶…è¿‡ 2 åˆ†é’ŸæœªéªŒè¯**
   - å€’è®¡æ—¶å˜çº¢
   - æ ‡è®°ä¸ºè¿Ÿåˆ°å¼€å§‹ï¼ˆ`isStartOvertime: true`ï¼‰
   - å®Œæˆæ—¶é‡‘å¸å¥–åŠ±æ‰£é™¤ 30%

4. **ä»»åŠ¡å®Œæˆ**
   - æ£€æŸ¥æ˜¯å¦è¶…æ—¶å®Œæˆ
   - å¦‚æœè¶…æ—¶ï¼šé‡‘å¸å¥–åŠ±ä¸º 0
   - å¦‚æœæŒ‰æ—¶ï¼šæ ¹æ®å®é™…æ—¶é•¿è®¡ç®—é‡‘å¸

### å€’è®¡æ—¶é¢œè‰²è§„åˆ™

- **ç»¿è‰²**ï¼šå‰©ä½™æ—¶é—´ > 50%
- **æ©™è‰²**ï¼šå‰©ä½™æ—¶é—´ 20%-50%
- **çº¢è‰²**ï¼šå‰©ä½™æ—¶é—´ < 20% æˆ–å·²è¶…æ—¶

### é‡‘å¸è®¡ç®—è§„åˆ™

1. **åŸºç¡€ä»»åŠ¡**ï¼šå®é™…åˆ†é’Ÿæ•° Ã— 10 é‡‘å¸/åˆ†é’Ÿ
2. **ç«™ç«‹ä»»åŠ¡**ï¼šå®é™…åˆ†é’Ÿæ•° Ã— 15 é‡‘å¸/åˆ†é’Ÿ
3. **è¿Ÿåˆ°å¼€å§‹**ï¼šæ‰£é™¤ 30%
4. **è¶…æ—¶å®Œæˆ**ï¼š0 é‡‘å¸

## ğŸ§ª æµ‹è¯•å»ºè®®

### æµ‹è¯•åœºæ™¯ 1ï¼šæ­£å¸¸æµç¨‹
1. åˆ›å»ºä¸€ä¸ª 10 åˆ†é’Ÿçš„ä»»åŠ¡
2. ç‚¹å‡» Start æŒ‰é’®
3. è§‚å¯Ÿ 2 åˆ†é’Ÿå€’è®¡æ—¶ï¼ˆç»¿è‰²ï¼‰
4. åœ¨ 2 åˆ†é’Ÿå†…å®Œæˆå¼€å§‹éªŒè¯
5. è§‚å¯Ÿä»»åŠ¡å®Œæˆå€’è®¡æ—¶ï¼ˆ10 åˆ†é’Ÿï¼Œè“è‰²ï¼‰
6. æŒ‰æ—¶å®Œæˆä»»åŠ¡
7. éªŒè¯é‡‘å¸ï¼š10 åˆ†é’Ÿ Ã— 10 = 100 é‡‘å¸

### æµ‹è¯•åœºæ™¯ 2ï¼šè¿Ÿåˆ°å¼€å§‹
1. åˆ›å»ºä¸€ä¸ª 10 åˆ†é’Ÿçš„ä»»åŠ¡
2. ç‚¹å‡» Start æŒ‰é’®
3. ç­‰å¾…è¶…è¿‡ 2 åˆ†é’Ÿï¼ˆå€’è®¡æ—¶å˜çº¢ï¼‰
4. å®Œæˆå¼€å§‹éªŒè¯
5. æŒ‰æ—¶å®Œæˆä»»åŠ¡
6. éªŒè¯é‡‘å¸ï¼š100 Ã— 0.7 = 70 é‡‘å¸ï¼ˆæ‰£é™¤ 30%ï¼‰

### æµ‹è¯•åœºæ™¯ 3ï¼šè¶…æ—¶å®Œæˆ
1. åˆ›å»ºä¸€ä¸ª 10 åˆ†é’Ÿçš„ä»»åŠ¡
2. ç‚¹å‡» Start æŒ‰é’®
3. åœ¨ 2 åˆ†é’Ÿå†…å®Œæˆå¼€å§‹éªŒè¯
4. ç­‰å¾…è¶…è¿‡ 10 åˆ†é’Ÿï¼ˆå€’è®¡æ—¶å˜çº¢ï¼‰
5. å®Œæˆä»»åŠ¡
6. éªŒè¯é‡‘å¸ï¼š0 é‡‘å¸

### æµ‹è¯•åœºæ™¯ 4ï¼šç«™ç«‹ä»»åŠ¡
1. åˆ›å»ºä¸€ä¸ª 10 åˆ†é’Ÿçš„ç«™ç«‹ä»»åŠ¡
2. æ­£å¸¸å®Œæˆ
3. éªŒè¯é‡‘å¸ï¼š10 åˆ†é’Ÿ Ã— 15 = 150 é‡‘å¸

## ğŸ“± PWA é€šçŸ¥æµ‹è¯•

1. å°†åº”ç”¨æ·»åŠ åˆ°ä¸»å±å¹•
2. å¯åŠ¨ä¸€ä¸ªä»»åŠ¡
3. åˆ‡æ¢åˆ°åå°
4. éªŒè¯æ˜¯å¦æ”¶åˆ°ä»¥ä¸‹é€šçŸ¥ï¼š
   - å¼€å§‹éªŒè¯å€’è®¡æ—¶ 1 åˆ†é’Ÿæé†’
   - å¼€å§‹éªŒè¯è¶…æ—¶æé†’
   - ä»»åŠ¡å®Œæˆå€’è®¡æ—¶ 5 åˆ†é’Ÿæé†’
   - ä»»åŠ¡å®Œæˆå€’è®¡æ—¶ 1 åˆ†é’Ÿæé†’
   - ä»»åŠ¡è¶…æ—¶æé†’

## ğŸ”§ æŠ€æœ¯ç»†èŠ‚

### æ–‡ä»¶ä¿®æ”¹æ¸…å•
- âœ… `src/components/calendar/NewTimelineView.tsx` - ä¸»è¦é›†æˆæ–‡ä»¶
- âœ… `src/components/calendar/TaskCountdown.tsx` - å€’è®¡æ—¶ç»„ä»¶ï¼ˆå·²å­˜åœ¨ï¼‰
- âœ… `src/stores/taskStore.ts` - å€’è®¡æ—¶çŠ¶æ€ç®¡ç†ï¼ˆå·²å­˜åœ¨ï¼‰
- âœ… `src/utils/goldCalculator.ts` - é‡‘å¸è®¡ç®—é€»è¾‘ï¼ˆå·²å­˜åœ¨ï¼‰
- âœ… `src/services/notificationService.ts` - é€šçŸ¥æœåŠ¡ï¼ˆå·²å­˜åœ¨ï¼‰

### å…³é”®ä»£ç ä½ç½®
- **å¯¼å…¥è¯­å¥**ï¼šç¬¬ 1-25 è¡Œ
- **Store æ–¹æ³•**ï¼šç¬¬ 138 è¡Œ
- **å¼€å§‹å€’è®¡æ—¶ï¼ˆæ— éªŒè¯ï¼‰**ï¼šç¬¬ 878-883 è¡Œ
- **å¼€å§‹å€’è®¡æ—¶ï¼ˆæœ‰éªŒè¯ï¼‰**ï¼šç¬¬ 1043 è¡Œ
- **å®Œæˆæ£€æŸ¥**ï¼šç¬¬ 1212 è¡Œ
- **UI æ˜¾ç¤º**ï¼šç¬¬ 1915-1921 è¡Œ

## âœ¨ å®ŒæˆçŠ¶æ€

æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½å·²æˆåŠŸé›†æˆåˆ° NewTimelineView.tsx ä¸­ï¼š
- âœ… å€’è®¡æ—¶å¯åŠ¨é€»è¾‘
- âœ… å€’è®¡æ—¶è¶…æ—¶æ£€æŸ¥
- âœ… UI ç»„ä»¶æ˜¾ç¤º
- âœ… é‡‘å¸è®¡ç®—é›†æˆ
- âœ… é€šçŸ¥æœåŠ¡é›†æˆ

å¯ä»¥å¼€å§‹æµ‹è¯•äº†ï¼ğŸ‰








