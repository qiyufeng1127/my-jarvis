# 习惯罐头系统 - 使用说明

## 🏺 系统概述

习惯罐头系统是一个创新的坏习惯追踪工具，采用「日历+罐头」的可视化设计，自动监控时间轴事件并统计坏习惯。

## ✨ 核心特性

### 1. 罐头日历界面
- **罐头样式**：每天一个罐头形状的方块，带有罐头盖装饰
- **Emoji 显示**：罐头内显示坏习惯的 emoji，数量随次数增加
- **颜色提示**：
  - 🟢 绿色：无坏习惯
  - 🟡 黄色：1-3 个坏习惯
  - 🔴 红色：超过 3 个坏习惯
- **点击查看**：点击罐头可查看当日坏习惯详情

### 2. 预设坏习惯（6种）

| 坏习惯 | Emoji | 监控规则 | 默认阈值 |
|--------|-------|----------|----------|
| 熬夜 | 🌙 | 最后一个任务结束时间 | 晚于 23:00 |
| 晚起 | 🛌 | 第一个任务开始时间 | 晚于 10:30 |
| 拖延 | 🕒 | 任务启动超时次数 | 每超时 1 次记 1 次 |
| 低效率 | 🐢 | 任务完成超时 | 预设时长内未完成 |
| 点外卖 | 🍱 | 关键词匹配 | 包含「外卖、美团、饿了么」 |
| 不吃午饭 | 🥣 | 关键词缺失 | 11:30-13:00 无「午饭」相关任务 |

### 3. 自定义坏习惯

支持创建自己的坏习惯，包括：
- **自定义名称**：如「刷短视频」「吃零食」
- **选择 Emoji**：从 30+ 个 emoji 中选择或输入自定义
- **配置规则**：支持 4 种规则类型

#### 规则类型

**⏰ 时间阈值规则**
- 检查类型：第一个任务（晚起）/ 最后一个任务（熬夜）
- 比较方式：晚于 / 早于
- 阈值时间：自定义时间点

**🔍 关键词规则**
- 关键词列表：用逗号分隔多个关键词
- 匹配逻辑：存在则记录 / 不存在则记录
- 时间范围：可选，限定检查时间段

**📊 任务状态规则**
- 启动超时：监控任务启动倒计时
- 完成超时：监控任务完成情况

**✍️ 手动记录**
- 完全手动添加，不自动监控

## 🎯 使用流程

### 首次使用

1. **打开习惯模块**
   - 电脑端：在主面板中找到「坏习惯」模块
   - 手机端：底部导航栏选择「习惯」

2. **查看预设习惯**
   - 系统已自动初始化 6 个预设坏习惯
   - 所有预设习惯默认启用

3. **调整规则**（可选）
   - 点击「规则设置」按钮
   - 修改阈值时间或关键词
   - 启用/禁用特定习惯

### 日常使用

1. **自动监控**
   - 系统每分钟检查一次任务状态
   - 每天 00:01 自动执行日结算
   - 实时记录坏习惯到对应日期

2. **查看罐头**
   - 日历上每天显示一个罐头
   - 罐头内显示当天的坏习惯 emoji
   - 点击罐头查看详细记录

3. **查看详情**
   - 显示当天所有坏习惯
   - 每个坏习惯的发生次数
   - 触发原因和关联任务
   - 手动添加的可以删除

### 自定义习惯

1. **创建新习惯**
   - 点击「自定义坏习惯」按钮
   - 输入名称（如「刷短视频」）
   - 选择 emoji（如 📱）
   - 选择规则类型并配置参数

2. **编辑习惯**
   - 在「规则设置」中找到对应习惯
   - 点击「编辑规则」修改参数
   - 保存后立即生效

3. **删除习惯**
   - 预设习惯不能删除，只能禁用
   - 自定义习惯可以删除
   - 删除后相关记录也会被清除

## 📊 统计功能

### 月度统计
- **本月坏习惯总次数**：显示在日历顶部
- **最频发坏习惯**：显示名称、emoji 和次数

### 今日预览
- 显示在日历底部
- 实时更新今天的坏习惯
- 快速查看详情

## 🔧 技术实现

### 数据存储
- 使用 Zustand + localStorage 持久化
- 自动恢复日期对象
- 支持数据导入导出

### 监控服务
- 独立的 `habitMonitorService`
- 每分钟检查任务状态
- 每日自动结算
- 支持手动补算历史数据

### 规则引擎
- 时间阈值检查
- 关键词匹配（支持时间范围）
- 任务状态监控
- 手动记录支持

## 🎨 界面设计

### 罐头样式
- 圆角矩形 + 顶部罐头盖装饰
- 响应式设计，自适应屏幕
- Hover 放大效果
- 今日罐头高亮边框

### 颜色系统
- 深色模式自适应
- 渐变色背景（可选）
- 语义化颜色提示

### 交互体验
- 流畅的动画过渡
- 直观的图标和 emoji
- 清晰的操作反馈

## 📝 使用建议

1. **合理设置阈值**
   - 根据自己的作息调整熬夜/晚起时间
   - 不要设置过于严格的标准

2. **关注高频习惯**
   - 重点改善最频发的坏习惯
   - 设置提醒或奖励机制

3. **定期回顾**
   - 每周查看习惯趋势
   - 调整规则和目标

4. **结合其他功能**
   - 配合金币系统设置惩罚
   - 在日记中反思坏习惯
   - 设置改善目标

## 🚀 未来计划

- [ ] 习惯趋势图表
- [ ] 周报/月报生成
- [ ] 习惯改善建议
- [ ] 社交分享功能
- [ ] 习惯挑战活动
- [ ] AI 智能分析

## 💡 常见问题

**Q: 预设习惯可以删除吗？**
A: 不能删除，但可以禁用。点击规则设置，关闭对应习惯的开关。

**Q: 如何修改熬夜的时间阈值？**
A: 点击「规则设置」→ 找到「熬夜」→ 点击「编辑规则」→ 修改阈值时间。

**Q: 手动添加的记录可以删除吗？**
A: 可以。在罐头详情中，手动添加的记录会显示删除按钮。

**Q: 为什么有些坏习惯没有自动记录？**
A: 检查该习惯是否启用，规则配置是否正确，时间轴是否有对应的任务。

**Q: 可以补算历史数据吗？**
A: 目前需要手动添加。未来会支持历史数据重新计算功能。

## 📞 反馈与支持

如有问题或建议，欢迎反馈！

