# 任务时间自动调整 - 使用示例

## 快速开始

### 示例1：提前启动任务

**场景：** 你计划下午6点开始工作，但实际上午3点就想开始

**操作步骤：**
1. 在时间轴上找到"6:00 - 7:00 工作"任务
2. 点击"启动"按钮
3. 拍照完成启动验证
4. ✅ 系统自动将任务移动到 3:00 - 4:00

**结果：**
```
调整前：
├─ 3:00 - 3:30: 洗碗
├─ 6:00 - 7:00: 工作 ← 原计划

调整后：
├─ 3:00 - 4:00: 工作 ← 提前启动
├─ 4:00 - 4:30: 洗碗 ← 自动下移
```

**金币奖励：**
- 启动验证通过：+40金币（40%基础奖励）
- 无超时惩罚

---

### 示例2：提前完成任务

**场景：** 任务计划60分钟，实际30分钟就完成了

**操作步骤：**
1. 9:00 启动任务（计划 9:00-10:00）
2. 9:30 点击"完成"按钮
3. 拍照完成完成验证
4. ✅ 系统自动将结束时间改为 9:30

**结果：**
```
调整前：
├─ 9:00 - 10:00: 工作 (60分钟)

调整后：
├─ 9:00 - 9:30: 工作 (30分钟) ← 提前30分钟完成
```

**金币奖励：**
- 完成验证通过：+60金币（60%基础奖励）
- 提前50%完成：+100金币（100%额外奖励）
- **总计：+160金币** 🎉

---

### 示例3：多任务冲突自动处理

**场景：** 提前启动一个长任务，导致多个任务需要下移

**操作步骤：**
1. 在时间轴上有以下任务：
   - 3:00 - 3:30: 洗碗
   - 3:30 - 4:00: 收拾房间
   - 6:00 - 7:00: 工作（60分钟）
2. 在 3:00 启动"工作"任务
3. 完成启动验证

**结果：**
```
调整前：
├─ 3:00 - 3:30: 洗碗
├─ 3:30 - 4:00: 收拾房间
├─ 6:00 - 7:00: 工作

调整后：
├─ 3:00 - 4:00: 工作 ← 提前启动（60分钟）
├─ 4:00 - 4:30: 洗碗 ← 自动下移
├─ 4:30 - 5:00: 收拾房间 ← 自动下移
```

**系统日志：**
```
🔧 调整任务启动时间: 工作
⚠️ 发现 2 个冲突任务
📍 任务自动下移: 洗碗 (3:00→4:00)
📍 任务自动下移: 收拾房间 (3:30→4:30)
✅ 任务启动验证成功，时间已自动修正，冲突任务已下移
```

---

### 示例4：延后启动任务（有超时）

**场景：** 任务计划6点开始，但8点才启动

**操作步骤：**
1. 任务计划：6:00 - 7:00
2. 在 8:00 启动任务
3. 完成启动验证

**结果：**
```
调整前：
├─ 6:00 - 7:00: 工作

调整后：
├─ 8:00 - 9:00: 工作 ← 延后2小时启动
```

**金币情况：**
- 启动超时：第1次超时 -10金币（10%惩罚）
- 启动验证通过：+40金币（40%基础奖励）
- **实际获得：+30金币**
- 完成任务后会返还超时扣除的10金币

---

### 示例5：无冲突的时间调整

**场景：** 提前启动任务，但该时段没有其他任务

**操作步骤：**
1. 任务计划：14:00 - 15:00
2. 在 10:00 启动任务（该时段无其他任务）
3. 完成启动验证

**结果：**
```
调整前：
├─ 9:00 - 10:00: 早餐
├─ 14:00 - 15:00: 工作

调整后：
├─ 9:00 - 10:00: 早餐
├─ 10:00 - 11:00: 工作 ← 提前启动，无冲突
```

**说明：**
- 无其他任务受影响
- 时间轴保持整洁
- 正常获得金币奖励

---

## 常见问题

### Q1: 如果我不想让某个任务被下移怎么办？
**A:** 系统会优先保留你主动启动的任务。如果不想让其他任务被下移，建议按照原计划时间启动任务。

### Q2: 下移的任务会影响金币奖励吗？
**A:** 不会。下移只改变任务的时间，不影响金币计算、验证规则等任何其他逻辑。

### Q3: 如果下移后的时间我不方便怎么办？
**A:** 可以手动编辑被下移的任务，重新设置时间。系统只是自动找到最近的空闲时段，你可以随时调整。

### Q4: 提前完成任务有什么好处？
**A:** 
- 提前20%-50%：额外奖励33%金币
- 提前50%以上：额外奖励100%金币
- 节省时间可以做更多任务

### Q5: 系统如何判断"最近的空闲时段"？
**A:** 系统会从冲突任务结束时间开始，按时间顺序查找第一个没有任务的时间段。

---

## 最佳实践

### ✅ 推荐做法

1. **灵活启动**：不必严格按照计划时间，随时可以启动任务
2. **提前完成**：尽量提前完成任务，获得额外奖励
3. **合理规划**：虽然系统会自动调整，但合理的初始规划仍然重要
4. **查看日志**：留意控制台日志，了解系统如何调整任务

### ⚠️ 注意事项

1. **避免频繁调整**：虽然系统支持自动调整，但频繁改变计划可能影响效率
2. **关注下移任务**：被下移的任务可能需要你重新确认时间
3. **同一天限制**：只处理同一天的任务冲突，跨天任务不受影响

---

## 技术细节

### 时间冲突判断

两个任务时间冲突的条件：
```javascript
start1 < end2 && start2 < end1
```

### 空闲时段查找算法

1. 获取同一天的所有任务
2. 按开始时间排序
3. 从目标时间开始查找
4. 检查是否与现有任务冲突
5. 如有冲突，移动到该任务结束后
6. 重复直到找到空闲时段

### 批量更新机制

1. 计算所有受影响的任务
2. 生成新的时间安排
3. 一次性更新所有任务
4. 触发界面重新渲染

---

## 调试技巧

### 查看调整日志

打开浏览器控制台（F12），查看以下日志：

```javascript
🔧 调整任务启动时间: { ... }
⚠️ 发现 N 个冲突任务
📍 任务自动下移: { ... }
✅ 任务启动验证成功，时间已自动修正
```

### 验证时间调整

1. 启动任务前记录原时间
2. 完成验证后检查新时间
3. 确认冲突任务是否正确下移
4. 验证金币奖励是否正确

---

## 总结

任务时间自动调整功能让你的时间管理更加灵活：

- ✅ **随时启动**：不受原计划时间限制
- ✅ **自动处理**：冲突任务自动下移
- ✅ **保留逻辑**：金币、验证等规则不变
- ✅ **提前奖励**：提前完成获得额外金币
- ✅ **无缝体验**：调整过程自动完成

开始使用这个功能，让你的任务管理更加智能和高效！🚀






