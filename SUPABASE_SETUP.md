# Supabase 云端数据同步设置指南

## 📋 概述

本应用使用 Supabase 实现云端数据同步，确保您在不同设备（电脑、手机）上登录同一账号时，数据能够实时同步。

## 🚀 快速开始

### 1. 创建 Supabase 项目

1. 访问 [Supabase](https://supabase.com/)
2. 注册/登录账号
3. 点击 "New Project" 创建新项目
4. 填写项目信息：
   - Name: `manifestos` (或任意名称)
   - Database Password: 设置一个强密码
   - Region: 选择离您最近的区域（如 `Northeast Asia (Tokyo)`）

### 2. 获取 API 密钥

1. 在项目仪表盘中，点击左侧菜单的 "Settings" → "API"
2. 复制以下信息：
   - `Project URL` (例如: `https://xxxxx.supabase.co`)
   - `anon public` key (公开密钥)

### 3. 配置环境变量

在项目根目录创建 `.env` 文件（如果还没有），添加以下内容：

```env
VITE_SUPABASE_URL=你的项目URL
VITE_SUPABASE_ANON_KEY=你的anon_public密钥
```

### 4. 创建数据库表

1. 在 Supabase 仪表盘中，点击左侧菜单的 "SQL Editor"
2. 点击 "New Query"
3. 复制 `supabase_schema.sql` 文件的全部内容
4. 粘贴到 SQL 编辑器中
5. 点击 "Run" 执行 SQL

### 5. 启用邮箱登录

1. 在 Supabase 仪表盘中，点击左侧菜单的 "Authentication" → "Providers"
2. 确保 "Email" 提供商已启用
3. 配置邮件模板（可选）：
   - 点击 "Email Templates"
   - 自定义确认邮件、重置密码邮件等

## 📊 数据同步功能

### 已实现的同步功能

- ✅ **金币系统**：金币余额、交易记录实时同步
- ✅ **仪表盘配置**：模块布局、颜色设置跨设备同步
- 🔄 **任务管理**：待办事项、任务状态（即将支持）
- 🔄 **目标追踪**：长期目标、进度（即将支持）
- 🔄 **日记记录**：成功日记、感恩日记（即将支持）

### 同步机制

- **自动同步**：每次数据变更后自动上传到云端
- **防抖机制**：5秒内只同步一次，避免频繁请求
- **启动加载**：应用启动时自动从云端加载最新数据
- **离线支持**：未配置 Supabase 时，数据仍保存在本地

## 🔐 安全性

- **行级安全策略 (RLS)**：每个用户只能访问自己的数据
- **身份验证**：必须登录才能同步数据
- **加密传输**：所有数据通过 HTTPS 加密传输

## 🛠️ 故障排查

### 问题：数据没有同步

1. 检查 `.env` 文件是否正确配置
2. 检查浏览器控制台是否有错误信息
3. 确认已登录 Supabase 账号
4. 检查网络连接

### 问题：无法登录

1. 检查邮箱是否正确
2. 检查是否收到确认邮件
3. 检查 Supabase 项目是否正常运行

### 问题：SQL 执行失败

1. 确保使用的是 PostgreSQL 语法
2. 检查表是否已存在（可以先删除再创建）
3. 查看 Supabase 日志获取详细错误信息

## 📱 多设备使用

1. **电脑端**：在浏览器中访问应用，使用邮箱登录
2. **手机端**：在手机浏览器中访问应用，使用相同邮箱登录
3. **数据同步**：两端数据自动同步，无需手动操作

## 🎯 下一步

- [ ] 实现任务数据同步
- [ ] 实现目标数据同步
- [ ] 实现日记数据同步
- [ ] 实现记忆数据同步
- [ ] 添加数据导出功能
- [ ] 添加数据备份功能

## 💡 提示

- 首次使用建议先在一个设备上完成设置
- 定期检查 Supabase 项目的使用量（免费版有限制）
- 重要数据建议定期导出备份

## 📞 支持

如有问题，请查看：
- [Supabase 官方文档](https://supabase.com/docs)
- [项目 GitHub Issues](https://github.com/your-repo/issues)
