# 百度AI图像识别配置说明

## 功能说明

系统已集成百度AI图像识别功能，用于验证任务启动和完成时上传的照片是否真实包含指定的关键词内容。

**免费额度：每天500次调用**（对于个人使用完全足够）

---

## 申请步骤

### 1. 注册百度账号
访问 [百度AI开放平台](https://ai.baidu.com/)，使用百度账号登录（没有的话先注册）

### 2. 进入控制台
登录后，点击右上角 **控制台** 按钮

### 3. 创建应用
- 在左侧菜单找到 **产品服务** → **图像识别**
- 点击 **创建应用**
- 填写应用信息：
  - 应用名称：随便填，例如 `时间管理助手`
  - 应用描述：随便填，例如 `个人时间管理工具`
  - 接口选择：勾选 **通用物体和场景识别**
- 点击 **立即创建**

### 4. 获取密钥
创建成功后，在应用列表中可以看到：
- **API Key**（例如：`aBcDeFgHiJkLmNoPqRsTuVwXyZ123456`）
- **Secret Key**（例如：`1234567890aBcDeFgHiJkLmNoPqRsTuV`）

### 5. 配置到项目
在项目根目录创建 `.env` 文件（如果已存在则编辑），添加以下内容：

```env
# Supabase 配置（保持不变）
VITE_SUPABASE_URL=你的Supabase地址
VITE_SUPABASE_ANON_KEY=你的Supabase密钥

# 百度AI图像识别配置
VITE_BAIDU_API_KEY=你的API_KEY
VITE_BAIDU_SECRET_KEY=你的SECRET_KEY
```

**重要：** 将上面的 `你的API_KEY` 和 `你的SECRET_KEY` 替换为第4步获取的真实密钥！

### 6. 重启开发服务器
修改 `.env` 文件后，需要重启开发服务器才能生效：

```bash
# 停止当前服务器（Ctrl+C）
# 然后重新启动
npm run dev
```

---

## 使用说明

### 1. 启用任务验证
在时间线视图中，点击任务卡片上的 **⏱️ 图标**，系统会自动生成启动和完成验证关键词。

### 2. 可选验证类型
在验证设置对话框中，你可以选择：
- ✅ **只启用启动验证**：只验证任务开始时的照片
- ✅ **只启用完成验证**：只验证任务完成时的照片
- ✅ **同时启用两者**：启动和完成都需要验证
- ❌ **都不启用**：不需要拍照验证，点击即可开始/完成

### 3. 编辑关键词
你可以手动编辑AI生成的关键词，例如：
- 启动验证：`洗漱台, 牙刷, 洗面奶, 毛巾`
- 完成验证：`干净的脸, 整洁的洗漱台`

### 4. 拍照验证
- 点击 **start** 按钮时，如果启用了启动验证，会打开相机
- 拍摄包含关键词内容的照片
- 系统会自动识别照片内容并验证是否匹配
- 如果匹配成功，任务启动并获得金币奖励
- 如果匹配失败，会提示重新拍摄（最多3次机会）

### 5. 验证规则
- 默认匹配阈值：**30%**（至少匹配30%的关键词即可通过）
- 例如：关键词有 `洗漱台, 牙刷, 洗面奶`（共3个）
  - 识别到 `洗漱台` → 匹配1/3 = 33% → ✅ 通过
  - 识别到 `洗漱台, 牙刷` → 匹配2/3 = 67% → ✅ 通过
  - 什么都没识别到 → 匹配0/3 = 0% → ❌ 失败

---

## 常见问题

### Q1: 没有配置百度AI会怎样？
**A:** 系统会自动跳过图像识别，验证自动通过。但这样就失去了防止拖延的作用。

### Q2: 免费额度用完了怎么办？
**A:** 百度AI每天有500次免费调用，对于个人使用完全足够。如果真的用完了，第二天会自动重置。

### Q3: 识别不准确怎么办？
**A:** 
1. 确保照片清晰，光线充足
2. 关键词尽量具体明确（例如：`牙刷` 比 `洗漱用品` 更容易识别）
3. 可以调整关键词，使用更容易识别的物体

### Q4: 可以调整匹配阈值吗？
**A:** 可以！在 `baiduImageRecognition.ts` 中修改 `verifyImage` 函数的第三个参数：
```typescript
// 默认 0.3 表示至少匹配30%
// 可以改为 0.5 表示至少匹配50%
const verifyResult = await baiduImageRecognition.verifyImage(
  file,
  verification.startKeywords,
  0.5 // 这里修改阈值
);
```

### Q5: 为什么要用百度AI而不是其他？
**A:** 
- ✅ 国内访问速度快
- ✅ 免费额度充足（每天500次）
- ✅ 识别准确率高
- ✅ 中文支持好
- ✅ 文档完善

---

## 技术细节

### API调用流程
1. 获取 Access Token（有效期30天，自动缓存）
2. 将图片转换为 Base64 编码
3. 调用通用物体识别API
4. 解析识别结果，匹配关键词
5. 返回验证结果

### 数据安全
- API Key 和 Secret Key 存储在本地 `.env` 文件中
- 不会上传到 GitHub（已添加到 `.gitignore`）
- 图片仅用于识别，不会被百度永久存储

### 性能优化
- Access Token 自动缓存，避免频繁请求
- 图片自动压缩，减少上传时间
- 识别结果实时反馈，用户体验流畅

---

## 支持与反馈

如有问题，请查看：
- [百度AI官方文档](https://ai.baidu.com/ai-doc/IMAGERECOGNITION/Xk3bcxe21)
- [百度AI控制台](https://console.bce.baidu.com/ai/)

祝你使用愉快！🎉

