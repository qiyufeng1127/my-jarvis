# 完整重构计划

## 核心需求总结

### 1. 时间线精准性
- [x] NOW 时间线精准对应真实时间
- [ ] 自动滚动到当前时间位置
- [ ] 无事件时正常显示，新增事件自动嵌入

### 2. 启动倒计时（2分钟）
- [ ] 预设时间到达时自动触发
- [ ] 倒计时流速与真实时间一致
- [ ] 刷新浏览器保留剩余时间
- [ ] 倒计时嵌套在事件卡片内
- [ ] 超时循环扣金币（20%/次）
- [ ] 2分钟内完成奖励50%金币

### 3. 完成倒计时（任务总时长）
- [ ] 启动成功后自动触发
- [ ] 预设时长内完成奖励50%
- [ ] 超时每10分钟扣20%
- [ ] 循环扣除直到完成

### 4. 验证任务交互
- [ ] 上传照片自动验证
- [ ] 验证结果显示在卡片内
- [ ] 验证成功自动进入下一步
- [ ] 无浏览器弹窗

### 5. 时间动态更新
- [ ] 启动时间替换预设开始时间
- [ ] 完成时间替换预设结束时间
- [ ] 时间轴同步更新

### 6. 金币系统集成
- [ ] 取消独立组件
- [ ] 集成到右上角按钮
- [ ] 支持负数显示
- [ ] 实时同步所有操作
- [ ] 金币明细查看
- [ ] 奖励商店

### 7. 代码清理
- [ ] 删除无关倒计时代码
- [ ] 检查时间轴联动
- [ ] 精简控制台输出

## 实现步骤

### 阶段1：核心倒计时逻辑重构
1. 创建统一的倒计时管理器
2. 实现启动倒计时（2分钟）
3. 实现完成倒计时（任务总时长）
4. 持久化倒计时状态（localStorage）

### 阶段2：验证流程优化
1. 移除手动按钮
2. 自动触发验证
3. 卡片内显示结果
4. 自动进入下一步

### 阶段3：时间更新机制
1. 实现启动时间替换
2. 实现完成时间替换
3. 时间轴同步更新

### 阶段4：金币系统重构
1. 移除独立组件
2. 集成到右上角
3. 实现明细查看
4. 实现奖励商店

### 阶段5：代码清理与优化
1. 删除冗余代码
2. 优化控制台输出
3. 测试所有功能

## 当前状态
- 已完成：NOW 时间线基础功能
- 进行中：倒计时逻辑修正
- 待开始：完整重构

## 预计工作量
- 总计：约 2000 行代码修改
- 时间：约 4-6 小时

