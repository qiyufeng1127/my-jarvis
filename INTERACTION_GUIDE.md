# ManifestOS 交互逻辑与功能清单

## 📱 整体架构

```
主页（可自定义仪表盘）
├── 左侧：功能模块图标栏（可上传自定义图标）
├── 中间：拖拽式模块区域（可自由布局）
└── 右下角：浮动按钮（AI助手 + Kiki语音）
```

---

## ✅ 已实现功能

### 1️⃣ 可自定义仪表盘系统

**核心交互：**
- 点击左侧图标 → 添加/显示模块到主页
- 拖拽模块头部 → 移动位置
- 拖拽模块右下角 → 调整大小
- 点击🎨按钮 → 修改模块背景颜色
- 点击❌按钮 → 隐藏模块（不删除）
- 右键图标 → 上传自定义图标

**可用模块：**
- 📊 总控面板：今日任务、成长值、金币余额概览
- 🎯 长期目标：创建、编辑、追踪长期目标
- 📅 时间轴：日历+24小时时间轴，任务管理
- 💰 金币经济：金币余额、商店、交易记录
- ⚠️ 坏习惯：追踪、分析、改进计划
- 📈 数据报告：日报（免费）、周报/月报（付费）
- ⚙️ 设置：云同步、外观、通知、成长维度等
- 🎤 Kiki宝宝：语音助手入口
- 📔 成功&感恩日记：记录成功和感恩事件
- 🧠 全景记忆栏：心情、想法、待办记录
- 🖼️ 图片组件：上传图片装饰主页

**数据持久化：**
- ✅ 自动保存到 Supabase 云端
- ✅ 实时同步（可配置频率）
- ✅ 支持多设备同步

---

### 2️⃣ 时间轴系统

**布局：**
```
上半部分：日历视图（月视图/周视图切换）
下半部分：24小时时间轴（可滚动）
```

**核心交互：**
- 点击日历日期 → 切换到该天的时间轴
- 拖拽任务块 → 调整任务时间
- 拖拽任务底部 → 调整任务时长
- 右键任务 → 编辑/完成/复制/删除
- 点击"新建任务" → 创建任务
- 切换时间粒度 → 30/15/5分钟

**时间轴特性：**
- ✅ 左侧时间刻度 + 右侧内容一起滚动
- ✅ 红色NOW线显示当前时间
- ✅ 任务块颜色区分类型
- ✅ 任务状态图标（⏳待办、▶️进行中、✅完成、⚠️逾期）
- ✅ 自定义滚动条（灰色，可见）

**已实现：**
- ✅ 创建任务
- ✅ 编辑任务
- ✅ 删除任务
- ✅ 拖拽调整时间
- ✅ 拖拽调整时长
- ✅ 任务状态管理
- ✅ 背景色自定义

**未实现：**
- ❌ 任务验证（人脸识别、位置验证）
- ❌ 任务提醒通知
- ❌ 任务重复设置

---

### 3️⃣ AI助手（浮动面板）

**位置：** 右下角第二个按钮（🤖）

**核心交互：**
- 点击按钮 → 打开/关闭面板
- 拖拽头部 → 移动位置
- 拖拽右下角 → 调整大小
- 点击🎨 → 修改背景颜色
- 点击⚙️ → 打开API配置
- 点击最小化 → 收起面板

**AI功能：**
- ✅ 自然语言任务分解
  - 输入："5分钟后洗漱然后吃饭"
  - AI自动分解为多个任务，智能分配时长
  
- ✅ 智能动线优化
  - 根据家里格局（厕所→工作区→厨房→客厅→卧室→拍摄间）
  - 自动排序任务，减少走动
  
- ✅ 任务编辑器
  - 修改任务标题
  - 调整任务时长
  - 拖拽排序
  - 删除任务
  
- ✅ 推送到时间轴
  - 一键将编辑好的任务推送到时间轴
  
- ✅ 心情记录
  - 输入心情，AI自动识别类型
  - 自动打标签（情绪、分类）
  - 自动计算奖励（金币、成长值）
  - 保存到全景记忆栏
  
- ✅ 查询任务
  - "查看今天的任务"
  - 显示完成情况、总时长

**API配置：**
- ✅ DeepSeek API（AI功能）
- ✅ 自定义 Base URL
- ✅ API Key 配置
- ✅ 测试连接

**已实现：**
- ✅ 任务分解
- ✅ 动线优化
- ✅ 任务编辑
- ✅ 心情记录
- ✅ 标签识别
- ✅ 目标关联

**未实现：**
- ❌ 语音输入
- ❌ 图片识别
- ❌ 上下文记忆（多轮对话）

---

### 4️⃣ Kiki语音助手（浮动按钮）

**位置：** 右下角第一个按钮（🎤）

**核心交互：**
- 点击按钮 → 唤醒Kiki
- 说"Kiki" → 语音唤醒
- 语音输入 → 执行命令

**已实现：**
- ✅ 语音唤醒
- ✅ 语音识别（Web Speech API）
- ✅ 语音播报
- ✅ 浮动模式

**未实现：**
- ❌ 自然语言理解（需要AI）
- ❌ 语音创建任务
- ❌ 语音查询数据

---

### 5️⃣ 长期目标系统

**核心交互：**
- 点击"添加目标" → 创建新目标
- 点击目标卡片 → 查看详情
- 编辑目标 → 修改名称、描述、截止日期
- 删除目标 → 移除目标

**目标特性：**
- ✅ 目标名称、描述
- ✅ 截止日期
- ✅ 进度追踪
- ✅ 关联任务自动更新进度

**已实现：**
- ✅ 创建目标
- ✅ 编辑目标
- ✅ 删除目标
- ✅ 进度显示

**未实现：**
- ❌ 子目标/里程碑
- ❌ 目标模板
- ❌ 目标分享

---

### 6️⃣ 金币经济系统

**核心交互：**
- 完成任务 → 自动获得金币
- 点击"奖励商店" → 查看可兑换物品
- 点击"交易记录" → 查看金币历史

**商店分类：**
- 实用功能：赎回时间、解锁报告、任务提示
- 特权购买：免监控券、时间暂停卡、双倍奖励
- 真实奖励：自定义奖励（看电影、买零食等）

**自定义奖励：**
- ✅ 添加奖励名称
- ✅ 设置价格
- ✅ AI自动生成图标（根据名称）
- ✅ 预览效果

**已实现：**
- ✅ 金币余额显示
- ✅ 商店系统
- ✅ 自定义奖励
- ✅ 交易记录

**未实现：**
- ❌ 实际兑换功能
- ❌ 金币消费
- ❌ 金币统计图表

---

### 7️⃣ 坏习惯追踪系统

**核心交互：**
- 点击"记录坏习惯" → 添加记录
- 点击习惯卡片 → 查看详情
- 查看时间分布 → 热力图
- 开始改进计划 → 21天计划

**习惯特性：**
- ✅ 纯净度仪表盘（0-100%）
- ✅ 习惯频率统计
- ✅ 时间分布热力图
- ✅ 连续控制天数
- ✅ 严重程度评分

**改进计划：**
- 意识期（1-7天）：每天记录
- 调整期（8-14天）：提供替代方案
- 巩固期（15-21天）：强化新习惯

**已实现：**
- ✅ 记录坏习惯
- ✅ 统计分析
- ✅ 热力图
- ✅ 改进计划框架

**未实现：**
- ❌ 自动检测坏习惯
- ❌ 实时提醒
- ❌ AI教练陪伴

---

### 8️⃣ 数据报告系统

**报告类型：**
- 📅 日报（免费）：今日完成、用时、金币、成长值
- 📆 周报（100金币）：效率分析、趋势图表、改进建议
- 📊 月报（300金币）：深度洞察、成长轨迹、下月规划

**报告内容：**
- ✅ 核心数据统计
- ✅ 今日亮点
- ✅ 待改进项
- ✅ 明日建议

**成长故事：**
- 今日故事、本周叙事、月度史诗、年度传记
- ✅ AI生成叙事文本
- ✅ 分享功能

**已实现：**
- ✅ 日报生成
- ✅ 周报/月报解锁机制
- ✅ 成长故事

**未实现：**
- ❌ 实际数据统计
- ❌ 图表可视化
- ❌ PDF导出

---

### 9️⃣ 成功&感恩日记

**核心交互：**
- 点击"添加记录" → 选择类型（成功/感恩）
- 输入内容 → 保存
- 查看历史 → 浏览过往记录

**已实现：**
- ✅ 创建日记
- ✅ 查看日记
- ✅ 类型分类

**未实现：**
- ❌ 日记搜索
- ❌ 日记标签
- ❌ 日记导出

---

### 🔟 全景记忆栏

**记录类型：**
- 心情记录：记录情绪状态
- 碎碎念：随手记录想法
- 待办事项：快速记录待办
- 成功日记：记录成就
- 感恩日记：记录感恩

**AI功能：**
- ✅ 自动识别类型
- ✅ 自动打标签（情绪、分类）
- ✅ 自动计算奖励

**已实现：**
- ✅ 创建记录
- ✅ AI标签
- ✅ 奖励计算

**未实现：**
- ❌ 记录搜索
- ❌ 记录筛选
- ❌ 记录统计

---

### 1️⃣1️⃣ 设置系统

**设置分类：**

**☁️ 云同步：**
- ✅ 自动同步开关
- ✅ 同步频率（实时/1分钟/5分钟/15分钟）
- ✅ 启动时同步
- ✅ 冲突解决策略
- ✅ 同步范围选择
- ✅ 手动同步
- ✅ 导出数据
- ✅ 清除缓存

**🎨 外观体验：**
- ✅ 主题切换（明亮/暗色/自动）
- ✅ 主色调选择
- ✅ 字体大小（小/中/大）
- ✅ 界面密度（紧凑/标准/宽松）
- ✅ 默认视图

**🔔 通知语音：**
- ✅ 通知开关（任务提醒、成长提醒等）
- ✅ 免打扰时段
- ✅ AI语音类型（温柔女声/活力女声/沉稳男声/阳光男声）
- ✅ 语速调节
- ✅ 唤醒词灵敏度

**📊 成长维度：**
- ✅ 自定义成长维度
- ✅ 权重设置
- ✅ 添加新维度

**👤 身份系统：**
- ✅ 身份层级管理
- ✅ 升级条件
- ✅ 添加新层级

**⚡ 防拖延：**
- ✅ 严格度设置（低/中/高）
- ✅ 按任务类型设置
- ✅ 验证规则开关

**💰 金币经济：**
- ✅ 奖励系数设置
- ✅ 任务类型系数
- ✅ 惩罚参数

---

## ❌ 未实现功能

### 核心功能缺失

1. **任务验证系统**
   - ❌ 人脸识别验证
   - ❌ 位置验证
   - ❌ 拍照验证
   - ❌ 文件上传验证

2. **通知系统**
   - ❌ 任务提醒通知
   - ❌ 浏览器通知
   - ❌ 语音提醒

3. **数据统计**
   - ❌ 实时数据统计
   - ❌ 图表可视化
   - ❌ 趋势分析

4. **用户系统**
   - ❌ 用户注册/登录
   - ❌ 多用户支持
   - ❌ 用户权限管理

5. **社交功能**
   - ❌ 分享到社交媒体
   - ❌ 好友系统
   - ❌ 排行榜

---

## 🔄 数据流转逻辑

```
用户操作
    ↓
前端状态更新（Zustand）
    ↓
本地存储（LocalStorage）
    ↓
云端同步（Supabase）
    ↓
其他设备接收更新
```

**同步机制：**
- 实时同步：每次操作立即同步
- 定时同步：按设置的频率同步
- 冲突解决：优先云端/优先本地/手动选择

---

## 🎮 操作快捷键

**全局：**
- 无快捷键（待实现）

**时间轴：**
- 拖拽：移动任务时间
- Shift+拖拽：复制任务
- 右键：打开菜单

**AI助手：**
- Enter：发送消息
- Shift+Enter：换行

---

## 📊 数据存储

**本地存储（LocalStorage）：**
- 模块配置
- 用户设置
- 临时数据

**云端存储（Supabase）：**
- 任务数据
- 目标数据
- 习惯记录
- 日记记录
- 金币交易
- 成长数据

**存储限制：**
- LocalStorage：约5MB
- Supabase：无限制（取决于套餐）

---

## 🐛 已知问题

1. ✅ 时间轴滚动条已修复
2. ✅ AI助手背景色已统一
3. ✅ 浮动按钮位置已调整
4. ⚠️ 部分功能仅有UI，无实际逻辑
5. ⚠️ 数据统计功能未实现

---

## 🎯 使用建议

**推荐工作流：**

1. **早上：**
   - 打开时间轴，查看今日任务
   - 使用AI助手分解今日计划
   - 推送任务到时间轴

2. **执行中：**
   - 按时间轴执行任务
   - 完成后标记完成
   - 记录心情和想法到全景记忆

3. **晚上：**
   - 查看日报，回顾今日
   - 记录成功和感恩日记
   - 检查坏习惯记录

4. **定期：**
   - 每周查看周报（需解锁）
   - 每月查看月报（需解锁）
   - 调整长期目标进度

---

## 💡 提示

- 所有模块都支持自定义背景色
- 所有模块都支持拖拽移动和缩放
- 数据会自动保存到云端
- 可以在多个设备间同步
- AI功能需要配置API Key

---

**最后更新：** 2024年1月23日

