# ManifestOS 交互逻辑与功能清单

## 📱 整体架构

```
主页（可自定义仪表盘）
├── 左侧：功能模块图标栏（可上传自定义图标）
├── 中间：拖拽式模块区域（可自由布局）
└── 右下角：浮动按钮（AI助手 + Kiki语音）
```

---

## ✅ 已实现功能

### 1️⃣ 可自定义仪表盘系统

**核心交互：**
- 点击左侧图标 → 添加/显示模块到主页
- 拖拽模块头部 → 移动位置
- 拖拽模块右下角 → 调整大小
- 点击🎨按钮 → 修改模块背景颜色
- 点击❌按钮 → 隐藏模块（不删除）
- 右键图标 → 上传自定义图标

**可用模块：**
- 📊 总控面板：今日任务、成长值、金币余额概览
- 🎯 长期目标：创建、编辑、追踪长期目标
- 📅 时间轴：日历+24小时时间轴，任务管理
- 💰 金币经济：金币余额、商店、交易记录
- ⚠️ 坏习惯：追踪、分析、改进计划
- 📈 数据报告：日报（免费）、周报/月报（付费）
- ⚙️ 设置：云同步、外观、通知、成长维度等
- 🎤 Kiki宝宝：语音助手入口
- 📔 成功&感恩日记：记录成功和感恩事件
- 🧠 全景记忆栏：心情、想法、待办记录
- 🖼️ 图片组件：上传图片装饰主页

**数据持久化：**
- ✅ 自动保存到 Supabase 云端
- ✅ 实时同步（可配置频率）
- ✅ 支持多设备同步

---

### 2️⃣ 时间轴系统

**布局：**
```
上半部分：日历视图（月视图/周视图切换）
下半部分：24小时时间轴（可滚动）
```

**核心交互：**
- 点击日历日期 → 切换到该天的时间轴
- 拖拽任务块 → 调整任务时间
- 拖拽任务底部 → 调整任务时长
- 右键任务 → 编辑/完成/复制/删除
- 点击"新建任务" → 创建任务
- 切换时间粒度 → 30/15/5分钟

**时间轴特性：**
- ✅ 左侧时间刻度 + 右侧内容一起滚动
- ✅ 红色NOW线显示当前时间
- ✅ 任务块颜色区分类型
- ✅ 任务状态图标（⏳待办、▶️进行中、✅完成、⚠️逾期）
- ✅ 自定义滚动条（灰色，可见）

**已实现：**
- ✅ 创建任务
- ✅ 编辑任务
- ✅ 删除任务
- ✅ 拖拽调整时间
- ✅ 拖拽调整时长
- ✅ 任务状态管理
- ✅ 背景色自定义

**未实现：**
- ❌ 任务重复设置（每天、每周、每月）
- ❌ 任务模板
- ❌ 批量操作

---

### 3️⃣ AI助手（浮动面板）

**位置：** 右下角第二个按钮（🤖）

**核心交互：**
- 点击按钮 → 打开/关闭面板
- 拖拽头部 → 移动位置
- 拖拽右下角 → 调整大小
- 点击🎨 → 修改背景颜色
- 点击⚙️ → 打开API配置
- 点击最小化 → 收起面板

**定位方式：**
- ✅ 绝对定位（absolute）：跟随页面滚动
- ✅ 状态持久化：展开状态、位置、大小、颜色刷新后保持
- ✅ 智能显示：展开后浮动按钮自动隐藏

**AI功能：**
- ✅ 自然语言任务分解
  - 输入："5分钟后洗漱然后吃饭"
  - AI自动分解为多个任务，智能分配时长
  
- ✅ 智能动线优化
  - 根据家里格局（厕所→工作区→厨房→客厅→卧室→拍摄间）
  - 自动排序任务，减少走动
  
- ✅ 任务编辑器
  - 修改任务标题
  - 调整任务时长
  - 拖拽排序
  - 删除任务
  
- ✅ 推送到时间轴
  - 一键将编辑好的任务推送到时间轴
  
- ✅ 心情记录
  - 输入心情，AI自动识别类型
  - 自动打标签（情绪、分类）
  - 自动计算奖励（金币、成长值）
  - 保存到全景记忆栏
  
- ✅ 查询任务
  - "查看今天的任务"
  - 显示完成情况、总时长

- ✅ AI思考过程可视化
  - 显示AI思考步骤
  - 可折叠/展开查看详细过程
  - 沙漏图标表示处理中

**快速按钮：**
- 🎯 **帮我安排**：根据习惯智能推荐当前适合做的任务
- 💡 **推荐任务**：根据时间和状态推荐任务
- ⚡ **优化时间**：优化任务安排，提高效率
- 📊 **查看进度**：查看今日任务进度

**API配置：**
- ✅ DeepSeek API（AI功能）
- ✅ 自定义 Base URL
- ✅ API Key 配置
- ✅ 测试连接

**已实现：**
- ✅ 任务分解
- ✅ 动线优化
- ✅ 任务编辑
- ✅ 心情记录
- ✅ 标签识别
- ✅ 目标关联
- ✅ 状态持久化（位置、大小、颜色、展开状态）
- ✅ 思考过程可视化
- ✅ 智能推荐按钮

**未实现：**
- ❌ 语音输入
- ❌ 图片识别
- ❌ 上下文记忆（多轮对话）
- ❌ 习惯学习（需要长期数据积累）

---

### 4️⃣ Kiki语音助手（浮动按钮）

**位置：** 右下角第一个按钮（🎤）

**核心交互：**
- 点击按钮 → 唤醒Kiki
- 说"Kiki" → 语音唤醒
- 语音输入 → 执行命令

**已实现：**
- ✅ 语音唤醒
- ✅ 语音识别（Web Speech API）
- ✅ 语音播报
- ✅ 浮动模式

**未实现：**
- ❌ 自然语言理解（需要AI）
- ❌ 语音创建任务
- ❌ 语音查询数据

---

### 5️⃣ 长期目标系统

**核心交互：**
- 点击"添加目标" → 创建新目标
- 点击目标卡片 → 查看详情
- 编辑目标 → 修改名称、描述、截止日期
- 删除目标 → 移除目标

**目标特性：**
- ✅ 目标名称、描述
- ✅ 截止日期
- ✅ 进度追踪
- ✅ 关联任务自动更新进度

**已实现：**
- ✅ 创建目标
- ✅ 编辑目标
- ✅ 删除目标
- ✅ 进度显示

**未实现：**
- ❌ 子目标/里程碑
- ❌ 目标模板
- ❌ 目标分享

---

### 6️⃣ 金币经济系统

**核心交互：**
- 完成任务 → 自动获得金币
- 点击"奖励商店" → 查看可兑换物品
- 点击"交易记录" → 查看金币历史

**商店分类：**
- 实用功能：赎回时间、解锁报告、任务提示
- 特权购买：免监控券、时间暂停卡、双倍奖励
- 真实奖励：自定义奖励（看电影、买零食等）

**自定义奖励：**
- ✅ 添加奖励名称
- ✅ 设置价格
- ✅ AI自动生成图标（根据名称）
- ✅ 预览效果

**已实现：**
- ✅ 金币余额显示
- ✅ 商店系统
- ✅ 自定义奖励
- ✅ 交易记录

**未实现：**
- ❌ 实际兑换功能
- ❌ 金币消费
- ❌ 金币统计图表

---

### 7️⃣ 坏习惯追踪系统

**核心交互：**
- 点击"记录坏习惯" → 添加记录
- 点击习惯卡片 → 查看详情
- 查看时间分布 → 热力图
- 开始改进计划 → 21天计划

**习惯特性：**
- ✅ 纯净度仪表盘（0-100%）
- ✅ 习惯频率统计
- ✅ 时间分布热力图
- ✅ 连续控制天数
- ✅ 严重程度评分

**改进计划：**
- 意识期（1-7天）：每天记录
- 调整期（8-14天）：提供替代方案
- 巩固期（15-21天）：强化新习惯

**已实现：**
- ✅ 记录坏习惯
- ✅ 统计分析
- ✅ 热力图
- ✅ 改进计划框架

**未实现：**
- ❌ 自动检测坏习惯
- ❌ 实时提醒
- ❌ AI教练陪伴

---

### 8️⃣ 数据报告系统

**报告类型：**
- 📅 日报（免费）：今日完成、用时、金币、成长值
- 📆 周报（100金币）：效率分析、趋势图表、改进建议
- 📊 月报（300金币）：深度洞察、成长轨迹、下月规划

**报告内容：**
- ✅ 核心数据统计
- ✅ 今日亮点
- ✅ 待改进项
- ✅ 明日建议

**成长故事：**
- 今日故事、本周叙事、月度史诗、年度传记
- ✅ AI生成叙事文本
- ✅ 分享功能

**已实现：**
- ✅ 日报生成
- ✅ 周报/月报解锁机制
- ✅ 成长故事
- ✅ 实际数据统计（已集成统计服务）

**未实现：**
- ❌ 高级图表可视化（折线图、饼图等）
- ❌ PDF导出
- ❌ 报告分享

---

### 9️⃣ 成功&感恩日记

**核心交互：**
- 点击"添加记录" → 选择类型（成功/感恩）
- 输入内容 → 保存
- 查看历史 → 浏览过往记录

**已实现：**
- ✅ 创建日记
- ✅ 查看日记
- ✅ 类型分类

**未实现：**
- ❌ 日记搜索
- ❌ 日记标签
- ❌ 日记导出

---

### 🔟 全景记忆栏

**记录类型：**
- 心情记录：记录情绪状态
- 碎碎念：随手记录想法
- 待办事项：快速记录待办
- 成功日记：记录成就
- 感恩日记：记录感恩

**AI功能：**
- ✅ 自动识别类型
- ✅ 自动打标签（情绪、分类）
- ✅ 自动计算奖励

**已实现：**
- ✅ 创建记录
- ✅ AI标签
- ✅ 奖励计算

**未实现：**
- ❌ 记录搜索
- ❌ 记录筛选
- ❌ 记录统计

---

### 1️⃣1️⃣ 设置系统

**设置分类：**

**☁️ 云同步：**
- ✅ 自动同步开关
- ✅ 同步频率（实时/1分钟/5分钟/15分钟）
- ✅ 启动时同步
- ✅ 冲突解决策略
- ✅ 同步范围选择
- ✅ 手动同步
- ✅ 导出数据
- ✅ 清除缓存

**🎨 外观体验：**
- ✅ 主题切换（明亮/暗色/自动）
- ✅ 主色调选择
- ✅ 字体大小（小/中/大）
- ✅ 界面密度（紧凑/标准/宽松）
- ✅ 默认视图

**🔔 通知语音：**
- ✅ 通知开关（任务提醒、成长提醒等）
- ✅ 免打扰时段
- ✅ AI语音类型（温柔女声/活力女声/沉稳男声/阳光男声）
- ✅ 语速调节
- ✅ 唤醒词灵敏度

**📊 成长维度：**
- ✅ 自定义成长维度
- ✅ 权重设置
- ✅ 添加新维度

**👤 身份系统：**
- ✅ 身份层级管理
- ✅ 升级条件
- ✅ 添加新层级

**⚡ 防拖延：**
- ✅ 严格度设置（低/中/高）
- ✅ 按任务类型设置
- ✅ 验证规则开关

**💰 金币经济：**
- ✅ 奖励系数设置
- ✅ 任务类型系数
- ✅ 惩罚参数

---

### 1️⃣2️⃣ 任务验证系统 ✅

**验证类型：**
- ✅ 拍照验证：使用摄像头拍照验证任务完成
- ✅ 图片上传验证：上传图片证明任务完成
- ✅ 文件上传验证：上传文件（支持多种格式）

**验证时机：**
- ✅ 任务开始验证：开始任务前需要验证
- ✅ 任务完成验证：完成任务后需要验证
- ✅ 双重验证：开始和完成都需要验证

**验证流程：**
1. 任务到达验证时间
2. 弹出验证窗口（倒计时）
3. 用户拍照/上传图片/上传文件
4. **AI智能识别验证（已接入真实AI服务）**
5. 验证成功 → 继续任务
6. 验证失败 → **扣除金币（20金币）**
7. 跳过验证 → **扣除金币（50金币）**

**验证特性：**
- ✅ 倒计时限制（默认120秒）
- ✅ 实时摄像头预览
- ✅ 文件类型限制
- ✅ 文件大小限制
- ✅ 重新拍照/上传
- ✅ AI识别动画
- ✅ **真实AI验证（调用用户配置的API Key）**
- ✅ **金币扣除机制（验证失败-20，跳过-50）**
- ✅ **验证统计分析**

**AI验证提示词：**
- **图片验证**：分析图片内容是否与任务要求匹配，判断清晰度、相关性、真实性
- **文件验证**：分析文件名、类型、大小是否符合任务要求，识别测试文件

**已实现功能：**
- ✅ 拍照验证UI和交互
- ✅ 图片上传验证
- ✅ 文件上传验证
- ✅ 验证倒计时
- ✅ 验证结果反馈
- ✅ **AI智能验证（aiService.verifyTaskImage / verifyTaskFile）**
- ✅ **金币扣除系统（userStore.deductGold）**
- ✅ **集成到任务流程（TimelineCalendar开始/完成任务）**
- ✅ **验证统计（statisticsService.calculateVerificationStats）**
- ✅ **验证趋势分析（statisticsService.getVerificationTrend）**

**使用教程：**

1. **创建需要验证的任务**
   - 在任务中配置 `verificationStart` 或 `verificationComplete`
   - 设置验证类型：`photo`（拍照）、`upload`（图片上传）、`file`（文件上传）
   - 设置验证要求描述（AI会根据此描述判断）

2. **开始任务验证**
   - 点击任务的"开始"按钮
   - 如果配置了开始验证，会弹出验证窗口
   - 拍照或上传文件
   - AI自动识别验证（需要配置API Key）
   - 验证通过：任务开始执行
   - 验证失败：扣除20金币，可重试或跳过
   - 跳过验证：扣除50金币，直接开始任务

3. **完成任务验证**
   - 点击任务的"完成"按钮
   - 如果配置了完成验证，会弹出验证窗口
   - 上传完成证明（截图、文件等）
   - AI验证通过后任务标记为完成，获得金币奖励

4. **查看验证统计**
   - 在统计面板查看验证成功率
   - 查看验证失败和跳过次数
   - 查看因验证损失的金币
   - 查看验证趋势图表

**验证配置示例：**
```typescript
{
  verificationStart: {
    type: 'photo',
    requirement: '拍摄健身房内的照片，需要包含健身器材',
    timeout: 120
  },
  verificationComplete: {
    type: 'upload',
    requirement: '上传锻炼后的自拍照或运动数据截图',
    timeout: 180
  }
}
```

**未实现功能：**
- ❌ 验证历史记录存储和查看
- ❌ 位置验证（GPS定位）
- ❌ 人脸识别验证
- ❌ 验证照片/文件的云端存储

---

### 1️⃣3️⃣ 通知系统 ✅

**通知类型：**
- ✅ 任务提醒通知（提前5分钟）
- ✅ 任务开始通知
- ✅ 任务完成通知
- ✅ 任务逾期通知
- ✅ 成长里程碑通知
- ✅ 身份升级通知
- ✅ 坏习惯警告通知
- ✅ 每日报告通知

**通知方式：**
- ✅ 浏览器通知（需要授权）
- ✅ 语音播报（可选）
- ✅ 应用内通知

**通知设置：**
- ✅ 通知开关（总开关）
- ✅ 语音播报开关
- ✅ 提前提醒时间（1-30分钟可调）
- ✅ 免打扰时段（开始时间-结束时间）
- ✅ 通知类型选择（8种类型独立开关）
- ✅ 测试通知功能

**通知特性：**
- ✅ 权限请求
- ✅ 权限状态检测
- ✅ 自动关闭（5秒）
- ✅ 点击跳转
- ✅ 免打扰时段自动静音

**已实现：**
- ✅ 浏览器通知API集成
- ✅ 语音播报（Web Speech API）
- ✅ 通知设置界面
- ✅ 任务提醒调度

**未实现：**
- ❌ 推送通知（PWA）
- ❌ 邮件通知
- ❌ 微信通知

---

### 1️⃣4️⃣ 数据统计系统 ✅

**统计维度：**
- ✅ 日统计：每日任务、金币、成长值、坏习惯
- ✅ 周统计：7天汇总、趋势分析、高峰时段
- ✅ 月统计：4周汇总、成长轨迹、预测分析

**统计内容：**

**每日统计：**
- ✅ 任务完成率（完成数/总数）
- ✅ 总用时（小时+分钟）
- ✅ 金币收支（收入/支出/余额）
- ✅ 成长值增长
- ✅ 坏习惯次数
- ✅ 任务类型分布
- ✅ 任务状态分布
- ✅ 24小时时间分布
- ✅ 成长维度TOP5

**每周统计：**
- ✅ 周汇总数据
- ✅ 每日详情列表
- ✅ 平均完成率
- ✅ 最高效/最低效日期
- ✅ 高峰时段识别（TOP3）
- ✅ 改进率计算

**每月统计：**
- ✅ 月汇总数据
- ✅ 每周详情列表
- ✅ 成长趋势图数据
- ✅ 习惯趋势图数据
- ✅ 下月预测（成长值、金币）
- ✅ 风险区域识别

**实时统计：**
- ✅ 今日完成任务数
- ✅ 今日总任务数
- ✅ 今日获得金币
- ✅ 当前连续完成天数
- ✅ 金币总余额

**统计展示：**
- ✅ 概览卡片（4个核心指标）
- ✅ 任务类型分布图
- ✅ 24小时时间分布柱状图
- ✅ 成长维度进度条
- ✅ 每日详情列表（周视图）
- ✅ 趋势预测卡片（月视图）
- ✅ 风险提示（月视图）
- ✅ 可折叠区域

**已实现：**
- ✅ 统计服务（statisticsService）
- ✅ 日/周/月统计计算
- ✅ 实时统计
- ✅ 统计面板UI
- ✅ 时间范围切换
- ✅ 日期选择器

**未实现：**
- ❌ 图表可视化（目前是简单柱状图）
- ❌ 数据导出（CSV/PDF）
- ❌ 自定义统计维度
- ❌ 对比分析（周对周、月对月）

---

## ❌ 未实现功能

### 核心功能缺失

1. **用户系统**
   - ❌ 用户注册/登录
   - ❌ 多用户支持
   - ❌ 用户权限管理

2. **社交功能**
   - ❌ 分享到社交媒体
   - ❌ 好友系统
   - ❌ 排行榜

3. **高级功能**
   - ❌ 数据导出（CSV/PDF）
   - ❌ 任务模板
   - ❌ 批量操作
   - ❌ 快捷键系统

---

## 🔄 数据流转逻辑

```
用户操作
    ↓
前端状态更新（Zustand）
    ↓
本地存储（LocalStorage）
    ↓
云端同步（Supabase）
    ↓
其他设备接收更新
```

**同步机制：**
- 实时同步：每次操作立即同步
- 定时同步：按设置的频率同步
- 冲突解决：优先云端/优先本地/手动选择

---

## 🎮 操作快捷键

**全局：**
- 无快捷键（待实现）

**时间轴：**
- 拖拽：移动任务时间
- Shift+拖拽：复制任务
- 右键：打开菜单

**AI助手：**
- Enter：发送消息
- Shift+Enter：换行

---

## 📊 数据存储

**本地存储（LocalStorage）：**
- 模块配置
- 用户设置
- 临时数据

**云端存储（Supabase）：**
- 任务数据
- 目标数据
- 习惯记录
- 日记记录
- 金币交易
- 成长数据

**存储限制：**
- LocalStorage：约5MB
- Supabase：无限制（取决于套餐）

---

## 🐛 已知问题

1. ✅ 时间轴滚动条已修复
2. ✅ AI助手背景色已统一
3. ✅ 浮动按钮位置已调整
4. ✅ 任务验证系统已实现
5. ✅ 通知系统已实现
6. ✅ 数据统计系统已实现
7. ✅ AI助手状态持久化已实现
8. ✅ 时间轴高度显示已修复
9. ⚠️ 部分功能仅有UI，无实际业务逻辑
10. ⚠️ AI验证识别目前是模拟（需要接入真实AI服务）

---

## 🎯 使用建议

**推荐工作流：**

1. **早上：**
   - 打开时间轴，查看今日任务
   - 使用AI助手分解今日计划
   - 推送任务到时间轴

2. **执行中：**
   - 按时间轴执行任务
   - 完成后标记完成
   - 记录心情和想法到全景记忆

3. **晚上：**
   - 查看日报，回顾今日
   - 记录成功和感恩日记
   - 检查坏习惯记录

4. **定期：**
   - 每周查看周报（需解锁）
   - 每月查看月报（需解锁）
   - 调整长期目标进度

---

## 💡 提示

- 所有模块都支持自定义背景色
- 所有模块都支持拖拽移动和缩放
- 数据会自动保存到云端
- 可以在多个设备间同步
- AI功能需要配置API Key

---

---

## 🔁 重复代码说明

### 为什么会有重复代码？

在开发过程中，某些功能模块可能存在代码重复的情况，主要原因如下：

### 1. **模块独立性设计**

**原因：** 每个功能模块（如统计面板、通知设置、任务验证）都设计为独立组件，可以单独使用和维护。

**重复内容：**
- 状态管理逻辑（useState, useEffect）
- 数据加载逻辑
- UI样式代码（卡片、按钮、表单）

**优点：**
- ✅ 模块解耦，易于维护
- ✅ 可以独立测试
- ✅ 可以单独导出使用

**缺点：**
- ⚠️ 代码量增加
- ⚠️ 修改需要同步多处

### 2. **服务层与组件层分离**

**设计模式：**
```
服务层（Service）
    ↓
业务逻辑处理
    ↓
组件层（Component）
    ↓
UI展示
```

**重复内容：**
- 数据转换逻辑（服务层和组件层都有）
- 错误处理逻辑
- 加载状态管理

**原因：**
- 服务层：纯数据处理，不依赖UI
- 组件层：UI展示，需要适配不同场景

### 3. **类型定义重复**

**重复内容：**
- 任务类型（Task）
- 统计类型（Statistics）
- 通知类型（Notification）

**原因：**
- TypeScript 类型系统要求
- 不同模块需要不同的类型子集
- 避免循环依赖

**解决方案：**
- ✅ 已在 `src/types/index.ts` 中统一定义
- ✅ 各模块通过 import 引用

### 4. **UI组件重复**

**重复内容：**
- 卡片组件（Card）
- 按钮组件（Button）
- 表单组件（Form）
- 模态框组件（Modal）

**原因：**
- 不同模块需要不同的样式变体
- 避免过度抽象导致难以维护
- 快速开发优先

**优化建议：**
- 🔄 可以抽取为通用组件库
- 🔄 使用 Tailwind 的 @apply 减少重复
- 🔄 创建设计系统（Design System）

### 5. **数据处理逻辑重复**

**重复内容：**
- 日期格式化
- 数据过滤
- 数据排序
- 数据聚合

**原因：**
- 不同场景需要不同的处理方式
- 性能优化（避免过度抽象）

**优化建议：**
- 🔄 可以抽取为工具函数（utils）
- 🔄 使用 lodash 等工具库

### 6. **状态管理重复**

**重复内容：**
- LocalStorage 读写
- Zustand store 定义
- 状态同步逻辑

**原因：**
- 不同模块管理不同的状态
- 避免全局状态过于庞大
- 模块独立性

**当前架构：**
```
全局状态（Zustand）
├── userStore（用户数据）
├── taskStore（任务数据）
├── growthStore（成长数据）
└── 各模块独立状态
```

### 7. **API调用重复**

**重复内容：**
- Supabase 查询
- 错误处理
- 加载状态

**原因：**
- 不同模块访问不同的数据表
- 需要不同的查询条件

**优化建议：**
- 🔄 可以创建统一的 API 层
- 🔄 使用 React Query 管理请求

---

## 🔧 代码优化建议

### 短期优化（已完成）

1. ✅ 统一类型定义（types/index.ts）
2. ✅ 创建服务层（services/）
3. ✅ 模块化组件（components/）
4. ✅ 创建自定义Hooks（useColorTheme, useDraggable, useResizable, useTaskEditor, useThinkingProcess）
5. ✅ 创建工具函数库（taskUtils.ts）
6. ✅ 优化FloatingAIChat组件（减少400+行代码）

### 中期优化（可选）

1. 🔄 抽取通用组件库
   - Card, Button, Modal, Form 等
   - 统一样式系统

2. 🔄 创建工具函数库
   - 日期处理（dateUtils）
   - 数据处理（dataUtils）
   - 格式化（formatUtils）

3. 🔄 优化状态管理
   - 减少重复的 useState
   - 使用自定义 Hooks

### 长期优化（未来）

1. 🔄 引入设计系统
   - 统一设计规范
   - 组件库文档

2. 🔄 代码分割
   - 按路由分割
   - 按功能分割

3. 🔄 性能优化
   - 虚拟滚动
   - 懒加载
   - 缓存策略

---

## 📝 重复代码清单

### 高频重复代码

1. **卡片样式**
   - 位置：几乎所有模块
   - 重复次数：50+
   - 优化优先级：⭐⭐⭐

2. **按钮样式**
   - 位置：所有交互组件
   - 重复次数：100+
   - 优化优先级：⭐⭐⭐

3. **日期格式化**
   - 位置：统计、报告、日记等
   - 重复次数：30+
   - 优化优先级：⭐⭐

4. **加载状态**
   - 位置：所有数据加载组件
   - 重复次数：20+
   - 优化优先级：⭐⭐

5. **错误处理**
   - 位置：所有API调用
   - 重复次数：40+
   - 优化优先级：⭐

### 低频重复代码

1. **模态框逻辑**
   - 重复次数：10+
   - 优化优先级：⭐

2. **表单验证**
   - 重复次数：15+
   - 优化优先级：⭐

---

## 💡 开发建议

### 对于新功能开发

1. **优先使用现有服务**
   - statisticsService（数据统计）
   - notificationService（通知）
   - 其他服务层

2. **复用现有组件**
   - 查看 components/ 目录
   - 优先组合而非重写

3. **遵循现有模式**
   - 服务层处理逻辑
   - 组件层处理UI
   - 类型定义在 types/

### 对于代码重构

1. **不要过度优化**
   - 重复不一定是坏事
   - 保持代码可读性

2. **渐进式重构**
   - 先完成功能
   - 再优化代码

3. **测试覆盖**
   - 重构前确保有测试
   - 避免引入新bug

---

**最后更新：** 2024年1月24日
**版本：** v1.3.0
**新增功能：** AI助手状态持久化、智能推荐按钮、代码优化（自定义Hooks和工具函数库）、时间轴显示修复

