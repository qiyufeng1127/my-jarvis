# ç™¾åº¦API CORSä¿®å¤æ€»ç»“

## âœ… å·²å®Œæˆçš„å·¥ä½œ

### 1. åˆ›å»º Serverless API ä»£ç†

#### å›¾åƒè¯†åˆ« API
- **æ–‡ä»¶**: `api/baidu-image-recognition.ts`
- **ç«¯ç‚¹**: `/api/baidu-image-recognition`
- **åŠŸèƒ½**: ä»£ç†ç™¾åº¦å›¾åƒè¯†åˆ«APIè°ƒç”¨

#### è¯­éŸ³è¯†åˆ« API
- **æ–‡ä»¶**: `api/baidu-voice-recognition.ts`
- **ç«¯ç‚¹**: `/api/baidu-voice-recognition`
- **åŠŸèƒ½**: ä»£ç†ç™¾åº¦è¯­éŸ³è¯†åˆ«APIè°ƒç”¨

### 2. æ›´æ–° Vercel é…ç½®
- **æ–‡ä»¶**: `vercel.json`
- æ·»åŠ  `/api/:path*` è·¯ç”±
- é…ç½® CORS å¤´

### 3. æ›´æ–°å®¢æˆ·ç«¯æœåŠ¡

#### å›¾åƒè¯†åˆ«æœåŠ¡
- **æ–‡ä»¶**: `src/services/baiduImageRecognition.ts`
- æ·»åŠ  `isProduction()` ç¯å¢ƒæ£€æµ‹
- ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ Serverless API
- å¼€å‘ç¯å¢ƒç›´æ¥è°ƒç”¨ç™¾åº¦API

#### è¯­éŸ³è¯†åˆ«æœåŠ¡
- **æ–‡ä»¶**: `src/services/baiduVoiceRecognition.ts`
- æ·»åŠ  `isProduction()` ç¯å¢ƒæ£€æµ‹
- ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ Serverless API
- å¼€å‘ç¯å¢ƒç›´æ¥è°ƒç”¨ç™¾åº¦API

## ğŸ¯ è§£å†³çš„é—®é¢˜

### é—®é¢˜1: å›¾åƒéªŒè¯CORSé”™è¯¯
- **ç°è±¡**: ä¸Šä¼ å›¾ç‰‡éªŒè¯æ—¶æŠ¥é”™ `Unexpected token '<', "<!doctype "...`
- **åŸå› **: æµè§ˆå™¨ç›´æ¥è°ƒç”¨ç™¾åº¦APIè¢«CORSæ‹¦æˆª
- **è§£å†³**: ä½¿ç”¨Serverless APIä»£ç†

### é—®é¢˜2: è¯­éŸ³è¯†åˆ«CORSé”™è¯¯ï¼ˆæ½œåœ¨ï¼‰
- **ç°è±¡**: å…æ‰‹æ¨¡å¼è¯­éŸ³è¯†åˆ«å¯èƒ½å¤±è´¥
- **åŸå› **: åŒæ ·çš„CORSé—®é¢˜
- **è§£å†³**: ä½¿ç”¨Serverless APIä»£ç†

## ğŸ“Š æ¶æ„å¯¹æ¯”

### ä¿®å¤å‰
```
æµè§ˆå™¨ â†’ ç™¾åº¦API (âŒ CORSé”™è¯¯)
```

### ä¿®å¤å

**å¼€å‘ç¯å¢ƒ**:
```
æµè§ˆå™¨ â†’ ç™¾åº¦API (âœ… æœ¬åœ°æ— CORSé™åˆ¶)
```

**ç”Ÿäº§ç¯å¢ƒ**:
```
æµè§ˆå™¨ â†’ Serverless API â†’ ç™¾åº¦API (âœ… æœåŠ¡ç«¯è°ƒç”¨æ— CORS)
```

## ğŸš€ éƒ¨ç½²æ­¥éª¤

```bash
# 1. æäº¤ä»£ç 
git add .
git commit -m "fix: ä¿®å¤ç™¾åº¦API CORSé—®é¢˜ï¼ˆå›¾åƒ+è¯­éŸ³ï¼‰"
git push

# 2. Vercelè‡ªåŠ¨éƒ¨ç½²
# - è‡ªåŠ¨éƒ¨ç½² Serverless Functions
# - è‡ªåŠ¨é…ç½®è·¯ç”±

# 3. æµ‹è¯•
# - æµ‹è¯•å›¾åƒéªŒè¯
# - æµ‹è¯•è¯­éŸ³è¯†åˆ«
```

## âœ… æµ‹è¯•æ¸…å•

### å›¾åƒéªŒè¯
- [ ] æœ¬åœ°ç¯å¢ƒï¼šä¸Šä¼ å›¾ç‰‡éªŒè¯æ­£å¸¸
- [ ] ç”Ÿäº§ç¯å¢ƒï¼šä¸Šä¼ å›¾ç‰‡éªŒè¯æ­£å¸¸
- [ ] æ§åˆ¶å°æ˜¾ç¤º "â˜ï¸ [ç”Ÿäº§ç¯å¢ƒ] ä½¿ç”¨Serverless API"
- [ ] è¯†åˆ«ç»“æœæ­£ç¡®è¿”å›
- [ ] ä¸å†å‡ºç°CORSé”™è¯¯

### è¯­éŸ³è¯†åˆ«
- [ ] æœ¬åœ°ç¯å¢ƒï¼šè¯­éŸ³è¯†åˆ«æ­£å¸¸
- [ ] ç”Ÿäº§ç¯å¢ƒï¼šè¯­éŸ³è¯†åˆ«æ­£å¸¸
- [ ] æ§åˆ¶å°æ˜¾ç¤º "â˜ï¸ [ç”Ÿäº§ç¯å¢ƒ] ä½¿ç”¨Serverless APIè¿›è¡Œè¯­éŸ³è¯†åˆ«"
- [ ] è¯­éŸ³è½¬æ–‡å­—æ­£ç¡®
- [ ] ä¸å†å‡ºç°CORSé”™è¯¯

## ğŸ”’ å®‰å…¨æ€§

1. **APIå¯†é’¥ä¿æŠ¤**
   - å¯†é’¥é€šè¿‡POSTè¯·æ±‚ä½“ä¼ é€’
   - ä¸æš´éœ²åœ¨URLä¸­
   - Serverless Functionåœ¨æœåŠ¡ç«¯æ‰§è¡Œ

2. **CORSé…ç½®**
   - å…è®¸æ‰€æœ‰æ¥æºï¼ˆ`*`ï¼‰
   - ä»…å…è®¸POSTå’ŒOPTIONSæ–¹æ³•
   - ç”Ÿäº§ç¯å¢ƒå¯ä»¥é™åˆ¶ç‰¹å®šåŸŸå

## âš¡ æ€§èƒ½ä¼˜åŒ–

1. **Tokenç¼“å­˜**
   - Access Tokenç¼“å­˜åœ¨Serverless Functionå†…å­˜
   - é¿å…é¢‘ç¹è¯·æ±‚Token
   - æå‰1å¤©åˆ·æ–°ï¼Œé¿å…è¿‡æœŸ

2. **å¯é€‰åŠŸèƒ½**
   - å›¾åƒè¯†åˆ«ï¼šåœºæ™¯è¯†åˆ«å’Œç‰©ä½“æ£€æµ‹åœ¨ç”Ÿäº§ç¯å¢ƒç¦ç”¨
   - åªä¿ç•™æ ¸å¿ƒçš„é€šç”¨ç‰©ä½“è¯†åˆ«
   - å‡å°‘APIè°ƒç”¨æ¬¡æ•°

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **ç¯å¢ƒæ£€æµ‹**
   - è‡ªåŠ¨æ£€æµ‹ `vercel.app` åŸŸå
   - è‡ªåŠ¨æ£€æµ‹ `import.meta.env.PROD`
   - å¯ä»¥æ·»åŠ è‡ªå®šä¹‰åŸŸå

2. **APIé…ç½®**
   - ç”¨æˆ·éœ€è¦åœ¨è®¾ç½®ä¸­é…ç½®ç™¾åº¦APIå¯†é’¥
   - å¯†é’¥å­˜å‚¨åœ¨localStorage
   - æ¯æ¬¡è¯·æ±‚éƒ½ä¼šä¼ é€’ç»™Serverless API

3. **é”™è¯¯å¤„ç†**
   - å®Œæ•´çš„é”™è¯¯æ—¥å¿—
   - æ˜ç¡®çš„é”™è¯¯æç¤º
   - ä¾¿äºé—®é¢˜æ’æŸ¥

## ğŸ› æ•…éšœæ’æŸ¥

### å¦‚æœå›¾åƒéªŒè¯ä»ç„¶å¤±è´¥

1. **æ£€æŸ¥Serverless Functionéƒ¨ç½²**
   - è®¿é—® Vercel Dashboard
   - æŸ¥çœ‹ Functions æ ‡ç­¾
   - ç¡®è®¤ `baidu-image-recognition` å·²éƒ¨ç½²

2. **æ£€æŸ¥APIé…ç½®**
   - è®¾ç½® â†’ AIé…ç½®
   - ç¡®è®¤API Keyå’ŒSecret Keyæ­£ç¡®

3. **æŸ¥çœ‹æ—¥å¿—**
   - Vercel Dashboard â†’ Functions â†’ Logs
   - æŸ¥çœ‹è¯¦ç»†é”™è¯¯ä¿¡æ¯

### å¦‚æœè¯­éŸ³è¯†åˆ«ä»ç„¶å¤±è´¥

1. **æ£€æŸ¥Serverless Functionéƒ¨ç½²**
   - ç¡®è®¤ `baidu-voice-recognition` å·²éƒ¨ç½²

2. **æ£€æŸ¥APIé…ç½®**
   - è®¾ç½® â†’ AIé…ç½® â†’ ç™¾åº¦è¯­éŸ³è¯†åˆ«
   - ç¡®è®¤API Keyå’ŒSecret Keyæ­£ç¡®

3. **æŸ¥çœ‹æ—¥å¿—**
   - æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°
   - æŸ¥çœ‹Vercel Functionæ—¥å¿—

## ğŸ“š ç›¸å…³æ–‡æ¡£

- `CORS_FIX.md` - è¯¦ç»†ä¿®å¤è¯´æ˜
- `api/baidu-image-recognition.ts` - å›¾åƒè¯†åˆ«APIä»£ç 
- `api/baidu-voice-recognition.ts` - è¯­éŸ³è¯†åˆ«APIä»£ç 

## ğŸ‰ é¢„æœŸæ•ˆæœ

ä¿®å¤åï¼š
- âœ… å›¾åƒéªŒè¯åŠŸèƒ½æ­£å¸¸å·¥ä½œ
- âœ… å…æ‰‹æ¨¡å¼è¯­éŸ³è¯†åˆ«æ­£å¸¸å·¥ä½œ
- âœ… æœ¬åœ°å’Œç”Ÿäº§ç¯å¢ƒè¡¨ç°ä¸€è‡´
- âœ… ä¸å†å‡ºç°CORSé”™è¯¯
- âœ… ç”¨æˆ·ä½“éªŒæµç•…

ç°åœ¨å¯ä»¥æäº¤ä»£ç å¹¶éƒ¨ç½²äº†ï¼

