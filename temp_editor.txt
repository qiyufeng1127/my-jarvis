      {/* ç¼–è¾‘ä»»åŠ¡å¼¹çª— - ç´§å‡‘ä¼˜åŒ–ç‰ˆ */}
      {editingTask && (() => {
        const task = allTasks.find(t => t.id === editingTask);
        if (!task) return null;
        
        // åˆå§‹åŒ–ç¼–è¾‘æ•°æ®ï¼ˆé¦–æ¬¡æ‰“å¼€æ—¶ï¼‰
        if (!editedTaskData || editedTaskData.id !== editingTask) {
          setTimeout(() => setEditedTaskData(task), 0);
        }
        
        const currentEditData = editedTaskData?.id === editingTask ? editedTaskData : task;
        
        console.log('ğŸ¨ NewTimelineView ç¼–è¾‘å¼¹çª—å·²æ¸²æŸ“ - æ™ºèƒ½åˆ†é…æŒ‰é’®åº”è¯¥å¯è§');
        
        return (
          <div className="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-3" style={{ paddingBottom: '100px' }}>
            <div className="bg-white dark:bg-gray-900 rounded-2xl shadow-2xl max-w-md w-full max-h-[80vh] overflow-hidden flex flex-col border border-gray-200 dark:border-gray-700">
              {/* å¤´éƒ¨ - åªæ˜¾ç¤ºå…³é—­æŒ‰é’® */}
              <div className="flex-shrink-0 px-3 py-2 flex items-center justify-end border-b" style={{ borderColor: isDark ? '#374151' : '#e5e7eb' }}>
                <button
                  onClick={() => {
                    setEditingTask(null);
                    setEditedTaskData(null);
                  }}
                  className="p-1 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg transition-colors"
                >
                  <X className="w-4 h-4" style={{ color: isDark ? '#ffffff' : '#000000' }} />
                </button>
              </div>
            
              {/* è¡¨å•å†…å®¹ - ç´§å‡‘å¸ƒå±€ */}
              <div className="flex-1 overflow-y-auto p-3 space-y-2">
                {/* ä»»åŠ¡æ ‡é¢˜ - ç›´æ¥æ˜¾ç¤ºè¾“å…¥æ¡† */}
                <div>
                  <input
                    type="text"
                    value={currentEditData.title}
                    onChange={(e) => setEditedTaskData({ ...currentEditData, title: e.target.value })}
                    placeholder="ä»»åŠ¡æ ‡é¢˜"
                    className="w-full px-2.5 py-1.5 rounded-lg border text-base font-semibold focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all"
                    style={{ 
                      borderColor: isDark ? '#4b5563' : '#d1d5db',
                      backgroundColor: isDark ? '#374151' : '#ffffff',
                      color: isDark ? '#ffffff' : '#000000'
                    }}
                  />
                </div>
                
                {/* ä»»åŠ¡æè¿° */}
                <div>
                  <label className="block text-xs font-semibold mb-1" style={{ color: isDark ? '#ffffff' : '#000000' }}>ğŸ“„ ä»»åŠ¡æè¿°</label>
                  <textarea
                    value={currentEditData.description || ''}
                    onChange={(e) => setEditedTaskData({ ...currentEditData, description: e.target.value })}
                    rows={2}
                    className="w-full px-2.5 py-1.5 rounded-lg border-2 text-sm resize-none focus:outline-none focus:ring-2 focus:ring-purple-500 transition-all"
                    style={{ 
                      borderColor: isDark ? '#4b5563' : '#d1d5db',
                      backgroundColor: isDark ? '#374151' : '#ffffff',
                      color: isDark ? '#ffffff' : '#000000'
                    }}
                    placeholder="è¯¦ç»†æè¿°..."
                  />
                </div>
                
                {/* æ—¶é—´å’Œæ—¶é•¿ - å¹¶æ’ */}
                <div className="grid grid-cols-2 gap-2">
                  <div>
                    <label className="block text-xs font-semibold mb-1" style={{ color: isDark ? '#ffffff' : '#000000' }}>â° å¼€å§‹æ—¶é—´</label>
                    <input
                      type="time"
                      value={currentEditData.scheduledStart ? new Date(currentEditData.scheduledStart).toTimeString().slice(0, 5) : ''}
                      onChange={(e) => {
                        const [hours, minutes] = e.target.value.split(':');
                        const newDate = new Date(currentEditData.scheduledStart || new Date());
                        newDate.setHours(parseInt(hours), parseInt(minutes));
                        setEditedTaskData({ ...currentEditData, scheduledStart: newDate.toISOString() });
                      }}
                      className="w-full px-2.5 py-1.5 rounded-lg border-2 text-sm focus:outline-none focus:ring-2 focus:ring-purple-500 transition-all"
                      style={{ 
                        borderColor: isDark ? '#4b5563' : '#d1d5db',
                        backgroundColor: isDark ? '#374151' : '#ffffff',
                        color: isDark ? '#ffffff' : '#000000'
                      }}
                    />
                  </div>
                  
                  <div>
                    <label className="block text-xs font-semibold mb-1" style={{ color: isDark ? '#ffffff' : '#000000' }}>â±ï¸ æ—¶é•¿ï¼ˆåˆ†ï¼‰</label>
                    <input
