# AI ä»»åŠ¡ç¼–è¾‘å™¨ä¿®å¤è¯´æ˜

## é—®é¢˜æè¿°
ç”¨æˆ·è¾“å…¥"äº”åˆ†é’Ÿä¹‹åå»æ´—æ¼±å€’çŒ«ç²®"åï¼Œæ²¡æœ‰æ˜¾ç¤ºä»»åŠ¡ç¼–è¾‘å™¨å¼¹çª—ï¼Œè€Œæ˜¯ç›´æ¥æ˜¾ç¤ºäº†è¯†åˆ«ç»“æœã€‚

## æ ¹æœ¬åŸå› 
1. **ä»»åŠ¡è¯†åˆ«æ­£åˆ™è¡¨è¾¾å¼ä¸å¤Ÿå…¨é¢**ï¼šç¼ºå°‘"åˆ†é’Ÿå"ã€"å°æ—¶å"ã€"ä¹‹å"ç­‰æ—¶é—´å…³é”®è¯
2. **ä»»åŠ¡åˆ†è§£é˜ˆå€¼è¿‡é«˜**ï¼š`message.length > 20` å¯¼è‡´çŸ­å¥å­ä¸ä¼šè¢«åˆ†è§£
3. **AI åˆ†è§£å¤±è´¥åæ²¡æœ‰é™çº§æ–¹æ¡ˆ**ï¼šå¦‚æœ AI è°ƒç”¨å¤±è´¥ï¼Œç›´æ¥æ˜¾ç¤ºé”™è¯¯ï¼Œä¸ä¼šæ‰“å¼€ç¼–è¾‘å™¨
4. **ç¼ºå°‘è¯¦ç»†çš„è°ƒè¯•æ—¥å¿—**ï¼šæ— æ³•è¿½è¸ªé—®é¢˜å‘ç”Ÿçš„ä½ç½®
5. **æ—¶é—´è§£æé”™è¯¯**ï¼šAI è¿”å›çš„æ—¶é—´æ ¼å¼ï¼ˆ"HH:MM"ï¼‰æ²¡æœ‰æ­£ç¡®è§£æï¼Œå¯¼è‡´ `Invalid time value` é”™è¯¯

## ä¿®å¤å†…å®¹

### 1. å¢å¼ºä»»åŠ¡è¯†åˆ«æ­£åˆ™è¡¨è¾¾å¼
```javascript
// ä¿®æ”¹å‰
const isTaskCreation = /åˆ›å»º|æ·»åŠ |æ–°å»º|å®‰æ’|è®¡åˆ’|åš|å®Œæˆ|å­¦ä¹ |å·¥ä½œ|è¿åŠ¨|åˆ†è§£|æ‹†è§£|æ´—æ¼±|æ´—ç¢—|çŒ«ç²®|æ´—è¡£æœ|æ”¶æ‹¾|åƒé¥­|åƒåœ¾/.test(message);

// ä¿®æ”¹å
const isTaskCreation = /åˆ›å»º|æ·»åŠ |æ–°å»º|å®‰æ’|è®¡åˆ’|åš|å®Œæˆ|å­¦ä¹ |å·¥ä½œ|è¿åŠ¨|åˆ†è§£|æ‹†è§£|æ´—æ¼±|æ´—ç¢—|çŒ«ç²®|æ´—è¡£æœ|æ”¶æ‹¾|åƒé¥­|åƒåœ¾|åˆ†é’Ÿå|å°æ—¶å|ä¹‹å/.test(message);
```

**æ”¹è¿›**ï¼šæ·»åŠ äº†"åˆ†é’Ÿå"ã€"å°æ—¶å"ã€"ä¹‹å"ç­‰æ—¶é—´å…³é”®è¯ï¼Œç¡®ä¿æ—¶é—´ç›¸å…³çš„ä»»åŠ¡æè¿°èƒ½è¢«æ­£ç¡®è¯†åˆ«ã€‚

### 2. é™ä½ä»»åŠ¡åˆ†è§£é˜ˆå€¼
```javascript
// ä¿®æ”¹å‰
const needsDecompose = /åˆ†è§£|æ‹†è§£|è¯¦ç»†å®‰æ’|å…·ä½“æ­¥éª¤/.test(message) || message.length > 20 || /ç„¶å|æ¥ç€|å†|ä¹‹å|ï¼Œ|ã€/.test(message);

// ä¿®æ”¹å
const needsDecompose = /åˆ†è§£|æ‹†è§£|è¯¦ç»†å®‰æ’|å…·ä½“æ­¥éª¤/.test(message) || message.length > 10 || /ç„¶å|æ¥ç€|å†|ä¹‹å|ï¼Œ|ã€/.test(message);
```

**æ”¹è¿›**ï¼šå°†é•¿åº¦é˜ˆå€¼ä» 20 é™ä½åˆ° 10ï¼Œè®©æ›´å¤šçŸ­å¥å­ä¹Ÿèƒ½è¢«åˆ†è§£æˆå¤šä¸ªä»»åŠ¡ã€‚

### 3. æ·»åŠ è¯¦ç»†çš„è°ƒè¯•æ—¥å¿—
```javascript
console.log('ğŸ” [ä»»åŠ¡æ£€æµ‹] è¾“å…¥:', message);
console.log('ğŸ” [ä»»åŠ¡æ£€æµ‹] isTaskCreation:', isTaskCreation);
console.log('ğŸ” [ä»»åŠ¡æ£€æµ‹] needsDecompose:', needsDecompose);
console.log('ğŸ” [ä»»åŠ¡æ£€æµ‹] analysis.type:', analysis.type);

console.log('ğŸ” [ç¼–è¾‘å™¨] å‡†å¤‡æ‰“å¼€ç¼–è¾‘å™¨');
console.log('ğŸ” [ç¼–è¾‘å™¨] ä»»åŠ¡æ•°é‡:', tasksWithMetadata.length);
console.log('ğŸ” [ç¼–è¾‘å™¨] showTaskEditor å·²è®¾ç½®ä¸º true');
```

**æ”¹è¿›**ï¼šåœ¨å…³é”®æ­¥éª¤æ·»åŠ æ—¥å¿—ï¼Œæ–¹ä¾¿è¿½è¸ªé—®é¢˜ã€‚

### 4. AI åˆ†è§£å¤±è´¥åçš„é™çº§æ–¹æ¡ˆ
```javascript
// ä¿®æ”¹å‰ï¼šAI å¤±è´¥åç›´æ¥æ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯å¹¶è¿”å›
catch (error) {
  const errorMessage: Message = { ... };
  setMessages(prev => [...prev, errorMessage]);
  setIsProcessing(false);
  return; // âŒ ç›´æ¥è¿”å›ï¼Œä¸æ˜¾ç¤ºç¼–è¾‘å™¨
}

// ä¿®æ”¹åï¼šAI å¤±è´¥åç»§ç»­æ‰§è¡Œç®€å•æ¨¡å¼
catch (error) {
  console.error('âŒ [AIè°ƒè¯•] AIä»»åŠ¡åˆ†è§£å¤±è´¥:', error);
  addThinkingStep(`âŒ AIåˆ†è§£å¤±è´¥ï¼Œä½¿ç”¨ç®€å•æ¨¡å¼åˆ›å»ºä»»åŠ¡`);
  // âœ… ä¸è¿”å›ï¼Œç»§ç»­æ‰§è¡Œä¸‹é¢çš„ç®€å•æ¨¡å¼ä»£ç 
}
```

**æ”¹è¿›**ï¼šå³ä½¿ AI åˆ†è§£å¤±è´¥ï¼Œä¹Ÿä¼šç»§ç»­æ‰§è¡Œç®€å•ä»»åŠ¡åˆ›å»ºé€»è¾‘ï¼Œç¡®ä¿ç¼–è¾‘å™¨ä¸€å®šä¼šæ˜¾ç¤ºã€‚

### 5. å¢å¼ºç®€å•æ¨¡å¼çš„æ—¥å¿—
```javascript
console.log('ğŸ”„ [ç®€å•æ¨¡å¼] åˆ›å»ºç®€å•ä»»åŠ¡æˆ–AIåˆ†è§£å¤±è´¥é™çº§');
console.log('ğŸ” [ç®€å•æ¨¡å¼] å‡†å¤‡æ‰“å¼€ç¼–è¾‘å™¨');
console.log('ğŸ” [ç®€å•æ¨¡å¼] ä»»åŠ¡:', singleTask);
console.log('ğŸ” [ç®€å•æ¨¡å¼] showTaskEditor å·²è®¾ç½®ä¸º true');
```

**æ”¹è¿›**ï¼šåœ¨ç®€å•æ¨¡å¼ä¸­ä¹Ÿæ·»åŠ è¯¦ç»†æ—¥å¿—ï¼Œç¡®ä¿èƒ½è¿½è¸ªåˆ°ç¼–è¾‘å™¨æ˜¯å¦è¢«æ­£ç¡®æ‰“å¼€ã€‚

### 6. ä¿®å¤æ—¶é—´è§£æé”™è¯¯ï¼ˆå…³é”®ä¿®å¤ï¼ï¼‰
```javascript
// ä¿®æ”¹å‰ï¼šç›´æ¥ä½¿ç”¨ new Date(task.startTime)ï¼Œå¯¼è‡´ Invalid time value
const startTime = new Date(task.startTime || currentTime);

// ä¿®æ”¹åï¼šæ­£ç¡®è§£æ "HH:MM" æ ¼å¼
let startTime: Date;
try {
  if (task.startTime && typeof task.startTime === 'string') {
    const [hours, minutes] = task.startTime.split(':').map(Number);
    
    // éªŒè¯æ—¶é—´æ˜¯å¦æœ‰æ•ˆ
    if (!isNaN(hours) && !isNaN(minutes) && hours >= 0 && hours < 24 && minutes >= 0 && minutes < 60) {
      startTime = new Date(currentTime);
      startTime.setHours(hours, minutes, 0, 0);
    } else {
      throw new Error(`æ— æ•ˆçš„æ—¶é—´æ ¼å¼: ${task.startTime}`);
    }
  } else {
    startTime = new Date(currentTime);
  }
} catch (error) {
  console.warn(`âš ï¸ æ—¶é—´è§£æå¤±è´¥ï¼Œä½¿ç”¨å½“å‰æ—¶é—´`);
  startTime = new Date(currentTime);
}
```

**æ”¹è¿›**ï¼š
- AI è¿”å›çš„æ—¶é—´æ ¼å¼æ˜¯ `"HH:MM"`ï¼ˆå¦‚ `"23:55"`ï¼‰ï¼Œä¸èƒ½ç›´æ¥ä¼ ç»™ `new Date()`
- éœ€è¦æ‰‹åŠ¨è§£æå°æ—¶å’Œåˆ†é’Ÿï¼Œç„¶åç”¨ `setHours()` è®¾ç½®åˆ°å½“å‰æ—¥æœŸ
- æ·»åŠ äº†å®Œæ•´çš„é”™è¯¯å¤„ç†å’ŒéªŒè¯ï¼Œç¡®ä¿æ—¶é—´ä¸€å®šæœ‰æ•ˆ

## å®é™…æµ‹è¯•ç»“æœ

### æµ‹è¯•è¾“å…¥
```
äº”åˆ†é’Ÿä¹‹åæ´—æ¾¡ç„¶åå€’çŒ«ç²®ç„¶åæ´—åºŠå•
```

### æ§åˆ¶å°æ—¥å¿—
```
ğŸ” [ä»»åŠ¡æ£€æµ‹] isTaskCreation: true
ğŸ” [ä»»åŠ¡æ£€æµ‹] needsDecompose: true
ğŸ” [AIè°ƒè¯•] å¼€å§‹è°ƒç”¨ aiService.decomposeTask
ğŸ” [AIè°ƒè¯•] AIè¿”å›ç»“æœ: {success: true, tasks: Array(3)}
âœ… æˆåŠŸåˆ†è§£å‡º 3 ä¸ªä»»åŠ¡
ğŸ” [ä»»åŠ¡1] AIè¿”å›æ—¶é—´: 23:55, è§£æå: 2025-02-08T15:55:00.000Z
ğŸ” [ä»»åŠ¡2] AIè¿”å›æ—¶é—´: 00:05, è§£æå: 2025-02-08T16:05:00.000Z
ğŸ” [ä»»åŠ¡3] AIè¿”å›æ—¶é—´: 00:20, è§£æå: 2025-02-08T16:20:00.000Z
ğŸ” [ç¼–è¾‘å™¨] showTaskEditor å·²è®¾ç½®ä¸º true
```

### ç»“æœ
âœ… **ç¼–è¾‘å™¨æˆåŠŸæ˜¾ç¤º**ï¼ŒåŒ…å« 3 ä¸ªä»»åŠ¡ï¼š
1. æ´—æ¾¡ - 10åˆ†é’Ÿ - 23:55
2. å€’çŒ«ç²® - 5åˆ†é’Ÿ - 00:05
3. æ´—åºŠå• - 15åˆ†é’Ÿ - 00:20

## æµ‹è¯•å»ºè®®

### æµ‹è¯•ç”¨ä¾‹ 1ï¼šæ—¶é—´å…³é”®è¯
- **è¾“å…¥**ï¼š`äº”åˆ†é’Ÿä¹‹åå»æ´—æ¼±å€’çŒ«ç²®`
- **é¢„æœŸ**ï¼šè¯†åˆ«ä¸ºä»»åŠ¡åˆ›å»ºï¼Œè°ƒç”¨ AI åˆ†è§£ï¼Œæ˜¾ç¤ºç¼–è¾‘å™¨

### æµ‹è¯•ç”¨ä¾‹ 2ï¼šçŸ­å¥å­
- **è¾“å…¥**ï¼š`æ´—æ¼±ç„¶ååƒé¥­`
- **é¢„æœŸ**ï¼šè¯†åˆ«ä¸ºä»»åŠ¡åˆ›å»ºï¼Œè°ƒç”¨ AI åˆ†è§£ï¼ˆå› ä¸ºæœ‰"ç„¶å"ï¼‰ï¼Œæ˜¾ç¤ºç¼–è¾‘å™¨

### æµ‹è¯•ç”¨ä¾‹ 3ï¼šAI å¤±è´¥é™çº§
- **åœºæ™¯**ï¼šAPI Key é”™è¯¯æˆ–ç½‘ç»œé—®é¢˜å¯¼è‡´ AI è°ƒç”¨å¤±è´¥
- **é¢„æœŸ**ï¼šæ˜¾ç¤º"AIåˆ†è§£å¤±è´¥ï¼Œä½¿ç”¨ç®€å•æ¨¡å¼"ï¼Œä»ç„¶æ˜¾ç¤ºç¼–è¾‘å™¨

### æµ‹è¯•ç”¨ä¾‹ 4ï¼šå•ä¸ªä»»åŠ¡
- **è¾“å…¥**ï¼š`å·¥ä½œ`
- **é¢„æœŸ**ï¼šè¯†åˆ«ä¸ºä»»åŠ¡åˆ›å»ºï¼Œä¸åˆ†è§£ï¼Œæ˜¾ç¤ºç¼–è¾‘å™¨ï¼ˆå•ä¸ªä»»åŠ¡ï¼‰

## è°ƒè¯•æ–¹æ³•

1. **æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°**ï¼ˆF12ï¼‰
2. **è¾“å…¥ä»»åŠ¡æè¿°**
3. **æŸ¥çœ‹æ§åˆ¶å°æ—¥å¿—**ï¼š
   - `ğŸ” [ä»»åŠ¡æ£€æµ‹]` - æ£€æŸ¥ä»»åŠ¡æ˜¯å¦è¢«æ­£ç¡®è¯†åˆ«
   - `ğŸ” [AIè°ƒè¯•]` - æ£€æŸ¥ AI è°ƒç”¨æ˜¯å¦æˆåŠŸ
   - `ğŸ” [ç¼–è¾‘å™¨]` æˆ– `ğŸ” [ç®€å•æ¨¡å¼]` - æ£€æŸ¥ç¼–è¾‘å™¨æ˜¯å¦è¢«æ‰“å¼€
   - `âŒ` - æŸ¥çœ‹é”™è¯¯ä¿¡æ¯

## æ–‡ä»¶ä½ç½®

- **ä¸»æ–‡ä»¶**ï¼š`src/components/ai/FloatingAIChat.tsx`
- **AI æœåŠ¡**ï¼š`src/services/aiService.ts`
- **AI æç¤ºè¯**ï¼š`src/services/aiPrompts.ts`
- **ä»»åŠ¡ç¼–è¾‘å™¨**ï¼š`src/components/shared/UnifiedTaskEditor.tsx`

## ç›¸å…³åŠŸèƒ½

### UnifiedTaskEditor åŠŸèƒ½
- âœ… åŒå‡»ç¼–è¾‘ä»»åŠ¡åç§°ã€æ—¶é•¿ã€é‡‘å¸ã€ç›®æ ‡
- âœ… ä¸Šä¸‹ç§»åŠ¨ä»»åŠ¡é¡ºåº
- âœ… åˆ é™¤ä»»åŠ¡
- âœ… æ·»åŠ /åˆ é™¤æ ‡ç­¾
- âœ… å…³è”é•¿æœŸç›®æ ‡
- âœ… æ·»åŠ å­ä»»åŠ¡
- âœ… è‡ªåŠ¨é‡æ–°è®¡ç®—æ—¶é—´ï¼ˆä¿®æ”¹æ—¶é•¿æˆ–é¡ºåºåï¼‰
- âœ… æ¨é€åˆ°æ—¶é—´è½´

### AI æç¤ºè¯é…ç½®
æ‰€æœ‰ AI æç¤ºè¯éƒ½åœ¨ `src/services/aiPrompts.ts` ä¸­ç»Ÿä¸€ç®¡ç†ï¼š
- `TASK_DECOMPOSER` - ä»»åŠ¡åˆ†è§£æç¤ºè¯
- `CONTENT_CLASSIFIER` - å†…å®¹åˆ†ç±»æç¤ºè¯
- `TIMELINE_OPERATOR` - æ—¶é—´è½´æ“ä½œæç¤ºè¯
- ç­‰ç­‰...

## ä¸‹ä¸€æ­¥å»ºè®®

1. **æµ‹è¯• AI åˆ†è§£åŠŸèƒ½**ï¼šç¡®ä¿ DeepSeek API é…ç½®æ­£ç¡®ï¼Œæœ‰è¶³å¤Ÿä½™é¢
2. **æŸ¥çœ‹æ§åˆ¶å°æ—¥å¿—**ï¼šç¡®è®¤ä»»åŠ¡è¯†åˆ«å’Œç¼–è¾‘å™¨æ‰“å¼€çš„å®Œæ•´æµç¨‹
3. **æµ‹è¯•ç¼–è¾‘å™¨åŠŸèƒ½**ï¼šç¡®è®¤æ‰€æœ‰ç¼–è¾‘åŠŸèƒ½ï¼ˆåŒå‡»ç¼–è¾‘ã€ä¸Šä¸‹ç§»åŠ¨ã€åˆ é™¤ç­‰ï¼‰éƒ½æ­£å¸¸å·¥ä½œ
4. **æµ‹è¯•æ¨é€åˆ°æ—¶é—´è½´**ï¼šç¡®è®¤ä»»åŠ¡èƒ½æ­£ç¡®æ¨é€åˆ°æ—¶é—´è½´æ¨¡å—

## æ€»ç»“

é€šè¿‡ä»¥ä¸Šä¿®å¤ï¼Œç°åœ¨çš„è¡Œä¸ºåº”è¯¥æ˜¯ï¼š
1. âœ… è¾“å…¥ä»»åŠ¡æè¿°åï¼Œ**ä¸€å®šä¼šæ˜¾ç¤ºç¼–è¾‘å™¨**
2. âœ… å¦‚æœ AI åˆ†è§£æˆåŠŸï¼Œæ˜¾ç¤ºå¤šä¸ªä»»åŠ¡
3. âœ… å¦‚æœ AI åˆ†è§£å¤±è´¥ï¼Œæ˜¾ç¤ºå•ä¸ªä»»åŠ¡ï¼ˆé™çº§æ–¹æ¡ˆï¼‰
4. âœ… å¯ä»¥åœ¨ç¼–è¾‘å™¨ä¸­ä¿®æ”¹ä»»åŠ¡çš„æ‰€æœ‰å±æ€§
5. âœ… ç‚¹å‡»"æ¨é€åˆ°æ—¶é—´è½´"åï¼Œä»»åŠ¡ä¼šè¢«åˆ›å»ºåˆ°æ—¶é—´è½´æ¨¡å—

**å…³é”®æ”¹è¿›**ï¼šæ— è®º AI æ˜¯å¦æˆåŠŸï¼Œç¼–è¾‘å™¨éƒ½ä¼šæ˜¾ç¤ºï¼Œç”¨æˆ·å¯ä»¥æ‰‹åŠ¨ç¼–è¾‘ä»»åŠ¡ï¼

