# è¯­éŸ³æ’­æŠ¥ä¿®å¤è¯´æ˜Ž

## é—®é¢˜æè¿°

ç”¨æˆ·åé¦ˆäº†ä¸¤ä¸ªä¸»è¦é—®é¢˜ï¼š

1. **ä»»åŠ¡ä¿®æ”¹åŽè¯­éŸ³æ’­æŠ¥ä¸æ›´æ–°**ï¼šå½“ä»»åŠ¡æ—¶é—´è¢«ä¿®æ”¹ã€åˆ é™¤æˆ–æå‰å®ŒæˆåŽï¼Œè¯­éŸ³æ’­æŠ¥ç³»ç»Ÿè¿˜æ˜¯æŒ‰ç…§æœ€åˆè®¾å®šçš„æ—¶é—´æé†’
2. **ä»»åŠ¡ç»“æŸå‰æé†’åŠŸèƒ½éœ€è¦ä¼˜åŒ–**ï¼šå¸Œæœ›åœ¨ä»»åŠ¡ç»“æŸå‰å‡ åˆ†é’Ÿæ’­æŠ¥æé†’ï¼Œæ—¶é—´å¯ä»¥è‡ªå®šä¹‰

## ä¿®å¤å†…å®¹

### 1. ä»»åŠ¡æ—¶é—´å˜åŒ–æ—¶è‡ªåŠ¨æ¸…é™¤æé†’è®°å½•

**æ–‡ä»¶**: `src/components/calendar/TaskVerificationCountdownContent.tsx`

**ä¿®æ”¹ä½ç½®**: ç¬¬ 115-122 è¡Œ

```typescript
// ðŸ”§ ç›‘å¬ä»»åŠ¡æ—¶é—´å˜åŒ–ï¼Œæ¸…é™¤è¿‡æœŸçš„æé†’è®°å½•
useEffect(() => {
  // å½“ä»»åŠ¡çš„å¼€å§‹æˆ–ç»“æŸæ—¶é—´å‘ç”Ÿå˜åŒ–æ—¶ï¼Œæ¸…ç©ºå·²è§¦å‘çš„æé†’è®°å½•
  setTriggeredReminders(new Set());
  console.log(`ðŸ”„ ä»»åŠ¡æ—¶é—´å·²æ›´æ–°ï¼Œæ¸…ç©ºæé†’è®°å½•: ${taskTitle}`);
}, [scheduledStart, scheduledEnd, taskTitle]);

// ðŸ”§ ç»„ä»¶å¸è½½æ—¶æ¸…ç†ï¼ˆä»»åŠ¡è¢«åˆ é™¤æˆ–å®Œæˆï¼‰
useEffect(() => {
  return () => {
    console.log(`ðŸ§¹ ä»»åŠ¡ç»„ä»¶å¸è½½ï¼Œæ¸…ç†æé†’è®°å½•: ${taskTitle}`);
    setTriggeredReminders(new Set());
  };
}, [taskTitle]);
```

**æ•ˆæžœ**ï¼š
- å½“ä»»åŠ¡çš„å¼€å§‹æ—¶é—´æˆ–ç»“æŸæ—¶é—´è¢«ä¿®æ”¹æ—¶ï¼Œè‡ªåŠ¨æ¸…ç©ºå·²è§¦å‘çš„æé†’è®°å½•
- å½“ä»»åŠ¡è¢«åˆ é™¤æˆ–å®Œæˆæ—¶ï¼Œæ¸…ç†æ‰€æœ‰ç›¸å…³çš„æé†’è®°å½•
- ç¡®ä¿ä¿®æ”¹åŽçš„ä»»åŠ¡èƒ½å¤ŸæŒ‰ç…§æ–°çš„æ—¶é—´é‡æ–°è§¦å‘æé†’

### 2. ä¼˜åŒ–ä»»åŠ¡å¼€å§‹å‰æé†’ï¼ˆä½¿ç”¨å®šæ—¶å™¨ç²¾ç¡®è§¦å‘ï¼‰

**æ–‡ä»¶**: `src/components/calendar/TaskVerificationCountdownContent.tsx`

**ä¿®æ”¹ä½ç½®**: ç¬¬ 248-287 è¡Œ

**æ”¹è¿›**ï¼š
- ä»ŽåŽŸæ¥çš„"æ¯ç§’æ£€æŸ¥æ˜¯å¦åˆ°è¾¾æé†’æ—¶é—´"æ”¹ä¸º"ä½¿ç”¨å®šæ—¶å™¨ç²¾ç¡®è§¦å‘"
- æ”¯æŒä»»åŠ¡æ—¶é—´ä¿®æ”¹åŽé‡æ–°è®¡ç®—æé†’æ—¶é—´
- é¿å…å› ä¸ºè½®è¯¢å»¶è¿Ÿå¯¼è‡´é”™è¿‡æé†’

**ç¤ºä¾‹**ï¼š
- ç”¨æˆ·è®¾ç½®"æå‰2åˆ†é’Ÿæé†’"
- ä»»åŠ¡åŽŸå®š4:00å¼€å§‹ï¼Œç³»ç»Ÿä¼šåœ¨3:58å‡†æ—¶æ’­æŠ¥
- å¦‚æžœç”¨æˆ·æŠŠä»»åŠ¡æ”¹åˆ°3:30å¼€å§‹ï¼Œç³»ç»Ÿä¼šåœ¨3:28å‡†æ—¶æ’­æŠ¥

### 3. ä¼˜åŒ–ä»»åŠ¡è¿›è¡Œä¸­æé†’ï¼ˆä½¿ç”¨å®šæ—¶å™¨ç²¾ç¡®è§¦å‘ï¼‰

**æ–‡ä»¶**: `src/components/calendar/TaskVerificationCountdownContent.tsx`

**ä¿®æ”¹ä½ç½®**: ç¬¬ 289-333 è¡Œ

**æ”¹è¿›**ï¼š
- ä»ŽåŽŸæ¥çš„"æ¯ç§’æ£€æŸ¥æ˜¯å¦åˆ°è¾¾æé†’æ—¶é—´"æ”¹ä¸º"ä½¿ç”¨å®šæ—¶å™¨ç²¾ç¡®è§¦å‘"
- æ”¯æŒåŠ¨æ€è®¡ç®—ä¸‹ä¸€æ¬¡æé†’æ—¶é—´
- é¿å…é‡å¤æé†’

**ç¤ºä¾‹**ï¼š
- ç”¨æˆ·è®¾ç½®"æ¯10åˆ†é’Ÿæé†’ä¸€æ¬¡"
- ä»»åŠ¡å¼€å§‹åŽï¼Œç³»ç»Ÿä¼šåœ¨ç¬¬10åˆ†é’Ÿã€ç¬¬20åˆ†é’Ÿã€ç¬¬30åˆ†é’Ÿ...å‡†æ—¶æ’­æŠ¥

### 4. ä¼˜åŒ–ä»»åŠ¡ç»“æŸå‰æé†’ï¼ˆä½¿ç”¨èŒƒå›´åŒ¹é…ï¼‰

**æ–‡ä»¶**: `src/components/calendar/TaskVerificationCountdownContent.tsx`

**ä¿®æ”¹ä½ç½®**: ç¬¬ 200-246 è¡Œ

**æ”¹è¿›**ï¼š
- ä»ŽåŽŸæ¥çš„"ç²¾ç¡®åŒ¹é…ç§’æ•°"æ”¹ä¸º"èŒƒå›´åŒ¹é…ï¼ˆÂ±2ç§’ï¼‰"
- é¿å…å› ä¸ºæ—¶é—´æ›´æ–°å»¶è¿Ÿå¯¼è‡´é”™è¿‡æé†’
- æ”¯æŒä»»åŠ¡æ—¶é—´ä¿®æ”¹åŽé‡æ–°è§¦å‘æé†’

**ç¤ºä¾‹**ï¼š
- ç”¨æˆ·è®¾ç½®"æå‰5åˆ†é’Ÿæé†’"
- ä»»åŠ¡å€’è®¡æ—¶åˆ°5åˆ†é’Ÿï¼ˆ300ç§’ï¼‰æ—¶ï¼Œç³»ç»Ÿä¼šæ’­æŠ¥"è¿˜æœ‰5åˆ†é’Ÿï¼Œä»»åŠ¡å³å°†ç»“æŸ"
- å³ä½¿å€’è®¡æ—¶æ›´æ–°æœ‰1-2ç§’å»¶è¿Ÿï¼Œä¹Ÿèƒ½å‡†ç¡®è§¦å‘æé†’

### 5. ä¼˜åŒ–å…¶ä»–æé†’ï¼ˆç´§æ€¥éªŒè¯ã€ä»»åŠ¡ç»“æŸï¼‰

**æ–‡ä»¶**: `src/components/calendar/TaskVerificationCountdownContent.tsx`

**ä¿®æ”¹ä½ç½®**ï¼š
- ç´§æ€¥éªŒè¯æé†’ï¼ˆå¯åŠ¨ï¼‰ï¼šç¬¬ 335-361 è¡Œ
- ç´§æ€¥éªŒè¯æé†’ï¼ˆå®Œæˆï¼‰ï¼šç¬¬ 363-389 è¡Œ
- ä»»åŠ¡ç»“æŸæ—¶æé†’ï¼šç¬¬ 391-417 è¡Œ

**æ”¹è¿›**ï¼š
- æ‰€æœ‰æé†’éƒ½ä½¿ç”¨èŒƒå›´åŒ¹é…ï¼ˆÂ±2ç§’ï¼‰ï¼Œé¿å…é”™è¿‡æé†’
- æ”¯æŒä»»åŠ¡æ—¶é—´ä¿®æ”¹åŽé‡æ–°è§¦å‘æé†’

## æµ‹è¯•å»ºè®®

### æµ‹è¯•åœºæ™¯ 1ï¼šä¿®æ”¹ä»»åŠ¡æ—¶é—´

1. åˆ›å»ºä¸€ä¸ªä»»åŠ¡ï¼Œè®¾ç½®ä¸º4:00å¼€å§‹
2. åœ¨è®¾ç½®ä¸­å¼€å¯"ä»»åŠ¡å¼€å§‹å‰æé†’"ï¼Œè®¾ç½®ä¸º"æå‰2åˆ†é’Ÿ"
3. ç­‰å¾…åˆ°3:58ï¼Œç¡®è®¤æ”¶åˆ°è¯­éŸ³æ’­æŠ¥
4. åœ¨3:59æ—¶ï¼ŒæŠŠä»»åŠ¡æ—¶é—´æ”¹ä¸º3:30å¼€å§‹
5. è§‚å¯Ÿï¼šç³»ç»Ÿåº”è¯¥ç«‹å³æ’­æŠ¥"ä»»åŠ¡å³å°†å¼€å§‹"ï¼ˆå› ä¸ºå·²ç»è¿‡äº†3:28ï¼‰

### æµ‹è¯•åœºæ™¯ 2ï¼šæå‰å®Œæˆä»»åŠ¡

1. åˆ›å»ºä¸€ä¸ªä»»åŠ¡ï¼Œè®¾ç½®ä¸º4:00-5:00
2. åœ¨è®¾ç½®ä¸­å¼€å¯"ä»»åŠ¡ç»“æŸå‰æé†’"ï¼Œè®¾ç½®ä¸º"æå‰5åˆ†é’Ÿ"
3. åœ¨4:00å¯åŠ¨ä»»åŠ¡
4. åœ¨4:30æå‰å®Œæˆä»»åŠ¡
5. è§‚å¯Ÿï¼šç³»ç»Ÿä¸åº”è¯¥åœ¨4:55å†æ¬¡æ’­æŠ¥"ä»»åŠ¡å³å°†ç»“æŸ"

### æµ‹è¯•åœºæ™¯ 3ï¼šåˆ é™¤ä»»åŠ¡

1. åˆ›å»ºä¸€ä¸ªä»»åŠ¡ï¼Œè®¾ç½®ä¸º4:00å¼€å§‹
2. åœ¨è®¾ç½®ä¸­å¼€å¯"ä»»åŠ¡å¼€å§‹å‰æé†’"ï¼Œè®¾ç½®ä¸º"æå‰2åˆ†é’Ÿ"
3. åœ¨3:50åˆ é™¤ä»»åŠ¡
4. è§‚å¯Ÿï¼šç³»ç»Ÿä¸åº”è¯¥åœ¨3:58æ’­æŠ¥"ä»»åŠ¡å³å°†å¼€å§‹"

### æµ‹è¯•åœºæ™¯ 4ï¼šä»»åŠ¡ç»“æŸå‰æé†’

1. åˆ›å»ºä¸€ä¸ªä»»åŠ¡ï¼Œè®¾ç½®ä¸º4:00-5:00
2. åœ¨è®¾ç½®ä¸­å¼€å¯"ä»»åŠ¡ç»“æŸå‰æé†’"ï¼Œè®¾ç½®ä¸º"æå‰5åˆ†é’Ÿ"
3. åœ¨4:00å¯åŠ¨ä»»åŠ¡
4. è§‚å¯Ÿï¼šç³»ç»Ÿåº”è¯¥åœ¨4:55å‡†æ—¶æ’­æŠ¥"è¿˜æœ‰5åˆ†é’Ÿï¼Œä»»åŠ¡å³å°†ç»“æŸ"

## æŠ€æœ¯ç»†èŠ‚

### ä¸ºä»€ä¹ˆä½¿ç”¨èŒƒå›´åŒ¹é…ï¼Ÿ

åŽŸæ¥çš„ä»£ç ä½¿ç”¨ç²¾ç¡®åŒ¹é…ï¼ˆä¾‹å¦‚ï¼š`taskCountdownLeft === 300`ï¼‰ï¼Œä½†è¿™ç§æ–¹å¼æœ‰ä¸€ä¸ªé—®é¢˜ï¼š

- å€’è®¡æ—¶æ¯ç§’æ›´æ–°ä¸€æ¬¡
- å¦‚æžœæ›´æ–°æ—¶åˆšå¥½è·³è¿‡äº†300ç§’ï¼ˆä¾‹å¦‚ä»Ž301ç§’ç›´æŽ¥è·³åˆ°299ç§’ï¼‰
- å°±ä¼šé”™è¿‡æé†’

ä½¿ç”¨èŒƒå›´åŒ¹é…ï¼ˆä¾‹å¦‚ï¼š`taskCountdownLeft >= 298 && taskCountdownLeft <= 302`ï¼‰å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼š

- å³ä½¿å€’è®¡æ—¶æ›´æ–°æœ‰å»¶è¿Ÿï¼Œä¹Ÿèƒ½åœ¨ç›®æ ‡æ—¶é—´é™„è¿‘è§¦å‘æé†’
- é…åˆ `triggeredReminders` è®°å½•ï¼Œç¡®ä¿åªè§¦å‘ä¸€æ¬¡

### ä¸ºä»€ä¹ˆä½¿ç”¨å®šæ—¶å™¨ï¼Ÿ

å¯¹äºŽ"ä»»åŠ¡å¼€å§‹å‰æé†’"å’Œ"ä»»åŠ¡è¿›è¡Œä¸­æé†’"ï¼Œä½¿ç”¨å®šæ—¶å™¨æ¯”è½®è¯¢æ›´ç²¾ç¡®ï¼š

- è½®è¯¢ï¼šæ¯ç§’æ£€æŸ¥ä¸€æ¬¡ï¼Œå¯èƒ½æœ‰1ç§’è¯¯å·®
- å®šæ—¶å™¨ï¼šç²¾ç¡®è®¡ç®—åˆ°è¾¾æ—¶é—´ï¼Œè¯¯å·®åœ¨æ¯«ç§’çº§

### ä¸ºä»€ä¹ˆè¦æ¸…é™¤æé†’è®°å½•ï¼Ÿ

`triggeredReminders` ç”¨äºŽè®°å½•å·²ç»è§¦å‘è¿‡çš„æé†’ï¼Œé¿å…é‡å¤æ’­æŠ¥ã€‚ä½†æ˜¯ï¼š

- å½“ä»»åŠ¡æ—¶é—´è¢«ä¿®æ”¹æ—¶ï¼Œéœ€è¦æ¸…ç©ºè®°å½•ï¼Œè®©æ–°çš„æ—¶é—´èƒ½å¤Ÿé‡æ–°è§¦å‘æé†’
- å½“ä»»åŠ¡è¢«åˆ é™¤æˆ–å®Œæˆæ—¶ï¼Œéœ€è¦æ¸…ç©ºè®°å½•ï¼Œé¿å…å†…å­˜æ³„æ¼

## æ³¨æ„äº‹é¡¹

1. **æµè§ˆå™¨æƒé™**ï¼šè¯­éŸ³æ’­æŠ¥éœ€è¦ç”¨æˆ·æŽˆæƒï¼Œé¦–æ¬¡ä½¿ç”¨æ—¶éœ€è¦ç‚¹å‡»"æµ‹è¯•è¯­éŸ³"æŒ‰é’®æ¿€æ´»
2. **åŽå°è¿è¡Œ**ï¼šè¯­éŸ³æ’­æŠ¥åœ¨åŽå°ä¹Ÿèƒ½å·¥ä½œï¼Œä½†æµè§ˆå™¨é€šçŸ¥éœ€è¦é¡µé¢åœ¨å‰å°
3. **ç§»åŠ¨ç«¯å…¼å®¹**ï¼šiOS Safari å¯¹è¯­éŸ³æ’­æŠ¥æœ‰é™åˆ¶ï¼Œå»ºè®®ä½¿ç”¨ PWA æ¨¡å¼
4. **æ€§èƒ½ä¼˜åŒ–**ï¼šä½¿ç”¨å®šæ—¶å™¨ä»£æ›¿è½®è¯¢ï¼Œå‡å°‘ CPU å ç”¨

## ç›¸å…³æ–‡ä»¶

- `src/components/calendar/TaskVerificationCountdownContent.tsx` - ä»»åŠ¡å€’è®¡æ—¶ç»„ä»¶ï¼ˆä¸»è¦ä¿®æ”¹ï¼‰
- `src/services/notificationService.ts` - é€šçŸ¥æœåŠ¡ï¼ˆå·²å­˜åœ¨ï¼Œæ— éœ€ä¿®æ”¹ï¼‰
- `src/components/settings/NotificationSettings.tsx` - é€šçŸ¥è®¾ç½®ç•Œé¢ï¼ˆå·²å­˜åœ¨ï¼Œæ— éœ€ä¿®æ”¹ï¼‰

## æ€»ç»“

é€šè¿‡è¿™æ¬¡ä¿®å¤ï¼Œè¯­éŸ³æ’­æŠ¥ç³»ç»ŸçŽ°åœ¨èƒ½å¤Ÿï¼š

âœ… ä»»åŠ¡æ—¶é—´ä¿®æ”¹åŽï¼Œè‡ªåŠ¨æŒ‰ç…§æ–°æ—¶é—´æ’­æŠ¥
âœ… ä»»åŠ¡åˆ é™¤åŽï¼Œä¸å†æ’­æŠ¥ç›¸å…³æé†’
âœ… ä»»åŠ¡æå‰å®ŒæˆåŽï¼Œä¸å†æ’­æŠ¥ç»“æŸæé†’
âœ… æ›´ç²¾ç¡®çš„æé†’æ—¶é—´ï¼ˆä½¿ç”¨å®šæ—¶å™¨å’ŒèŒƒå›´åŒ¹é…ï¼‰
âœ… æ›´å¥½çš„æ€§èƒ½ï¼ˆå‡å°‘ä¸å¿…è¦çš„è½®è¯¢ï¼‰

ç”¨æˆ·çŽ°åœ¨å¯ä»¥æ”¾å¿ƒåœ°ä¿®æ”¹ä»»åŠ¡æ—¶é—´ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨é€‚åº”æ–°çš„æ—¶é—´å®‰æŽ’ï¼

