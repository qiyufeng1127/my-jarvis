# 🤖 AI助手完整交互指南

## 📋 目录
1. [AI助手概述](#ai助手概述)
2. [已实现的智能交互](#已实现的智能交互)
3. [数据流转详解](#数据流转详解)
4. [使用示例](#使用示例)
5. [待实现功能](#待实现功能)

---

## 🎯 AI助手概述

### 位置
- **浮动按钮**：右下角 🤖 按钮（麦克风按钮左侧）
- **交互方式**：点击展开/收起聊天窗口
- **特性**：可拖拽、可最小化、智能标签识别

### 核心能力
✅ **已实现**
- 🏷️ 自动识别内容类型（心情/碎碎念/待办/成功/感恩）
- 😊 自动打情绪标签（开心/焦虑/生气/平静等10种）
- 📂 自动打分类标签（工作/学习/生活/创业等10种）
- 💰 自动分配奖励（金币 + 成长值）
- 🎯 智能关联长期目标
- 📝 自动同步到全景记忆栏和日记模块

⏳ **待实现**
- 📅 智能分解任务到时间轴
- 🕒 直接修改时间轴任务
- 💬 真实AI对话（需要接入AI服务）

---

## ✅ 已实现的智能交互

### 1️⃣ 心情记录识别

#### 触发关键词
```
心情、感觉、情绪
```

#### 示例输入
```
今天心情很好，天气不错
我感觉有点焦虑
情绪有点低落
```

#### AI响应
1. ✨ 识别为：**心情记录**
2. 🏷️ 自动打情绪标签（如：开心 😊、焦虑 😰）
3. 📂 自动打分类标签（如：生活 🏠）
4. 🎁 获得奖励：💰 20 金币 + ⭐ 5 成长值
5. 📝 自动保存到全景记忆栏

#### 数据流转
```
用户输入 → AI分析 → 识别类型 → 提取标签 → 计算奖励 
→ 保存到 memoryStore → 显示在全景记忆栏
```

---

### 2️⃣ 碎碎念识别

#### 触发关键词
```
碎碎念、想法、突然想到、记录一下
```

#### 示例输入
```
碎碎念：今天突然想到一个很棒的项目想法
突然想到明天要给妈妈打电话
记录一下这个灵感
```

#### AI响应
1. ✨ 识别为：**碎碎念**
2. 🏷️ 自动打情绪标签（如：兴奋 🤩）
3. 📂 自动打分类标签（如：创业 🚀、家庭 👨‍👩‍👧）
4. 🎁 获得奖励：💰 15 金币 + ⭐ 3 成长值
5. 📝 自动保存到全景记忆栏

---

### 3️⃣ 待办事项识别

#### 触发关键词
```
待办、要做、明天、计划、安排
```

#### 示例输入
```
明天要去超市买菜
待办：完成项目报告
计划下周开始学习React
```

#### AI响应
1. ✨ 识别为：**待办事项**
2. 📂 自动打分类标签（如：家务 🧹、工作 💼、学习 📚）
3. 🎁 获得奖励：💰 10 金币 + ⭐ 2 成长值
4. 📝 自动保存到全景记忆栏

---

### 4️⃣ 成功日记识别

#### 触发关键词
```
成功、完成了、做到了、达成
```

#### 示例输入
```
今天成功完成了所有任务！
我完成了10公里跑步
达成了本周的学习目标
```

#### AI响应
1. ✨ 识别为：**成功日记**
2. 🏷️ 自动打情绪标签（如：自豪 😎、开心 😊）
3. 📂 自动打分类标签（如：工作 💼、健康 💪、学习 📚）
4. 🎁 获得奖励：💰 50 金币 + ⭐ 10 成长值
5. 📝 自动保存到全景记忆栏
6. 💫 同时同步到成功日记模块

---

### 5️⃣ 感恩日记识别

#### 触发关键词
```
感恩、感谢、幸运、庆幸
```

#### 示例输入
```
感恩今天遇到的好人
感谢家人的支持
很庆幸有这个机会
```

#### AI响应
1. ✨ 识别为：**感恩日记**
2. 🏷️ 自动打情绪标签（如：感恩 🙏、开心 😊）
3. 📂 自动打分类标签（如：家庭 👨‍👩‍👧、社交 👥）
4. 🎁 获得奖励：💰 30 金币 + ⭐ 5 成长值
5. 📝 自动保存到全景记忆栏
6. 💫 同时同步到感恩日记模块

---

### 6️⃣ 智能目标关联

#### 触发关键词
```
创建、添加、新建、安排、计划、做、完成、学习、工作、运动
```

#### 示例输入
```
明天学习React 2小时
计划每天跑步30分钟
要完成前端项目
```

#### AI响应
1. ✅ 分析任务内容
2. 🎯 **智能目标关联**：匹配相关长期目标
   - 显示匹配的目标列表
   - 显示匹配度百分比（如：85%）
   - 显示匹配原因
3. 💡 提示：完成任务将自动更新目标进度

#### 匹配算法
```javascript
- 关键词匹配（权重 50%）
- 名称相似度（权重 40%）
- 领域匹配（权重 30%）
- 语义相似度（权重 20%）
```

---

## 🏷️ 自动标签系统

### 情绪标签（10种）

| 标签 | Emoji | 触发关键词 | 颜色 |
|------|-------|-----------|------|
| 开心 | 😊 | 开心、高兴、快乐、愉快、喜悦 | 绿色 |
| 兴奋 | 🤩 | 兴奋、激动、期待、振奋 | 橙色 |
| 平静 | 😌 | 平静、平和、安静、淡定、放松 | 蓝色 |
| 感恩 | 🙏 | 感恩、感谢、感激、庆幸 | 紫色 |
| 自豪 | 😎 | 自豪、骄傲、得意、满意 | 粉色 |
| 焦虑 | 😰 | 焦虑、担心、紧张、不安、忧虑 | 红色 |
| 难过 | 😢 | 难过、伤心、悲伤、失落、沮丧 | 灰色 |
| 生气 | 😠 | 生气、愤怒、恼火、气愤 | 深红 |
| 沮丧 | 😞 | 沮丧、挫败、失望、郁闷 | 灰色 |
| 疲惫 | 😴 | 疲惫、累、困、疲劳 | 深灰 |

### 分类标签（10种）

| 标签 | Emoji | 触发关键词 | 颜色 |
|------|-------|-----------|------|
| 工作 | 💼 | 工作、上班、项目、会议、同事、老板 | 蓝色 |
| 学习 | 📚 | 学习、读书、课程、考试、作业 | 紫色 |
| 生活 | 🏠 | 生活、日常、今天、早上、晚上 | 绿色 |
| 家务 | 🧹 | 家务、打扫、洗衣、做饭、收拾 | 灰色 |
| 健康 | 💪 | 健康、运动、锻炼、健身、跑步 | 红色 |
| 社交 | 👥 | 朋友、聚会、社交、见面、聊天 | 粉色 |
| 爱好 | 🎨 | 爱好、兴趣、画画、音乐、游戏 | 橙色 |
| 创业 | 🚀 | 创业、项目、产品、用户、商业 | 紫色 |
| 财务 | 💰 | 钱、理财、投资、收入、支出 | 绿色 |
| 家庭 | 👨‍👩‍👧 | 家人、父母、孩子、家庭 | 橙色 |

---

## 💰 奖励系统

### 奖励规则

| 记录类型 | 金币 | 成长值 |
|---------|------|--------|
| 心情记录 | 20 | 5 |
| 碎碎念 | 15 | 3 |
| 待办事项 | 10 | 2 |
| 成功日记 | 50 | 10 |
| 感恩日记 | 30 | 5 |

### 奖励用途
- 💰 **金币**：可用于兑换奖励、解锁功能
- ⭐ **成长值**：提升等级、解锁成就

---

## 🔄 数据流转详解

### 完整数据流程图

```
┌─────────────┐
│  用户输入   │
└──────┬──────┘
       │
       ▼
┌─────────────────────────────┐
│  AI智能分析                  │
│  - analyzeMessageTags()     │
│  - 检测记录类型              │
│  - 提取情绪标签              │
│  - 提取分类标签              │
│  - 计算奖励                  │
└──────┬──────────────────────┘
       │
       ▼
┌─────────────────────────────┐
│  保存到 memoryStore          │
│  - addMemory()              │
│  - 创建记录对象              │
│  - 持久化到 localStorage    │
└──────┬──────────────────────┘
       │
       ├──────────────┬──────────────┐
       ▼              ▼              ▼
┌──────────┐  ┌──────────┐  ┌──────────┐
│全景记忆栏│  │日记模块  │  │目标模块  │
│显示所有  │  │显示成功  │  │关联任务  │
│记录      │  │感恩日记  │  │到目标    │
└──────────┘  └──────────┘  └──────────┘
```

### 核心Store

#### 1. memoryStore（记忆存储）

**位置**：`src/stores/memoryStore.ts`

**数据结构**：
```typescript
interface MemoryRecord {
  id: string;                    // 唯一ID
  type: 'mood' | 'thought' | 'todo' | 'success' | 'gratitude';
  content: string;               // 内容
  emotionTags: string[];         // 情绪标签
  categoryTags: string[];        // 分类标签
  date: Date;                    // 日期
  aiGenerated?: boolean;         // 是否AI生成
  rewards?: {
    gold: number;                // 金币
    growth: number;              // 成长值
  };
}

interface JournalEntry {
  id: string;
  type: 'success' | 'gratitude';
  content: string;
  date: Date;
  mood?: string;
  tags: string[];
  rewards: {
    gold: number;
    growth: number;
  };
}
```

**核心方法**：
```typescript
// 添加记忆
addMemory(memory: Omit<MemoryRecord, 'id' | 'date'>): void

// 添加日记（自动同步到记忆）
addJournal(journal: Omit<JournalEntry, 'id' | 'date'>): void

// 删除记忆
deleteMemory(id: string): void

// 更新记忆
updateMemory(id: string, updates: Partial<MemoryRecord>): void

// 获取统计
getStats(): {
  totalMemories: number;
  totalJournals: number;
  totalRewards: { gold: number; growth: number };
  emotionDistribution: Record<string, number>;
  categoryDistribution: Record<string, number>;
}
```

#### 2. goalStore（目标存储）

**位置**：`src/stores/goalStore.ts`

**用途**：管理长期目标，与AI助手的任务关联

---

## 📝 使用示例

### 示例1：记录心情

**输入**：
```
今天心情很好，工作很顺利，感觉很开心！
```

**AI分析**：
- 类型：心情记录
- 情绪标签：开心 😊
- 分类标签：工作 💼
- 奖励：💰 20 金币 + ⭐ 5 成长值

**AI响应**：
```
✨ 已识别为：心情记录

🏷️ 情绪标签：😊 开心
📂 分类标签：💼 工作

🎁 获得奖励：💰 20 金币  ⭐ 5 成长值

📝 已自动保存到全景记忆栏！
```

---

### 示例2：记录成功

**输入**：
```
今天成功完成了前端项目的重构，代码质量提升了很多！
```

**AI分析**：
- 类型：成功日记
- 情绪标签：自豪 😎、开心 😊
- 分类标签：工作 💼、学习 📚
- 奖励：💰 50 金币 + ⭐ 10 成长值

**AI响应**：
```
✨ 已识别为：成功日记

🏷️ 情绪标签：😎 自豪  😊 开心
📂 分类标签：💼 工作  📚 学习

🎁 获得奖励：💰 50 金币  ⭐ 10 成长值

📝 已自动保存到全景记忆栏！
💫 同时已同步到成功日记模块！
```

---

### 示例3：智能目标关联

**前提**：已创建目标"学习前端开发"

**输入**：
```
明天学习React Hooks 2小时
```

**AI分析**：
- 类型：待办事项
- 分类标签：学习 📚
- 匹配目标：学习前端开发（85%）

**AI响应**：
```
✨ 已识别为：待办事项

📂 分类标签：📚 学习

🎁 获得奖励：💰 10 金币  ⭐ 2 成长值

📝 已自动保存到全景记忆栏！

🎯 智能目标关联
我发现这个任务可以关联到以下长期目标：

1. **学习前端开发** (85%)
   ████████░░ 关键词匹配：React、学习

💡 完成这个任务将自动更新相关目标的进度！
```

---

## ⏳ 待实现功能

### 1. 智能任务分解 ❌

**功能描述**：
- 输入复杂任务，AI自动分解为多个子任务
- 自动安排到时间轴
- 智能估算时间

**示例**：
```
输入：完成前端项目重构

AI分解：
1. 分析现有代码结构（1小时）
2. 设计新的组件架构（2小时）
3. 重构核心组件（4小时）
4. 编写单元测试（2小时）
5. 代码审查和优化（1小时）
```

**实现难度**：⭐⭐⭐⭐
**需要**：接入真实AI服务（如GPT-4）

---

### 2. 直接修改时间轴 ❌

**功能描述**：
- 通过对话直接修改时间轴任务
- 支持时间调整、任务删除、状态更新

**示例**：
```
输入：把明天的学习任务改到后天
输入：删除今天下午3点的会议
输入：标记"写报告"为已完成
```

**实现难度**：⭐⭐⭐
**需要**：
- 时间解析算法
- 任务匹配算法
- 与taskStore集成

---

### 3. 真实AI对话 ❌

**功能描述**：
- 接入真实AI服务
- 支持自然语言对话
- 上下文理解

**示例**：
```
用户：我最近感觉很焦虑
AI：我理解你的感受。能告诉我是什么让你感到焦虑吗？
用户：工作压力太大了
AI：工作压力确实会让人焦虑。你可以尝试...
```

**实现难度**：⭐⭐⭐⭐⭐
**需要**：
- AI API接入（OpenAI/Claude/本地模型）
- 对话历史管理
- 上下文维护

---

### 4. 语音输入 ❌

**功能描述**：
- 支持语音输入
- 自动转文字
- 与现有语音助手集成

**实现难度**：⭐⭐⭐
**需要**：
- 语音识别API
- 与VoiceAssistant集成

---

### 5. 智能提醒 ❌

**功能描述**：
- 根据记录内容智能提醒
- 情绪低落时推送正能量
- 目标进度提醒

**示例**：
```
检测到连续3天情绪低落
→ 推送：要不要休息一下，做点让自己开心的事？

检测到目标进度落后
→ 推送：本周"学习前端"目标进度仅30%，加油！
```

**实现难度**：⭐⭐⭐⭐
**需要**：
- 情绪分析算法
- 提醒系统
- 通知机制

---

## 🎨 UI交互

### 浮动窗口特性

1. **位置**：右下角，麦克风按钮左侧
2. **拖拽**：点击头部可拖拽到任意位置
3. **最小化**：点击最小化按钮，只显示标题栏
4. **关闭**：点击X按钮或🤖按钮关闭
5. **约束**：窗口不会超出屏幕边界

### 快速指令

点击快速指令按钮，自动填充输入框：
- 📅 分解任务
- 🕒 时间轴
- 💰 金币
- 📝 心情

---

## 🔧 技术实现

### 核心文件

1. **FloatingAIChat.tsx**
   - 位置：`src/components/ai/FloatingAIChat.tsx`
   - 功能：AI助手主界面
   - 核心方法：`analyzeMessageTags()`, `handleSend()`

2. **memoryStore.ts**
   - 位置：`src/stores/memoryStore.ts`
   - 功能：记忆和日记数据管理
   - 持久化：localStorage

3. **PanoramaMemory.tsx**
   - 位置：`src/components/memory/PanoramaMemory.tsx`
   - 功能：全景记忆栏显示

4. **JournalModule.tsx**
   - 位置：`src/components/journal/JournalModule.tsx`
   - 功能：成功&感恩日记显示

### 标签识别算法

```typescript
const analyzeMessageTags = (message: string) => {
  const emotions: string[] = [];
  const categories: string[] = [];
  let type: RecordType | undefined;
  let rewards = { gold: 0, growth: 0 };

  // 1. 检测记录类型
  if (/心情|感觉|情绪/.test(message)) {
    type = 'mood';
    rewards = { gold: 20, growth: 5 };
  }
  // ... 其他类型检测

  // 2. 情绪标签检测
  EMOTION_TAGS.forEach(tag => {
    const keywords = getKeywordsForTag(tag.id);
    if (keywords.some(keyword => message.includes(keyword))) {
      emotions.push(tag.id);
    }
  });

  // 3. 分类标签检测
  CATEGORY_TAGS.forEach(tag => {
    const keywords = getKeywordsForTag(tag.id);
    if (keywords.some(keyword => message.includes(keyword))) {
      categories.push(tag.id);
    }
  });

  return { emotions, categories, type, rewards };
};
```

---

## 📊 数据统计

### 可查看的统计数据

在 `memoryStore.getStats()` 中：

```typescript
{
  totalMemories: number;           // 总记录数
  totalJournals: number;           // 总日记数
  totalRewards: {
    gold: number;                  // 累计金币
    growth: number;                // 累计成长值
  };
  emotionDistribution: {           // 情绪分布
    happy: 10,
    anxious: 5,
    // ...
  };
  categoryDistribution: {          // 分类分布
    work: 15,
    study: 8,
    // ...
  };
}
```

---

## 🚀 快速开始

### 1. 打开AI助手
点击右下角的 🤖 按钮

### 2. 输入内容
直接输入你的心情、想法或待办事项

### 3. 查看结果
- AI自动识别类型和标签
- 显示获得的奖励
- 自动保存到相应模块

### 4. 查看记录
- **全景记忆栏**：查看所有记录
- **日记模块**：查看成功和感恩日记
- 使用筛选和搜索功能快速查找

---

## 💡 使用技巧

1. **关键词触发**：使用明确的关键词（如"心情"、"成功"）可以提高识别准确率

2. **表情符号**：使用表情符号（😊😰😠）可以帮助AI更准确识别情绪

3. **详细描述**：描述越详细，AI打的标签越准确

4. **快速指令**：使用快速指令按钮快速开始

5. **拖拽定位**：把聊天窗口拖到舒适的位置

---

## 🐛 已知问题

1. ⚠️ **标签识别不准确**：某些复杂句子可能识别错误
   - 解决方案：使用更明确的关键词

2. ⚠️ **重复标签**：同一句话可能打多个相似标签
   - 解决方案：后续优化去重逻辑

3. ⚠️ **奖励累计**：奖励目前只是显示，未与金币系统真正集成
   - 解决方案：待实现金币系统集成

---

## 📞 反馈与建议

如果你有任何问题或建议，欢迎反馈！

---

**最后更新**：2026-01-23
**版本**：v1.0.0

