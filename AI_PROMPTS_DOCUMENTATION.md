# AI æç¤ºè¯ä¸è°ƒç”¨é€»è¾‘å®Œæ•´æ–‡æ¡£

> æœ¬æ–‡æ¡£è¯¦ç»†è®°å½•äº†ç³»ç»Ÿä¸­æ‰€æœ‰ AI æç¤ºè¯çš„å†…å®¹ã€è°ƒç”¨æ¥å£åŠå…¶å¯¹åº”å…³ç³»

## ğŸ“‹ ç›®å½•

1. [ç³»ç»Ÿæ¶æ„æ¦‚è§ˆ](#ç³»ç»Ÿæ¶æ„æ¦‚è§ˆ)
2. [æ ¸å¿ƒæœåŠ¡æ–‡ä»¶](#æ ¸å¿ƒæœåŠ¡æ–‡ä»¶)
3. [AI æç¤ºè¯è¯¦ç»†åˆ—è¡¨](#ai-æç¤ºè¯è¯¦ç»†åˆ—è¡¨)
4. [è°ƒç”¨æµç¨‹å›¾](#è°ƒç”¨æµç¨‹å›¾)
5. [é—®é¢˜è¯Šæ–­](#é—®é¢˜è¯Šæ–­)

---

## ç³»ç»Ÿæ¶æ„æ¦‚è§ˆ

### æ ¸å¿ƒ AI æœåŠ¡å±‚æ¬¡ç»“æ„

```
ç”¨æˆ·è¾“å…¥
    â†“
AISmartInput.tsx (UI å±‚)
    â†“
AISmartProcessor.process() (æ™ºèƒ½è·¯ç”±)
    â†“
    â”œâ”€â†’ handleTaskDecomposition() â†’ analyzeTaskWithAI() [æç¤ºè¯1]
    â”œâ”€â†’ handleScheduledTask()
    â”œâ”€â†’ handleTimelineOperation() â†’ parseTimelineOperationWithAI() [æç¤ºè¯2]
    â”œâ”€â†’ handleMoneyTracking() â†’ MoneyAIProcessor.process() [æç¤ºè¯3]
    â”œâ”€â†’ handleMoodRecord()
    â””â”€â†’ handleGeneralInput()
```

### å…³é”®æ–‡ä»¶æ¸…å•

| æ–‡ä»¶è·¯å¾„ | ä½œç”¨ | åŒ…å«æç¤ºè¯æ•°é‡ |
|---------|------|--------------|
| `src/services/aiSmartService.ts` | æ ¸å¿ƒ AI æ™ºèƒ½å¤„ç†æœåŠ¡ | 2 ä¸ª |
| `src/services/aiService.ts` | åŸºç¡€ AI æœåŠ¡ï¼ˆé€šç”¨å¯¹è¯ï¼‰ | 5 ä¸ª |
| `src/services/moneyAIService.ts` | å‰¯ä¸šè¿½è¸ª AI æœåŠ¡ | 1 ä¸ª |
| `src/components/ai/AISmartInput.tsx` | AI è¾“å…¥ç•Œé¢ç»„ä»¶ | 0 ä¸ªï¼ˆä»…è°ƒç”¨ï¼‰ |

---

## æ ¸å¿ƒæœåŠ¡æ–‡ä»¶

### 1. aiSmartService.ts - æ ¸å¿ƒæ™ºèƒ½å¤„ç†æœåŠ¡

**æ–‡ä»¶ä½ç½®**: `src/services/aiSmartService.ts`

**ä¸»è¦åŠŸèƒ½**:
- æ™ºèƒ½è¯†åˆ«ç”¨æˆ·è¾“å…¥ç±»å‹ï¼ˆä»»åŠ¡åˆ†è§£ã€æ—¶é—´è½´æ“ä½œã€å‰¯ä¸šè¿½è¸ªç­‰ï¼‰
- è°ƒç”¨ä¸åŒçš„å¤„ç†å™¨å¤„ç†ä¸åŒç±»å‹çš„è¾“å…¥
- ç®¡ç†ä»»åŠ¡åˆ†è§£ã€æ—¶é—´å†²çªæ£€æµ‹ã€é‡‘å¸è®¡ç®—ç­‰æ ¸å¿ƒé€»è¾‘

**å…³é”®æ–¹æ³•**:
```typescript
// ä¸»å…¥å£
AISmartProcessor.process(request: AIProcessRequest): Promise<AIProcessResponse>

// è¾“å…¥ç±»å‹è¯†åˆ«
analyzeInputType(input: string): string
  è¿”å›å€¼: 'task_decomposition' | 'scheduled_task' | 'timeline_operation' | 
          'money_tracking' | 'mood_record' | 'general'

// ä»»åŠ¡åˆ†è§£å¤„ç†
handleTaskDecomposition(input: string, context: any): Promise<AIProcessResponse>
  â†“ è°ƒç”¨
  analyzeTaskWithAI(taskTitle: string, extractedDuration?: number)
    â†’ ä½¿ç”¨ã€æç¤ºè¯1: ä»»åŠ¡åˆ†æåŠ©æ‰‹ã€‘

// æ—¶é—´è½´æ“ä½œå¤„ç†
handleTimelineOperation(input: string, context: any): Promise<AIProcessResponse>
  â†“ è°ƒç”¨
  parseTimelineOperationWithAI(input: string, existingTasks: any[])
    â†’ ä½¿ç”¨ã€æç¤ºè¯2: æ—¶é—´è½´æ“ä½œåŠ©æ‰‹ã€‘
```

---

## AI æç¤ºè¯è¯¦ç»†åˆ—è¡¨

### æç¤ºè¯1: ä»»åŠ¡åˆ†æåŠ©æ‰‹

**ä½ç½®**: `src/services/aiSmartService.ts` â†’ `analyzeTaskWithAI()` æ–¹æ³•

**è°ƒç”¨æ—¶æœº**: å½“ç”¨æˆ·è¾“å…¥è¢«è¯†åˆ«ä¸º"ä»»åŠ¡åˆ†è§£"ç±»å‹æ—¶

**è§¦å‘æ¡ä»¶**:
- è¾“å…¥åŒ…å«è¿æ¥è¯ï¼šç„¶åã€ä¹‹åã€æ¥ç€ã€ã€ã€ï¼Œ
- æˆ–åŒ…å« 2 ä¸ªä»¥ä¸ŠåŠ¨è¯ï¼ˆå»ã€åƒã€æ´—ã€åˆ·ã€åšç­‰ï¼‰

**æç¤ºè¯å†…å®¹**:
```
ä½ æ˜¯ä¸€ä¸ªä»»åŠ¡åˆ†æåŠ©æ‰‹ã€‚è¯·åˆ†æä»¥ä¸‹ä»»åŠ¡å¹¶è¿”å›JSONæ ¼å¼çš„ç»“æœã€‚

ä»»åŠ¡æ ‡é¢˜ï¼š${taskTitle}
${extractedDuration ? `ç”¨æˆ·æŒ‡å®šæ—¶é•¿ï¼š${extractedDuration}åˆ†é’Ÿ` : ''}

è¯·è¿”å›ä»¥ä¸‹ä¿¡æ¯ï¼ˆå¿…é¡»æ˜¯æœ‰æ•ˆçš„JSONæ ¼å¼ï¼‰ï¼š
{
  "tags": ["æ ‡ç­¾1", "æ ‡ç­¾2"],  // 2-3ä¸ªæ ‡ç­¾ï¼Œç²’åº¦é€‚ä¸­
  "location": "ä½ç½®",  // å¯é€‰ï¼šå•æ‰€ã€å·¥ä½œåŒºã€å®¢å…ã€å§å®¤ã€æ‹æ‘„é—´ã€å¨æˆ¿ã€å…¨å±‹ã€å®¤å¤–
  "duration": ${extractedDuration || 30},  // é¢„ä¼°æ—¶é•¿ï¼ˆåˆ†é’Ÿï¼‰
  "taskType": "life",  // å¯é€‰ï¼šwork, study, health, life, finance, creative, rest
  "category": "åˆ†ç±»åç§°"  // å¦‚ï¼šå®¶åŠ¡ã€å·¥ä½œã€å­¦ä¹ ç­‰
}

æ ‡ç­¾ç¤ºä¾‹ï¼ˆç²’åº¦é€‚ä¸­ï¼‰ï¼š
- å®¶åŠ¡ç±»ï¼šå®¶åŠ¡ã€æ¸…æ´ã€æ”¶çº³ã€çŒ«å’ª
- å·¥ä½œç±»ï¼šå·¥ä½œã€ä¼šè®®ã€ç¼–ç¨‹ã€è®¾è®¡
- å­¦ä¹ ç±»ï¼šå­¦ä¹ ã€é˜…è¯»ã€è¯¾ç¨‹
- è¿åŠ¨ç±»ï¼šè¿åŠ¨ã€å¥èº«ã€è·‘æ­¥
- é¥®é£Ÿç±»ï¼šé¥®é£Ÿã€æ—©é¤ã€åˆé¤ã€æ™šé¤
- ç¤¾äº¤ç±»ï¼šç¤¾äº¤ã€æœ‹å‹ã€èšä¼š
- å¨±ä¹ç±»ï¼šå¨±ä¹ã€ä¼‘é—²ã€æ¸¸æˆ

æ³¨æ„ï¼š
1. æ ‡ç­¾ç²’åº¦é€‚ä¸­ï¼Œ2-3ä¸ªå³å¯
2. ä½ç½®æ ¹æ®ä¸­å›½å®¶åº­å®é™…æƒ…å†µåˆ¤æ–­
3. æ—¶é•¿è¦åˆç†ï¼ˆ5-120åˆ†é’Ÿï¼‰
4. åªè¿”å›JSONï¼Œä¸è¦å…¶ä»–æ–‡å­—
```

**System æ¶ˆæ¯**:
```
ä½ æ˜¯ä¸€ä¸ªä»»åŠ¡åˆ†æåŠ©æ‰‹ï¼Œä¸“é—¨å¸®åŠ©ç”¨æˆ·åˆ†æä»»åŠ¡å¹¶ç”Ÿæˆç»“æ„åŒ–æ•°æ®ã€‚åªè¿”å›JSONæ ¼å¼ï¼Œä¸è¦å…¶ä»–å†…å®¹ã€‚
```

**API å‚æ•°**:
- model: `deepseek-chat`
- temperature: `0.7`
- max_tokens: `500`

**è¿”å›æ•°æ®ç»“æ„**:
```typescript
{
  tags: string[];        // ä»»åŠ¡æ ‡ç­¾
  location: string;      // ä»»åŠ¡ä½ç½®
  duration: number;      // é¢„ä¼°æ—¶é•¿ï¼ˆåˆ†é’Ÿï¼‰
  taskType: string;      // ä»»åŠ¡ç±»å‹
  category: string;      // ä»»åŠ¡åˆ†ç±»
  color: string;         // æ ¹æ®æ ‡ç­¾è‡ªåŠ¨è®¡ç®—çš„é¢œè‰²
}
```

**è°ƒç”¨ç¤ºä¾‹**:
```typescript
// ç”¨æˆ·è¾“å…¥: "5åˆ†é’Ÿåå»ç…®ç¨€é¥­åƒåˆé¥­ åˆ·ç‰™æ´—è„¸"
// ç³»ç»Ÿè¯†åˆ«ä¸ºä»»åŠ¡åˆ†è§£ï¼Œåˆ†å‰²æˆ:
// 1. "å»ç…®ç¨€é¥­"
// 2. "åƒåˆé¥­"
// 3. "åˆ·ç‰™æ´—è„¸"

// å¯¹æ¯ä¸ªä»»åŠ¡è°ƒç”¨ analyzeTaskWithAI()
const analysis = await AISmartProcessor.analyzeTaskWithAI("å»ç…®ç¨€é¥­");

// AI è¿”å›:
{
  "tags": ["é¥®é£Ÿ", "åšé¥­"],
  "location": "å¨æˆ¿",
  "duration": 30,
  "taskType": "life",
  "category": "ç”Ÿæ´»äº‹åŠ¡"
}
```

---

### æç¤ºè¯2: æ—¶é—´è½´æ“ä½œåŠ©æ‰‹

**ä½ç½®**: `src/services/aiSmartService.ts` â†’ `parseTimelineOperationWithAI()` æ–¹æ³•

**è°ƒç”¨æ—¶æœº**: å½“ç”¨æˆ·è¾“å…¥è¢«è¯†åˆ«ä¸º"æ—¶é—´è½´æ“ä½œ"ç±»å‹æ—¶

**è§¦å‘æ¡ä»¶**:
- è¾“å…¥åŒ…å«æ“ä½œå…³é”®è¯ï¼šåˆ é™¤ã€ç§»åŠ¨ã€ä¿®æ”¹ã€é¡ºå»¶ã€æ¨è¿Ÿã€æå‰ã€æ¸…ç©ºã€å–æ¶ˆ

**æç¤ºè¯å†…å®¹**:
```
ä½ æ˜¯ä¸€ä¸ªæ—¶é—´è½´æ“ä½œåŠ©æ‰‹ã€‚è¯·åˆ†æç”¨æˆ·çš„æŒ‡ä»¤å¹¶è¿”å›JSONæ ¼å¼çš„æ“ä½œã€‚

ç”¨æˆ·æŒ‡ä»¤ï¼š${input}

å½“å‰æ—¶é—´ï¼š${new Date().toLocaleString('zh-CN')}

ç°æœ‰ä»»åŠ¡åˆ—è¡¨ï¼š
${tasksInfo.map((t, i) => `${i + 1}. ${t.title} (${t.start})`).join('\n')}

è¯·è¿”å›ä»¥ä¸‹æ ¼å¼çš„JSONï¼ˆå¿…é¡»æ˜¯æœ‰æ•ˆçš„JSONï¼‰ï¼š
{
  "operation": "delete",  // æ“ä½œç±»å‹ï¼šdelete(åˆ é™¤) | move(ç§»åŠ¨) | modify(ä¿®æ”¹) | add(æ·»åŠ ) | delay(é¡ºå»¶)
  "filters": {
    "date": "today",  // æ—¥æœŸè¿‡æ»¤ï¼štoday | yesterday | tomorrow | å…·ä½“æ—¥æœŸ
    "timeRange": { "start": "15:00", "end": "18:00" },  // æ—¶é—´èŒƒå›´ï¼ˆå¯é€‰ï¼‰
    "all": true  // æ˜¯å¦å…¨éƒ¨ï¼ˆå¯é€‰ï¼‰
  },
  "newTask": {  // å¦‚æœæ˜¯æ·»åŠ ä»»åŠ¡ï¼ˆå¯é€‰ï¼‰
    "title": "ä»»åŠ¡åç§°",
    "time": "15:40",
    "duration": 30
  },
  "delayMinutes": 60  // å¦‚æœæ˜¯é¡ºå»¶ï¼Œå»¶è¿Ÿå¤šå°‘åˆ†é’Ÿï¼ˆå¯é€‰ï¼‰
}

ç¤ºä¾‹ï¼š
1. "åˆ é™¤ä»Šå¤©æ‰€æœ‰çš„ä»»åŠ¡" â†’ {"operation": "delete", "filters": {"date": "today", "all": true}}
2. "åˆ é™¤ä»Šå¤©ä¸‹åˆ3ç‚¹ä»¥åçš„ä»»åŠ¡" â†’ {"operation": "delete", "filters": {"date": "today", "timeRange": {"start": "15:00", "end": "23:59"}}}
3. "åœ¨ä»Šå¤©ä¸‹åˆ3:40å¢åŠ ä¸€ä¸ªå¼€ä¼šä»»åŠ¡" â†’ {"operation": "add", "newTask": {"title": "å¼€ä¼š", "time": "15:40", "duration": 60}}
4. "æŠŠä»Šå¤©çš„ä»»åŠ¡å¾€åæ¨1å°æ—¶" â†’ {"operation": "delay", "filters": {"date": "today"}, "delayMinutes": 60}

åªè¿”å›JSONï¼Œä¸è¦å…¶ä»–æ–‡å­—ã€‚
```

**System æ¶ˆæ¯**:
```
ä½ æ˜¯ä¸€ä¸ªæ—¶é—´è½´æ“ä½œåŠ©æ‰‹ï¼Œä¸“é—¨è§£æç”¨æˆ·çš„æ—¶é—´è½´æ“ä½œæŒ‡ä»¤ã€‚åªè¿”å›JSONæ ¼å¼ï¼Œä¸è¦å…¶ä»–å†…å®¹ã€‚
```

**API å‚æ•°**:
- model: `deepseek-chat`
- temperature: `0.3`
- max_tokens: `500`

---

### æç¤ºè¯3: å‰¯ä¸šè¿½è¸ªåŠ©æ‰‹

**ä½ç½®**: `src/services/moneyAIService.ts` â†’ `parseMoneyCommandWithAI()` æ–¹æ³•

**è°ƒç”¨æ—¶æœº**: å½“ç”¨æˆ·è¾“å…¥è¢«è¯†åˆ«ä¸º"å‰¯ä¸šè¿½è¸ª"ç±»å‹æ—¶

**è§¦å‘æ¡ä»¶**:
- è¾“å…¥åŒ…å«å…³é”®è¯ï¼šèµšäº†ã€æ”¶å…¥ã€èŠ±äº†ã€æ”¯å‡ºã€ä¹°äº†ã€æ¬ äº†ã€å‰¯ä¸šã€æ–°å»º

**æç¤ºè¯å†…å®¹**:
```
ä½ æ˜¯ä¸€ä¸ªå‰¯ä¸šè¿½è¸ªåŠ©æ‰‹ã€‚è¯·åˆ†æç”¨æˆ·çš„è¾“å…¥å¹¶è¿”å›JSONæ ¼å¼çš„ç»“æœã€‚

ç”¨æˆ·è¾“å…¥ï¼š${input}

ç°æœ‰å‰¯ä¸šåˆ—è¡¨ï¼š
${hustlesInfo.map((h, i) => `${i + 1}. ${h.icon} ${h.name}`).join('\n')}

è¯·è¿”å›ä»¥ä¸‹æ ¼å¼çš„JSONï¼ˆå¿…é¡»æ˜¯æœ‰æ•ˆçš„JSONï¼‰ï¼š
{
  "type": "income",  // ç±»å‹ï¼šincome(æ”¶å…¥) | expense(æ”¯å‡º) | create_side_hustle(æ–°å»ºå‰¯ä¸š) | debt(æ¬ å€º) | idea(æƒ³æ³•)
  "sideHustleName": "insç©¿æ­è´¦å·",  // å‰¯ä¸šåç§°ï¼ˆä»ç°æœ‰åˆ—è¡¨ä¸­åŒ¹é…ï¼Œæˆ–æå–æ–°åç§°ï¼‰
  "sideHustleId": "xxx-xxx",  // å‰¯ä¸šIDï¼ˆå¦‚æœåŒ¹é…åˆ°ç°æœ‰å‰¯ä¸šï¼‰
  "amount": 1000,  // é‡‘é¢ï¼ˆæ•°å­—ï¼‰
  "description": "æ¥äº†ä¸€ä¸ªå¹¿å‘Š",  // æè¿°/å¤‡æ³¨
  "confidence": 0.95  // ç½®ä¿¡åº¦ 0-1
}

è¯†åˆ«è§„åˆ™ï¼š
1. ä¼˜å…ˆä»ç°æœ‰å‰¯ä¸šåˆ—è¡¨ä¸­åŒ¹é…ï¼ˆæ¨¡ç³ŠåŒ¹é…ï¼Œå¦‚"ins"å¯ä»¥åŒ¹é…"insç©¿æ­è´¦å·"ï¼‰
2. æå–é‡‘é¢æ•°å­—ï¼ˆæ”¯æŒï¼š1000ã€1000å…ƒã€1kã€1åƒç­‰ï¼‰
3. æå–æè¿°ä¿¡æ¯
4. åˆ¤æ–­æ˜¯æ”¶å…¥è¿˜æ˜¯æ”¯å‡ºï¼ˆèµšäº†/æ”¶å…¥=incomeï¼ŒèŠ±äº†/ä¹°äº†=expenseï¼‰

ç¤ºä¾‹ï¼š
1. "ä»Šå¤©insèµšäº†1000å—" â†’ {"type": "income", "sideHustleName": "insç©¿æ­è´¦å·", "amount": 1000, "description": "ä»Šå¤©insèµšäº†1000å—"}
2. "ç…§ç›¸é¦†ä¹°è®¾å¤‡èŠ±äº†5000" â†’ {"type": "expense", "sideHustleName": "ç…§ç›¸é¦†å°çº¢ä¹¦", "amount": 5000, "description": "ä¹°è®¾å¤‡"}
3. "æ–°å»ºå‰¯ä¸šï¼šæŠ–éŸ³ç¾å¦†è´¦å·" â†’ {"type": "create_side_hustle", "sideHustleName": "æŠ–éŸ³ç¾å¦†è´¦å·"}
4. "æ¬ äº†ä¾›åº”å•†3000å—" â†’ {"type": "debt", "amount": 3000, "description": "æ¬ ä¾›åº”å•†"}

åªè¿”å›JSONï¼Œä¸è¦å…¶ä»–æ–‡å­—ã€‚
```

**System æ¶ˆæ¯**:
```
ä½ æ˜¯ä¸€ä¸ªå‰¯ä¸šè¿½è¸ªåŠ©æ‰‹ï¼Œä¸“é—¨è§£æç”¨æˆ·çš„æ”¶å…¥æ”¯å‡ºè®°å½•ã€‚åªè¿”å›JSONæ ¼å¼ï¼Œä¸è¦å…¶ä»–å†…å®¹ã€‚
```

**API å‚æ•°**:
- model: `deepseek-chat`
- temperature: `0.3`
- max_tokens: `500`

---

## è°ƒç”¨æµç¨‹å›¾

### å®Œæ•´çš„ç”¨æˆ·è¾“å…¥å¤„ç†æµç¨‹

```
ç”¨æˆ·åœ¨ AI æ™ºèƒ½åŠ©æ‰‹ä¸­è¾“å…¥æ–‡æœ¬
         â†“
AISmartInput.tsx â†’ handleSend()
         â†“
processWithAI() - æ„å»ºè¯·æ±‚ä¸Šä¸‹æ–‡
         â†“
AISmartProcessor.process(request)
         â†“
analyzeInputType(input) - è¯†åˆ«è¾“å…¥ç±»å‹
         â†“
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â†“         â†“        â†“          â†“         â†“
ä»»åŠ¡åˆ†è§£   æ—¶é—´è½´æ“ä½œ  å‰¯ä¸šè¿½è¸ª   å¿ƒæƒ…è®°å½•   é€šç”¨è¾“å…¥
    â†“         â†“        â†“          â†“         â†“
ã€æç¤ºè¯1ã€‘ã€æç¤ºè¯2ã€‘ã€æç¤ºè¯3ã€‘  ç›´æ¥å¤„ç†   æç¤ºç”¨æˆ·
    â†“         â†“        â†“          â†“         â†“
è¿”å› AIProcessResponseï¼ˆåŒ…å« messageã€actionsã€dataï¼‰
         â†“
AISmartInput.tsx æ˜¾ç¤ºç»“æœ
         â†“
ç”¨æˆ·ç¡®è®¤æˆ–è‡ªåŠ¨æ‰§è¡Œ actions
         â†“
executeActions() - æ‰§è¡Œå…·ä½“æ“ä½œ
         â†“
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â†“         â†“        â†“          â†“
åˆ›å»ºä»»åŠ¡   æ›´æ–°æ—¶é—´è½´  æ·»åŠ æ”¶å…¥   è®°å½•å¿ƒæƒ…
```

---

## é—®é¢˜è¯Šæ–­

### å½“å‰ç³»ç»Ÿå­˜åœ¨çš„é—®é¢˜

#### é—®é¢˜1: è¾“å…¥è¯†åˆ«ä¸å‡†ç¡®

**ç°è±¡**: 
- ç”¨æˆ·è¾“å…¥ "å»ç…®ç¨€é¥­åƒåˆé¥­ åˆ·ç‰™æ´—è„¸" æ²¡æœ‰è¢«è¯†åˆ«ä¸ºä»»åŠ¡åˆ†è§£
- è¿”å› `Actions: undefined` å’Œ `Data: undefined`

**åŸå› **:
- æ—§ç‰ˆ `analyzeInputType()` åªæ£€æŸ¥æ˜ç¡®çš„è¿æ¥è¯ï¼ˆç„¶åã€ä¹‹åã€ã€ã€ï¼Œï¼‰
- æ²¡æœ‰æ£€æŸ¥åŠ¨è¯æ•°é‡

**è§£å†³æ–¹æ¡ˆ** (å·²ä¿®å¤):
```typescript
// æ–°å¢åŠ¨è¯è®¡æ•°é€»è¾‘
const actionVerbs = ['å»', 'åƒ', 'æ´—', 'åˆ·', 'åš', 'æ‰“æ‰«', ...];
let verbCount = 0;
for (const verb of actionVerbs) {
  const matches = cleanInput.match(new RegExp(verb, 'g'));
  if (matches) verbCount += matches.length;
}
if (verbCount >= 2) return 'task_decomposition';
```

#### é—®é¢˜2: AI è°ƒç”¨é€»è¾‘æ··ä¹±

**ç°è±¡**:
- æœ‰æ—¶è°ƒç”¨ AIï¼Œæœ‰æ—¶ä¸è°ƒç”¨
- æœ‰æ—¶ç”¨æç¤ºè¯åˆ†æï¼Œæœ‰æ—¶ç”¨è§„åˆ™åˆ†æ

**åŸå› åˆ†æ**:
1. **ä»»åŠ¡åˆ†è§£æµç¨‹**:
   - âœ… æ€»æ˜¯è°ƒç”¨ AIï¼ˆ`analyzeTaskWithAI`ï¼‰
   - âœ… ä½¿ç”¨ã€æç¤ºè¯1ã€‘åˆ†ææ¯ä¸ªä»»åŠ¡çš„æ ‡ç­¾ã€ä½ç½®ã€æ—¶é•¿
   
2. **æ—¶é—´è½´æ“ä½œæµç¨‹**:
   - âœ… æ€»æ˜¯è°ƒç”¨ AIï¼ˆ`parseTimelineOperationWithAI`ï¼‰
   - âœ… ä½¿ç”¨ã€æç¤ºè¯2ã€‘è§£ææ“ä½œæŒ‡ä»¤
   
3. **å‰¯ä¸šè¿½è¸ªæµç¨‹**:
   - âœ… æ€»æ˜¯è°ƒç”¨ AIï¼ˆ`parseMoneyCommandWithAI`ï¼‰
   - âœ… ä½¿ç”¨ã€æç¤ºè¯3ã€‘è§£ææ”¶å…¥æ”¯å‡º

**ç»“è®º**: ç³»ç»Ÿé€»è¾‘æ˜¯ç»Ÿä¸€çš„ï¼Œæ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½éƒ½è°ƒç”¨ AIï¼Œä¸å­˜åœ¨æ··ä¹±ã€‚

#### é—®é¢˜3: "ä»»åŠ¡ç¡®è®¤"åŠŸèƒ½ä¸¢å¤±ï¼Ÿ

**ç°çŠ¶æ£€æŸ¥**:

âœ… **ä»»åŠ¡ç¡®è®¤åŠŸèƒ½ä»ç„¶å­˜åœ¨**ï¼Œä½“ç°åœ¨ä»¥ä¸‹æµç¨‹ï¼š

1. **ä»»åŠ¡åˆ†è§£åçš„ç¡®è®¤**:
```typescript
// aiSmartService.ts â†’ handleTaskDecomposition()
return {
  message: "âœ… AIå·²æ™ºèƒ½åˆ†æ X ä¸ªä»»åŠ¡...",
  data: { decomposed_tasks: [...] },
  actions: [{
    type: 'create_task',
    data: { tasks: decomposedTasks },
    label: 'âœ… ç¡®è®¤å¹¶æ·»åŠ åˆ°æ—¶é—´è½´'
  }],
  needsConfirmation: true,  // éœ€è¦ç”¨æˆ·ç¡®è®¤
  autoExecute: false         // ä¸è‡ªåŠ¨æ‰§è¡Œ
}
```

2. **UI å±‚çš„ä»»åŠ¡ç¼–è¾‘å™¨**:
```typescript
// TaskInbox.tsx â†’ handleSmartDistribute()
// æ‰“å¼€ä»»åŠ¡ç¼–è¾‘å™¨ï¼Œå…è®¸ç”¨æˆ·ï¼š
// - åŒå‡»ä»»æ„å­—æ®µè¿›è¡Œç¼–è¾‘
// - ä½¿ç”¨ä¸Šä¸‹ç®­å¤´è°ƒæ•´ä»»åŠ¡é¡ºåº
// - ä¿®æ”¹å®Œæˆåç‚¹å‡»"ğŸš€ å…¨éƒ¨æ¨é€åˆ°æ—¶é—´è½´"
setShowTaskEditor(true);
setEditingTasks(taskAction.data.tasks);
```

**é—®é¢˜**: ä»»åŠ¡ç¡®è®¤åŠŸèƒ½æ²¡æœ‰ä¸¢å¤±ï¼Œä½†å¯èƒ½åœ¨æŸäº›åœºæ™¯ä¸‹æ²¡æœ‰æ­£ç¡®è§¦å‘ã€‚

---

## é…ç½®æ£€æŸ¥æ¸…å•

### API é…ç½®éªŒè¯

```typescript
// æ£€æŸ¥ API é…ç½®æ˜¯å¦æ­£ç¡®
const { config, isConfigured } = useAIStore.getState();

console.log('API é…ç½®æ£€æŸ¥:', {
  apiKey: config.apiKey ? 'å·²è®¾ç½®' : 'æœªè®¾ç½®',
  apiEndpoint: config.apiEndpoint,
  model: config.model,
  isConfigured: isConfigured()
});
```

### è°ƒç”¨é“¾è·¯éªŒè¯

1. **ç”¨æˆ·è¾“å…¥** â†’ `AISmartInput.tsx`
2. **ç±»å‹è¯†åˆ«** â†’ `AISmartProcessor.analyzeInputType()`
3. **AI å¤„ç†** â†’ å¯¹åº”çš„ handler æ–¹æ³•
4. **æç¤ºè¯è°ƒç”¨** â†’ `fetch(apiEndpoint, ...)`
5. **ç»“æœè¿”å›** â†’ `AIProcessResponse`
6. **UI æ˜¾ç¤º** â†’ æ¶ˆæ¯ + æ“ä½œæŒ‰é’®

---

## ä¼˜åŒ–å»ºè®®

### 1. ç»Ÿä¸€æç¤ºè¯ç®¡ç†

å»ºè®®åˆ›å»º `src/services/aiPrompts.ts` æ–‡ä»¶ï¼Œé›†ä¸­ç®¡ç†æ‰€æœ‰æç¤ºè¯ï¼š

```typescript
export const AI_PROMPTS = {
  TASK_ANALYZER: {
    system: "ä½ æ˜¯ä¸€ä¸ªä»»åŠ¡åˆ†æåŠ©æ‰‹...",
    user: (taskTitle: string, duration?: number) => `...`,
    temperature: 0.7,
    maxTokens: 500
  },
  TIMELINE_OPERATOR: {
    system: "ä½ æ˜¯ä¸€ä¸ªæ—¶é—´è½´æ“ä½œåŠ©æ‰‹...",
    user: (input: string, tasks: any[]) => `...`,
    temperature: 0.3,
    maxTokens: 500
  },
  // ... å…¶ä»–æç¤ºè¯
};
```

### 2. å¢åŠ è°ƒè¯•æ—¥å¿—

åœ¨å…³é”®èŠ‚ç‚¹æ·»åŠ æ—¥å¿—ï¼š

```typescript
console.log('ğŸ” è¾“å…¥ç±»å‹è¯†åˆ«:', inputType);
console.log('ğŸ¤– è°ƒç”¨ AI æç¤ºè¯:', promptName);
console.log('âœ… AI è¿”å›ç»“æœ:', response);
```

### 3. é”™è¯¯å¤„ç†ä¼˜åŒ–

ç»Ÿä¸€é”™è¯¯å¤„ç†é€»è¾‘ï¼Œæä¾›æ›´å‹å¥½çš„é”™è¯¯æç¤ºã€‚

---

## æ€»ç»“

### ç³»ç»Ÿç°çŠ¶

âœ… **AI è°ƒç”¨é€»è¾‘æ˜¯ç»Ÿä¸€çš„**
- æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½éƒ½è°ƒç”¨ AI
- æ¯ä¸ªåŠŸèƒ½éƒ½æœ‰å¯¹åº”çš„æç¤ºè¯
- æç¤ºè¯è®¾è®¡åˆç†ï¼Œè¿”å›ç»“æ„åŒ–æ•°æ®

âœ… **ä»»åŠ¡ç¡®è®¤åŠŸèƒ½å­˜åœ¨**
- ä»»åŠ¡åˆ†è§£åä¼šæ‰“å¼€ç¼–è¾‘å™¨
- ç”¨æˆ·å¯ä»¥ä¿®æ”¹ä»»åŠ¡è¯¦æƒ…
- ç¡®è®¤åæ‰æ¨é€åˆ°æ—¶é—´è½´

âŒ **è¾“å…¥è¯†åˆ«éœ€è¦ä¼˜åŒ–**
- å·²ä¿®å¤ï¼šå¢åŠ åŠ¨è¯è®¡æ•°è¯†åˆ«
- å·²ä¿®å¤ï¼šä¼˜åŒ–ä»»åŠ¡åˆ†å‰²é€»è¾‘

### ä¸‹ä¸€æ­¥è¡ŒåŠ¨

1. âœ… ä¿®å¤è¾“å…¥è¯†åˆ«é—®é¢˜ï¼ˆå·²å®Œæˆï¼‰
2. â³ æµ‹è¯•æ‰€æœ‰åœºæ™¯ï¼Œç¡®ä¿ AI æ­£ç¡®è°ƒç”¨
3. â³ ä¼˜åŒ–æç¤ºè¯ï¼Œæé«˜è¯†åˆ«å‡†ç¡®ç‡
4. â³ å¢åŠ è°ƒè¯•æ—¥å¿—ï¼Œæ–¹ä¾¿é—®é¢˜æ’æŸ¥

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**æœ€åæ›´æ–°**: 2026-02-02  
**ç»´æŠ¤è€…**: AI Assistant

