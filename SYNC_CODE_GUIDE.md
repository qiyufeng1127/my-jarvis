# 🔗 云同步码功能说明

## 功能概述

云同步码是一个8位的唯一代码（格式：XXXX-XXXX），用于在多个设备间同步数据。通过云同步码，你可以在手机、平板、电脑等多个设备上使用同一账号的数据。

## 使用场景

### 场景1：在新设备上使用
1. 在原设备上打开"设置" → "云同步"
2. 点击"生成同步码"，获得一个8位同步码（如：ABCD-1234）
3. 在新设备上打开"设置" → "云同步"
4. 点击"加入已有同步码"，输入同步码
5. 完成！新设备将自动同步所有数据

### 场景2：多设备协同工作
- 在公司电脑上创建任务
- 在家里电脑上继续完成
- 在手机上随时查看进度
- 所有设备数据实时同步

## 功能特性

### ✅ 自动同步
- **实时同步**：数据修改后立即同步到云端
- **后台同步**：应用在后台时也会自动同步
- **启动同步**：打开应用时自动从云端加载最新数据

### 🔒 安全可靠
- **唯一性**：每个同步码全球唯一
- **加密传输**：数据传输过程加密
- **权限控制**：只有拥有同步码的设备才能访问数据

### 📱 多设备支持
- **设备管理**：查看所有已连接设备
- **最后同步时间**：显示每个设备的最后同步时间
- **设备类型识别**：自动识别手机、平板、电脑

### 🔄 冲突解决
- **云端优先**：默认使用云端最新数据
- **本地优先**：可选择使用本地数据
- **手动选择**：冲突时手动选择保留哪个版本

## 数据同步范围

默认同步以下数据：
- ✅ 仪表盘模块配置
- ✅ 任务数据
- ✅ 长期目标
- ✅ 习惯记录
- ✅ 日记和记忆
- ❌ 个人设置（可选）

## 使用步骤

### 第一步：生成同步码

1. 打开"设置"模块
2. 选择"云同步"标签
3. 点击"生成同步码"按钮
4. 系统会生成一个8位同步码（如：ABCD-1234）
5. 复制或记住这个同步码

### 第二步：在其他设备上加入

1. 在新设备上打开"设置" → "云同步"
2. 点击"加入已有同步码"
3. 输入第一步生成的同步码
4. 点击"确认加入"
5. 等待数据同步完成

### 第三步：验证同步

1. 在任一设备上创建一个测试任务
2. 在其他设备上刷新，查看任务是否出现
3. 如果任务出现，说明同步成功！

## 常见问题

### Q1: 同步码丢失了怎么办？
A: 在任一已连接的设备上打开"设置" → "云同步"，可以查看当前的同步码。

### Q2: 可以重新生成同步码吗？
A: 可以。点击"重新生成"按钮，但注意：重新生成后，其他设备需要重新输入新的同步码。

### Q3: 同步码会过期吗？
A: 不会。同步码永久有效，除非你手动重新生成。

### Q4: 最多可以连接多少个设备？
A: 没有限制。你可以在任意数量的设备上使用同一个同步码。

### Q5: 数据同步需要多长时间？
A: 通常在几秒内完成。具体时间取决于数据量和网络速度。

### Q6: 离线时数据会丢失吗？
A: 不会。离线时数据保存在本地，联网后自动同步到云端。

### Q7: 如何取消设备同步？
A: 在"已连接设备"列表中，点击设备旁的"移除"按钮。

### Q8: 同步会消耗很多流量吗？
A: 不会。只同步变化的数据，流量消耗很小。

## 技术实现

### 数据库表结构

#### sync_codes 表
```sql
- id: UUID (主键)
- user_id: TEXT (用户ID，唯一)
- sync_code: TEXT (同步码，唯一)
- created_at: TIMESTAMP (创建时间)
- updated_at: TIMESTAMP (更新时间)
```

#### connected_devices 表
```sql
- id: UUID (主键)
- user_id: TEXT (用户ID)
- sync_code: TEXT (同步码)
- device_name: TEXT (设备名称)
- device_type: TEXT (设备类型：mobile/desktop)
- last_sync: TIMESTAMP (最后同步时间)
- created_at: TIMESTAMP (创建时间)
```

### 同步流程

1. **生成同步码**
   - 生成8位随机字符串（去除易混淆字符）
   - 保存到 `sync_codes` 表
   - 注册当前设备到 `connected_devices` 表

2. **加入同步码**
   - 验证同步码是否存在
   - 将当前用户ID关联到该同步码
   - 注册当前设备
   - 从云端拉取数据

3. **数据同步**
   - 监听本地数据变化
   - 自动上传到 Supabase
   - 其他设备自动接收更新

4. **冲突解决**
   - 比较时间戳
   - 根据策略选择保留哪个版本
   - 合并非冲突字段

## 安全建议

1. **不要分享同步码**：同步码相当于账号密码，不要随意分享给他人
2. **定期检查设备**：定期查看"已连接设备"，移除不再使用的设备
3. **重要操作前备份**：重新生成同步码前，建议先导出数据备份
4. **使用强密码**：如果你的 Supabase 账号有密码，请使用强密码

## 故障排除

### 问题1：无法生成同步码
- 检查网络连接
- 检查 Supabase 配置是否正确
- 查看浏览器控制台错误信息

### 问题2：加入同步码失败
- 确认同步码输入正确（区分大小写）
- 检查网络连接
- 确认同步码未过期

### 问题3：数据不同步
- 检查"自动同步"是否开启
- 点击"立即同步"手动触发
- 检查网络连接
- 查看"最后同步时间"

### 问题4：同步冲突
- 选择"云端优先"或"本地优先"
- 或手动选择保留哪个版本
- 建议：重要数据修改前先同步

## 更新日志

### v1.0.0 (2024-01-25)
- ✅ 初始版本发布
- ✅ 支持生成同步码
- ✅ 支持加入已有同步码
- ✅ 支持设备管理
- ✅ 支持自动同步
- ✅ 支持冲突解决

## 反馈与支持

如有问题或建议，请通过以下方式联系：
- GitHub Issues
- 应用内反馈
- 邮件支持

---

**享受多设备无缝同步的体验！** 🚀








